/**
 *  Std UI Kit Library
 *  http://ui.stdjs.com
 *  --------------------
 *  module: Pagination
 *  plugin: Pagination
*/
Std.ui.module("Pagination",{b:"widget",e:{defaultClass:"StdUI_Pagination",tabIndex:null,level:3,total:0,page:1,pageSize:10,pageCount:"auto",pageNumbers:!0,pageNumberSize:7,pageButtonSpacing:0,pageButtonClassName:"StdUI_Pagination_Button",text:"<b><?=page?></b> / <b><?=pageCount?></b><b style='margin-left: 10px'>total:</b><?=total?>",href:"",first:"«",last:"»",prev:"◀",next:"▶",align:"left",refresh:null,editable:!0,buttonTheme:"default",buttonAutoHide:!1},c:"change",g:{render:function(){var e=this,t=e._buttonGroup;t.left&&t.left.render(),t.pages&&t.pages.render(),t.right&&t.right.render(),e.refreshPages(),e.refreshText(),e.refreshList()},destroy:function(){var e=this,t=e._buttonGroup;e._pageList&&e._pageList.destroy(),t.left&&t.left.destroy(),t.pages&&t.pages.destroy(),t.right&&t.right.destroy()}},i:{pageHref:function(e){var t=this._hrefTpl;return t?t.build({page:e,pageSize:this.pageSize(),pageNumberSize:this.opts.pageNumberSize,pageCount:this.pageCount(),total:this.total()}):null}},n:{initEvents:function(){var e=this,t=function(){var t=this.ui();t.enable()&&!t.checked()&&setTimeout(function(){e.page(t.value())},1)};e[0].on("mouseenter",".StdUI_Button",function(e){this.mouse({auto:!1,click:t},e)})},initDOMTree:function(){var e=this,t=e.opts,a=e.DOMMap={main:newDom("tr"),buttons:newDom("td"),text:newDom("td","_text")};e[0].append(newDom("table").attr({cellspacing:0,cellpadding:0}).append(newDom("tbody").append(a.main=newDom("tr")))),"left"===t.align?a.main.append([a.buttons.attr("align","left"),a.text.attr("align","right")]):"right"===t.align&&a.main.append([a.text.attr("align","left"),a.buttons.attr("align","right")])},initButtonGroup:function(){var e=this,t=e.opts,a=e._buttonGroup={};(t.first||t.prev)&&(a.left=Std.ui("ButtonGroup",{buttonTheme:t.buttonTheme,appendTo:e.DOMMap.buttons,spacing:0,buttonFocusedClass:null})),t.pageNumbers&&(a.pages=Std.ui("ButtonGroup",{buttonClassName:t.pageButtonClassName,buttonTheme:t.buttonTheme,appendTo:e.DOMMap.buttons,spacing:t.pageButtonSpacing,buttonFocusedClass:null})),(t.next||t.last)&&(a.right=Std.ui("ButtonGroup",{buttonTheme:t.buttonTheme,appendTo:e.DOMMap.buttons,spacing:0,buttonFocusedClass:null})),!isEmpty(t.first)&&a.left.append("first",t.first),!isEmpty(t.prev)&&a.left.append("prev",t.prev),!isEmpty(t.next)&&a.right.append("next",t.next),!isEmpty(t.last)&&a.right.append("last",t.last)}},j:{total:function(e){return this.opt("total",e,function(){this.rendered&&this.refreshPages().refreshText().refreshList()})},text:function(e){return this.opt("text",e,function(){this._textTpl=new Std.template(e),this.rendered&&this.refreshText()})},href:function(e){return this.opt("href",e,function(){this._hrefTpl=isEmpty(e)?null:new Std.template(e),this.rendered&&this.refreshPages()})},pageSize:function(e){return this.opt("pageSize",e,function(){this.rendered&&this.refreshPages().refreshText()})},pageNumberSize:function(e){return this.opt("pageNumberSize",e,function(){this.rendered&&this.refreshPages().refreshText()})},editable:function(e){var t=this;return t.opt("editable",e,function(){e?t.refreshList():t._pageList&&(t._pageList.destroy(),delete t._pageList)})},page:function(e){var t=this,a=t.opts,n=t._pageList;return void 0===e?int(a.page):((e=t.pageIndex(e))!=~~a.page&&((a.page=e=1>e?1:e)&&n&&e!==n.value()&&n.value(e),t.refreshPages().refreshText(),t.emit("change",e)),t)},pageIndex:function(e){var t=this;return"first"===e?e=1:"prev"===e?e=t.page()-1:"next"===e?e=t.page()+1:"last"===e&&(e=t.pageCount()),~~e},pageCount:function(e){var t=this,a=t.opts;return void 0===e?"auto"===a.pageCount?Math.ceil(a.total/a.pageSize):a.pageCount:(a.pageCount=e,t.refreshText().refreshList())},pageNumbers:function(e){var t=this,a=t.opts,n=a.page,r=t.pageCount(),i=a.pageNumberSize,s=Math.floor(i/2),o=[],u=0,p=0;if(isArray(e))a.pageNumbers=e,t.rendered&&t.refreshPages().refreshList();else if(void 0!==e)return t;if(isArray(a.pageNumbers))return a.pageNumbers;if(i>=r){for(var g=1;r>=g;g++)o.push(g);return o}for(u=1>n-s?1:r>n-1+s?n-s:r-i+1,(p=u-1+i)>r&&(p=r);p>=u;)o.push(u++);return o},refreshText:function(){var e=this;return e.rendered&&e._textTpl&&e.DOMMap.text.html(e._textTpl.build({page:e.page(),pageSize:e.pageSize(),pageNumberSize:e.pageNumberSize(),pageCount:e.pageCount(),total:e.total()})),e},refreshList:function(){var e=this;return e.opts.editable?(e._pageList||(e._pageList=Std.ui("ComboBox",{editable:!0,value:e.page(),renderTo:e.DOMMap.buttons,listAnimation:!1,width:60}),e._pageList.on("change",function(){var t=this.value(),a=e.pageHref(t);isEmpty(t)||(e.page(~~t),a&&Std.url.location(a))}).on("input",function(t){var a=e.pageCount();(t=~~t.trim())<1?e._pageList.value(1):t>a&&e._pageList.value(a)})),e._pageList.clear().append(function(){for(var t=[],a=1,n=e.pageCount();n>=a;a++)a>1e4&&n>a+1e4?a+=9999:a>1e3&&n>a+1e3?a+=999:a>100&&n>a+100&&(a+=99),t.push(a+"");return t}()).value(e.page()),e):e},refreshPages:function(){var e=this,t=e.opts,a=t.page,n=e._buttonGroup;if(!e.rendered)return e;var r=e.pageNumbers(),i=t.buttonAutoHide?"visible":"enable";return n.left&&n.left[i](a>1),n.right&&n.right[i](a<e.pageCount()),Std.each("first prev next last",function(t,a){var r=e.pageIndex(a),i=e.pageHref(r),s=null;2>t&&n.left?s=n.left.items(a):n.right&&(s=n.right.items(a)),s&&s.value(r).href(i)}),t.pageNumbers&&(r=Std.each(r,function(t,n){var r=isObject(n)?n:{text:n,href:e.pageHref(n)};return(r.value=n)===a&&(r.toggleable=!1,r.checkable=!0,r.checked=!0),r},!0),n.pages.clear().append(r)),e},repaint:function(){var e=this;return e.refreshPages(),e.refreshText(),e.refreshList(),e},clear:function(){var e=this;return e.opts.pageNumbers&&e._buttonGroup.pages.clear(),e._pageList&&e._pageList.clear(),e}},k:function(e,t){t.change&&e.on("change",t.change),isString(t.text)&&e.text(t.text),isEmpty(t.href)||e.href(t.href),e.initDOMTree(),e.initButtonGroup(),e.initEvents()},m:{rule:{},html:{nodeName:["DIV"],create:function(e){var t=e.children(function(e,t){return{href:t.attr("href"),text:t.text().trim()}});isEmpty(t)||this.pageNumbers(t)}}}}),Std.plugin.module("Pagination",{e:{dataPath:"",dataInterface:null},i:{bindUIDataSource:function(){var e=this,t=e.opts,a=e.owner,n=a.dataSource,r=e.pagination;return"data"===n.type()&&r.total(n.data.length),r.on("change",function(e){var a=t.dataInterface;isString(a)&&n.call(a,{total:r.total(),page:e,pageSize:r.pageSize(),pageCount:r.pageCount()})}),n.on("message",e._messageEvent=function(e){if(isPlainObject(e.message)&&e.name===t.dataInterface){var a=Std.mold.dataPath(e.message,t.dataPath);Std.each("total pageSize pageCount page",function(e,t){t in a&&(r.opts[t]=a[t])}),r.refreshPages().refreshText().refreshList()}}),e}},j:{destroy:function(){var e=this,t=e.owner,a=t.dataSource;a&&e._messageEvent&&e._messageEvent.off("message",e._messageEvent),this.pagination.destroy()}},k:function(e,t,a){e.pagination=Std.ui("Pagination",t),e.pagination.on("change",function(){e.emit("change",arguments,!0)}),e.pagination[0].css({display:"block"}),isWidget(a)&&(e.pagination.renderTo(a),a.boxSize.extraHeight+=e.pagination.height(),a.resize("height"),a.on("render",function(){a.dataSource&&e.bindUIDataSource()}))}});