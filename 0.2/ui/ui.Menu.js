/**
    Std UI Kit Library
    http://ui.stdjs.com
	module: MenuItem,Menu
*/
Std.ui.module("MenuItem",{b:"Item",c:"checked",e:{defaultClass:"StdUI_MenuItem",text:"menu item",checkable:!1,toggleable:!0,checked:!1,subtext:null,items:null,root:null},h:{childVisible:!1},g:{render:function(){var e=this,t=e.opts,i=e.DOMMap;null!==t.items&&(i.cells||(i.cells=newDiv("_cells").appendTo(e[0])),i.cells.append(i.open=newDiv("_open")))},destroy:function(){var e=this;e.menu&&e.menu.destroy(),e._items&&e._items.clear()},remove:function(e){var t=this;void 0!==e&&t.menu&&t.menu.remove(e)}},j:{checkable:function(e){return this.opt("checkable",e)},toggleable:function(e){return this.opt("toggleable",e)},root:function(e){var t=this,i=t.opts;return void 0===e?i.root||t:(i.root=e,t)},subtext:function(e){var t=this,i=t.DOMMap;return this.opt("subtext",e,function(){i.cells||(i.cells=newDiv("_cells").appendTo(t[0])),i.subtext||(i.subtext=newDiv("_subtext").prependTo(i.cells)),i.subtext.html(e)})},checked:function(e){var t=this,i=t.DOMMap;return t.checkable()?t.opt("checked",e,function(){i.icon.toggleClass("checked",e),t.rendered&&t.emit("checked",e)}):void 0===e?t.opts.checked:t},insert:function(e,t){var i=this,n=i.DOMMap;return i.menu?i.menu.insert(e,t):(i._items||(i._items=[]),i._items.insert(e,t)),n.cells||(n.cells=newDiv("_cells").appendTo(i[0])),n.open||n.cells.append(n.open=newDiv("_open")),i},append:Std.func(function(e){return this.insert(e)},{each:[isArray]}),showChild:function(){var e=this,t=e[0].offset();return e._childVisible?e:(e.menu||(e.menu=Std.ui("Menu",{parent:e,items:e._items,root:e.root(),renderTo:"body"})),e.menu.visible(e._childVisible=!0).toForeground(),e.menu[0].css({position:"absolute",left:t.x+e.width(),top:t.y,margin:0}),e)},hideChild:function(e){var t=this;return t.menu?(e===!1?t.menu.visible(t._childVisible=!1):t.menu[0].animateTo({opacity:0},100,function(){t.menu.visible(t._childVisible=!1)}),t):t},childVisible:function(e){var t=this;return void 0===e?t._childVisible:e===t._childVisible?t:(t._childVisible===!0?t.showChild():t.hideChild(),t)}},k:function(e,t,i){var n=e.DOMMap;if(t.items&&(e._items=Array.from(t.items)),n.icon||e.initIcon(),n.text||i.append(n.text=newDiv("_text")),t.checkable&&t.checked&&e.checked(!0),t.subtext)e.subtext(t.subtext);else if(t.action){var s=Std.action(t.action);s&&s.opts.hotKey&&e.subtext(s.opts.hotKey)}},m:{rule:{content:"text",children:"append"},html:{create:function(e,t){this.append(Std.each(t,function(e,t){var i=t.attr("std-ui");return i&&Std.ui(i)?Std.ui.build(t,!1):t.html().trim()},!0))}}}}),Std.ui.module("Menu",{b:"widget",c:"itemPress",e:{defaultClass:"StdUI_Menu",level:1,items:null,root:null,width:"auto",height:"auto",theme:"default"},h:{currentItem:null},n:{initKeyboard:function(){var e=this;e[0].on({contextmenu:function(){return!1},keydown:function(t){var i=e._items.indexOf(e._currentItem);if(-1!=i&&e.enable())return e.keyEvent(t.keyCode,e._currentItem,i)}})},initEvents:function(){var e=this,t=!1;e[0].delegate("mouseenter mouseleave mousedown click",".StdUI_MenuItem",function(i){var n=e._items._list[this.index()],s=i.name;t===!1&&e[0].unselect(t=!0),e.enable()&&n.enable()&&"sep"!==n.ui&&("click"===s?(n.toggleable()&&n.checkable()&&n.checked(!n.checked()),e.root().emit("itemPress",n.emit("press"))):"mousedown"===s?i.stopPropagation():"mouseenter"==s?e.select(n):"mouseleave"!=s||n.childVisible()||e.select(!1))})}},g:{render:function(){var e=this;e._items.items(function(e,t){t.render()})},visible:function(e){var t=this;e===!0?t[0].css("zIndex",++Std.ui.status.zIndex):(t.select(!1),t._items.items(function(e,t){t._childVisible&&t.hideChild()}))},destroy:function(){this.clear()},remove:function(e){var t=this,i=null;isObject(e)&&(e=t._items.indexOf(e)),(isNumber(e)||isString(e))&&(i=t._items.items(e))&&(i.destroy(),t._items.remove(e))}},i:{keyEvent:function(e,t,i){var n=this,s=0,r=n._items,u=n.parent(),o=function(e){return!e.enable()||"MenuItem"!==e.ui};if(13===e)n.root().emit("itemPress",t.emit("press"));else if(27===e)isWidget(u)&&(n.hide(),"MenuItem"===u.ui?u.parent().focus():u.focus());else{if(37===e)return t.hideChild(),u&&"MenuItem"===u.ui&&(u.focus().hideChild(),u.parent().focus()),!1;if(38===e)return function(e){++s>r.length||(e=--e<0?r.length-1:e,o(r._list[e])?arguments.callee(e):n.select(e))}(i),!1;if(39===e)return t.menu&&(t.showChild(),t.menu.focus().select(0)),!1;if(40===e)return function(e){++s>r.length||(e=++e>=r.length?0:e,o(r._list[e])?arguments.callee(e):n.select(e))}(i),!1}},createItem:function(e,t){var i=this,n=null,s=this.root();return null==t&&(t=e,e=null),isWidget(t)?n=t.parent(i):Std.is.action(t)?n=Std.ui("MenuItem",{root:s,parent:i,action:t}):isObject(t)?(t.root=s,t.parent=i,n=Std.ui(t.ui||"MenuItem",t)):(isString(t)||isNumber(t))&&(n=Std.ui("MenuItem",{text:t+"",root:s,parent:i})),n&&isString(e)&&!n.name()&&n.name(e),n}},j:{items:function(e,t){return this._items.items(e,t)},itemCount:function(){return this._items.length},root:function(e){var t=this,i=t.opts;return void 0===e?i.root||t:(i.root=e,t)},select:function(e){var t=this;return e===t._currentItem?t:(t._currentItem&&(t._currentItem.removeClass("selected").hideChild(!1),t._currentItem=null),e===!1?t:((isNumber(e)||isString(e))&&(e=t._items.items(e)),isWidget(e)&&"MenuItem"===e.ui&&e.enable()?((t._currentItem=e.addClass("selected")).DOMMap.open&&e.showChild(),t):t))},insert:function(e,t,i){var n=this,s=null;return n._items.insert(e,t,i,function(t){return s=n.createItem(e,t)}),isWidget(s)?(n[0].insert(Std.dom.get(s),i),n.rendered&&s.render(),n):!1},append:Std.func(function(e,t){this.insert(e,t)},{each:[isArray]}),clear:function(){var e=this,t=e._items;return t.items(function(e,t){t.destroy()}),t.clear(),e}},k:function(e,t){e._items=Std.items(),null!=t.items&&e.append(t.items),e.initEvents(),e.initKeyboard()},m:{rule:{children:"append"},html:{create:function(e){var t=function(e){var t=e.attr("title"),n={name:e.attr("std-name"),icon:e.attr("std-icon"),action:e.attr("std-action")};return t?(n.text=t,n.items=i(e)):isEmpty(t=e.trimHTML())||(n.text=t),e.clear(),Std.dom(e).ui("MenuItem",Std.extend(n,Std.options.get(e)))},i=function(e){return e.children(function(e,i){var n=i.attr("std-ui");return n&&Std.ui(n)?Std.ui.build(i,!1):t(i)})};this.append(i(e))}}}});