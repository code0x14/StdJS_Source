/**
    Std UI Kit Library
    http://ui.stdjs.com
	module: DatePicker
*/
Std.ui.module("DatePicker",{b:"widget",c:"dateClick change",e:{level:1,defaultClass:"StdUI_DatePicker",editable:!0,value:"",minWidth:233,fixedWidth:!0,format:"yyyy-MM-dd hh:mm:ss",footer:!0,daysText:null,todayText:"Today"},g:{render:function(){var e=this,t=e.opts;e.value(t.value),e.initEvents()}},i:{dateCount:function(e,t){var n=this;return void 0==e?new Date(n.year(),n.month(),0).getDate():new Date(e,t,0).getDate()},clearDates:function(){var e=this,t=e.DOMMap.dates;for(var n in t)t[n].remove(),delete t[n];return e},refreshTime:function(){var e=this,t=new Date;return e.hour(t.getHours()),e.minute(t.getMinutes()),e.second(t.getSeconds()),e},updateDates:function(){var e=this,t=e.DOMMap,n=t.dates,a=e.dateCount(),o=e.year(),r=e.month(),i=new Date(o,r-1).getDay();e.clearDates();for(var d=1,u=e.dateCount(1>r?o-1:o,1>r?12:r-1);i>=d;d++)t.dateBox.append(n["l"+d]=newDom("span","_date _lastMonthDate").html(u-i+d));for(var d=1;a>=d;d++)t.dateBox.append(n[d]=newDom("span",d===e.date()?"_date selected":"_date").html(d));for(var d=1,s=new Date(e.year(),e.month()).getDay();7-s>=d;d++)t.dateBox.append(n["n"+d]=newDom("span","_date _nextMonthDate").html(d));return e},editValue:function(e,t){var n,a=this;if(!a.editable())return a;"year"===e?n=a.DOMMap.year:"month"===e&&(n=a.DOMMap.month);var o=newDom("input").insertAfter(n.hide());return o.width(n.outerWidth()-o.boxSize().width).on({focus:function(){var e=function(t){13===t.keyCode&&o.blur().off("keydown",e)},t=function(e){o.is(e.target)||(o.blur(),a[0].off("mousedown",t))};o.on("keydown",e),o.value(n.text()),a[0].on("mousedown",t)},blur:function(){var e=o.value();e.isNumber()&&t.call(n,~~e)&&(n.html(e),a.emit("change")),this.remove(),n.show()}}).focus().select(),a},initFooter:function(){var e=this,t=e.DOMMap,n=function(e){return newDom("input",e).contentEditable(!0).attr("maxlength",2).value("00")};return e[0].append(t.footer=newDiv("_footer").append([newDom("span","_label").html("time:"),newDiv("_time").append([t.hour=n("_hour"),newDiv("_and").html(":"),t.minute=n("_minute"),newDiv("_and").html(":"),t.second=n("_second")]),t.refresh=newDiv("_refresh").mouse({click:function(){e.enable()&&e.refreshTime()}}),t.today=newDiv("_today").html(e.opts.todayText).mouse({click:function(){if(e.enable()){var t=new Date;e.emit(!1),e.year(t.getFullYear()),e.month(t.getMonth()+1),e.date(t.getDate()),e.emit(!0)}}})])),t.footer.delegate("keydown keyup","input",function(e){var t=this,n=t.value();if("keydown"===e.name){if(!(e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105))return!1}else"keyup"===e.name&&(~~n>23&&0===t.index()?t.value("00"):~~n>59&&t.value("59"))}),e},initEvents:function(){var e=this,t=e.DOMMap;return t.prevYear.on("click",function(){e.enable()&&e.year(e.year()-1)}),t.nextYear.on("click",function(){e.enable()&&e.year(e.year()+1)}),t.prevMonth.on("click",function(){var t=e.month()-1;e.enable()&&(1>t?(e.year(e.year()-1),e.month(12)):e.month(t))}),t.nextMonth.on("click",function(){var t=e.month()+1;e.enable()&&(t>12?(e.year(e.year()+1),e.month(1)):e.month(t))}),t.year.on("click",function(){e.enable()&&e.editValue("year",function(t){return t>1e3&&1e4>t?(e.year(t),!0):void 0})}),t.month.on("click",function(){e.enable()&&e.editValue("month",function(t){return t>0&&13>t?(e.month(t),!0):void 0})}),t.dateBox.on("click",function(t){var n,a=Std.dom(t.target);return this.is(a)||!e.enable()?!1:(e.emit(!1),a.hasClass("_lastMonthDate")?e.month()-1<1?e.year(e.year()-1).month(12):e.month(e.month()-1):a.hasClass("_nextMonthDate")&&(e.month()+1>12?e.year(e.year()+1).month(1):e.month(e.month()+1)),e.date(n=~~a.text()).emit(!0),void e.emit("dateClick",n).emit("change"))}),e}},j:{format:function(e){return this.opt("format",e)},day:function(){return this._date.getDay()},editable:function(e){return this.opt("editable",e)},year:function(e){var t=this,n=t._date,a=~~n.getFullYear();return void 0===e?a:(n.setFullYear(e),t.DOMMap.year.html(e),t.rendered&&e!==a&&(t.updateDates(),t.emit("change")),t)},month:function(e){var t=this,n=t._date,a=~~n.getMonth()+1;return void 0===e?a:(e>12?e=12:1>e&&(e=1),t.date()>t.dateCount(t.year(),e)&&t.date(1),n.setMonth(e-1),t.DOMMap.month.html(e),t.rendered&&a!==e&&(t.updateDates(),t.emit("change")),t)},date:function(e){var t=this;if(void 0===e)return t._date.getDate();var n=t.date(),a=t.DOMMap.dates;return t._date.setDate(e),a[n]&&a[n].className("_date"),e in a&&a[e].className("_date selected"),t.rendered&&n!==e&&t.emit("change"),t},hour:function(e){var t=this,n=t._date.getHours();return void 0===e?n:(t._date.setHours(e),t.opts.footer&&t.DOMMap.hour.value(e),t.rendered&&n!==e&&t.emit("change"),t)},minute:function(e){var t=this,n=t._date.getMinutes();return void 0===e?n:(t._date.setMinutes(e),t.opts.footer&&t.DOMMap.minute.value(e),t.rendered&&e!==n&&t.emit("change"),t)},second:function(e){var t=this,n=t._date.getSeconds();return void 0===e?n:(t._date.setSeconds(e),t.opts.footer&&t.DOMMap.second.value(e),t.rendered&&e!==n&&t.emit("change"),t)},value:function(e){var t=this,n=t.opts;if(void 0===e)return t._date.format(n.format);var a=t._date=new Date;return""!==(e=e.trim())&&a.format(n.format,e),t.emit(!1),t.year(a.getFullYear()),t.month(a.getMonth()+1),t.date(a.getDate()),t.hour(a.getHours()),t.minute(a.getMinutes()),t.second(a.getSeconds()),t.updateDates(),t.emit(!0).rendered&&t.emit("change"),t}},k:function(e,t,n){var a=e.DOMMap={dates:{}};n.unselect(!0).append([a.header=newDiv("_header").append([a.prevYear=newDiv("_btn _prevYear"),a.year=newDiv("_value _year"),a.nextYear=newDiv("_btn _nextYear"),a.prevMonth=newDiv("_btn _prevMonth"),a.month=newDiv("_value _month"),a.nextMonth=newDiv("_btn _nextMonth")]),newDiv("_body").append([a.dayBox=newDiv("_dayBox"),a.dateBox=newDiv("_dateBox")])]),Std.each(t.daysText||["Su","Mo","Tu","We","Th","Fr","Sa"],function(e,t){a.dayBox.append(newDom("span","_day").html(t))}),t.footer===!0&&e.initFooter()},m:{rule:{content:"value"},html:{nodeName:["DIV"],create:function(e){var t=e.html().trim();isEmpty(t)||this.value(t)}}}}),Std.plugin.module("DatePicker",{c:"apply dateClick",e:{value:"",editable:!0,format:"yyyy-MM-dd h:m:s"},j:{value:function(e){var t=this;return void 0===e?t.datePicker.value():(t.datePicker.value(e),t)},destroy:function(){this.datePicker.destroy()}},k:function(e,t,n){var a=e.datePicker=Std.ui("DatePicker",Std.extend({renderTo:"body",visible:!1},t));a.on({dateClick:function(){a.hide(),e.emit("apply",e.value()),n.value(e.value())}})[0].css("position","absolute"),Std.dom(n).on("click",function(){var e=this.offset();a.show()[0].css({top:e.y+Std.dom(n).outerHeight(),left:e.x,zIndex:Std.ui.status.zIndex++})})}});