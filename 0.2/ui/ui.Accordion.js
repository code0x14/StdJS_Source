/**
    Std UI Kit Library
    http://ui.stdjs.com
	module: Accordion
*/
Std.ui.module("Accordion",{parent:"widget",events:"change remove expand collapse",option:{level:4,defaultClass:"StdUI_Accordion",switchType:"click",items:null,minWidth:100,template:null,overflow:"hidden",titleHeight:30,titleIconWidth:16,titleIconHeight:16,titleFontSize:null,titleBold:null,titleClass:"",titleTextClass:"",titleExpandedClass:"",titleTextAlign:null,titleArrow:!0,clientStretchable:!0,collapsible:!1,multiple:!1,autoClean:!0,deferRender:!0,contentPadding:5,selected:0},"private":{allowUpdate:!0},extend:{height:function(){var t=this;t.rendered&&t.update()},enable:function(t){this._items.items(function(e,i){i.enable(t)})},destroy:function(){this._items.items(function(t,e){e.destroy()}),this._items.clear(),this._expanded.clear()},render:function(){var t=this,e=t.opts,i=null;isNumber(e.selected)||isString(e.selected)?(i=t.items(e.selected))&&i.expand(!1):isArray(e.selected)&&Std.each(e.selected,function(e,i){t.select(i,!1)}),t.initEvents()},remove:function(t){var e=this,i=null;void 0!==t&&(i=e._items.items(t))&&(i.destroy(),e._items.remove(t),-1!==(t=e._expanded.indexOf(i))&&e._expanded.remove(t),e.rendered&&e.update(!1),e.emit("remove",i))}},initialize:{initEvents:function(){var t=this,e=t.opts;t[0].delegate("mouseenter","._item > ._title",function(i){var n=this.parent().index(),l=e.switchType;t.enable()&&("mouseenter"===l&&t._items.items(n)!==t._current&&t.select(n),this.mouse({auto:!1,unselect:!0,click:function(){"click"===l&&t.select(n)},dblclick:function(){"dblclick"===l&&t.select(n)}},i))})}},"protected":{titlesHeight:function(){var t=this,e=0;return t.items(function(t,i){e+=i.opts.titleHeight+1}),e},computeClientHeight:function(){var t=this,e=Math.floor(t.height()-t.boxSize.height-t.boxSize.extraHeight-t.titlesHeight())+1;return t._expanded.length>1?e/t._expanded.length:e},createItem:function(t,e){var i=this,n=i.opts;return new i._itemModule(Std.extend({name:e||null,iconWidth:n.titleIconWidth,iconHeight:n.titleIconHeight,titleFontSize:n.titleFontSize,titleBold:n.titleBold,titleHeight:n.titleHeight,titleClass:n.titleClass,titleArrow:n.titleArrow,titleTextClass:n.titleTextClass,titleTextAlign:n.titleTextAlign,titleExpandedClass:n.titleExpandedClass,contentPadding:n.contentPadding},t),i)},update:function(t,e){var i=this,n=i.opts;return"auto"!==n.height&&i._allowUpdate?(i._allowUpdate=!1,n.multiple?Std.each(i._expanded,function(i,n){e!==n&&n.updateHeight(t)}):isEmpty(i._expanded)||i._expanded[0].updateHeight(!1),i._allowUpdate=!0,i):i}},"public":{items:function(t,e){return this._items.items(t,e)},itemCount:function(){return this._items.length},expandedItem:function(){return this._expanded[0]||null},expandedItems:function(){return Array.from(this._expanded)},overflow:function(t){return this.opt("overflow",t,function(){this[0].css("overflow",t)})},expandAll:function(){var t=this;return t._allowUpdate=!1,t._items.items(function(t,e){e.expand()}),t._allowUpdate=!0,t},collapseAll:function(){var t=this;return t._allowUpdate=!1,t._items.items(function(t,e){e.collapse()}),t._allowUpdate=!0,t},template:function(t){var e=this,i=e.opts;return void 0===t?i.template:(isString(t)&&(t=Std.template(t)),t instanceof Std.template&&(i.template=t),e)},insert:function(t,e,i){var n=this,l=null;return n._items.insert(t,e,i,function(t,e){return l=n.createItem(t,e)}),n[0].insert(l[0],i),n.rendered&&n.update(!1),n},append:function(t,e){var i=this,n=null;if(isArray(t))for(var l=0,a=t.length;a>l;l++)i._items.push(n=i.createItem(t[l])),i[0].append(n[0]);else i._items.append(t,e,function(t,e){return n=i.createItem(t,e)}),i[0].append(n[0]);return i.rendered&&i.update(!1),i},select:function(t,e){var i=this,n=i.opts,l=null;if(isObject(t))l=t;else if(!(l=i._items.items(t)))return i;var a=l.expanded();return n.multiple?n.collapsible?a?l.collapse(e):l.expand(e):!a&&l.expand(e):(Std.each(i._expanded,function(t,i){l!==i&&i.collapse(e)}),n.collapsible?a?l.collapse(e):l.expand(e):a||l.expand(e),i.emit("change",i)),i},map:function(t){var e=this,i={};return e.items(function(n,l){var a=l.name(),o=l.content;o.rendered&&("layout"===o.opts.contentType?o.layout().map(function(n,l){isFunction(t)&&t.call(e,n,l,i),i[l]=n}):a&&(i[a]=o,isFunction(t)&&t.call(e,o,a,i)))}),isString(t)?i[t]||null:i},valid:function(){var t=this,e=t.opts,i=e.valueType;return"auto"===i||"array"===i||"map"===i?!1!==t.items(function(t,e){return e.content.valid()===!1?!1:void 0}):t.valid.parent.call(t)},value:function(t){var e=this,i=e.opts,n="auto"===i.valueType?"array":i.valueType;return void 0===t?e.rendered?"array"===n?e.items(function(t,e){return e.content.value()},!0):"map"===n&&(t={})?(e.map(function(e,i){t[i]=e.value()}),t):i.value:i.value:(isArray(i.value=t)&&"array"===n?e.items(function(e,i){e<t.length&&i.content.value(t[e])}):isObject(t)&&"map"===n&&e.map(function(e,i){e.value(t[i])}),e)},clear:function(){var t=this;return t._items.items(function(t,e){e.destroy()}),t._items.clear(),t._expanded.clear(),t.emit("clear")}},main:function(t,e){t._items=Std.items(),t._expanded=[],t._itemModule=Std.ui.modules.Accordion.itemModule,"hidden"!==e.overflow&&t.overflow(e.overflow),null!==e.template&&t.template(e.template),null!==e.items&&t.append(e.items)},support:{rule:{children:"append"},html:{nodeName:["DIV"],create:function(t){this.append(t.children("ul",function(t,e){var i=e.children("li");if(i&&!(i.length<2)){var n=null,l=e.attr("std-content"),a=i[0],o=i[1];if(l&&"html"!==l)if("layout"==l){var d=o.attr("std-ui");d&&Std.ui(d)&&(n={layout:Std.ui.build(o,!1)})}else"iframe"==l?n={iframe:o.text()}:"data"==l&&(n=o.html().toObject());else n=o.html();return Std.extend({icon:a.attr("std-icon"),text:a.html(),content:n||{}},Std.options.get(e),3)}}))}}}}),Std.ui.module("Accordion").itemModule=Std.module({e:{text:"title",icon:null,name:null,iconWidth:16,iconHeight:16,titleHeight:30,titleClass:"",titleTextClass:"",titleExpandedClass:"",titleFontSize:null,titleBold:null,titleTextAlign:null,titleArrow:!0,height:null,content:"",contentPadding:5},h:{expanded:!1,detached:!0},n:{initHeader:function(){var t=this,e=t.opts,i=t.DOMMap;isEmpty(e.icon)||(i.title.append(i.titleIcon=newDiv("_icon").css({width:e.iconWidth,height:e.iconHeight,marginTop:-(e.iconHeight/2)})),Std.icon.update(i.titleIcon,e.icon,{width:null,height:null})),i.title.append([i.titleText=newDiv("_text "+e.titleTextClass).lineHeight(e.titleHeight).html(e.text)]),isBool(e.titleBold)&&i.title.css("fontWeight",e.titleBold?"bold":"normal"),e.titleFontSize&&i.title.css("fontSize",e.titleFontSize+"px"),e.titleTextAlign&&i.title.css("textAlign",e.titleTextAlign),e.titleArrow&&(i.titleArrow=newDiv("_arrow").appendTo(i.title))},initClient:function(){var t=this,e=t.opts,i=null,n=e.content;isString(n)?i=Std.ui("widget",{html:n,tabIndex:null}):isWidget(n)?i=n:t.parent.opts.template?i=Std.ui("TemplateItem",{data:isObject(n)?n:{},template:t.parent.opts.template}):isObject(n)&&(i=Std.ui(n.ui||"widget",Std.extend({tabIndex:null},n))),t.content=i,i.opts.padding=e.contentPadding,t.parent.opts.deferRender?i.appendTo(t.DOMMap.client):(t._detached=!1,t.DOMMap.client.appendTo(t[0]),i.renderTo(t.DOMMap.client))}},i:{animateClient:function(t,e){var i=this.DOMMap.client;i.css("overflow","hidden").animateTo({height:t},{duration:200,timingFunction:"ease"},function(){i.removeStyle("overflow"),e()})},updateHeight:function(t,e){var i=this,n=i.opts,l=i.parent,a=0,o=function(){n.clientHeight?(i.DOMMap.client.height(a),i.content.height(a)):"auto"===l.opts.height?i.DOMMap.client.removeStyle("height"):(i.DOMMap.client.height(a),i.content.height(a))};a="auto"===l.opts.height?isNumber(n.clientHeight)?n.clientHeight:i.DOMMap.client.height():l.opts.clientStretchable===!1?i.DOMMap.client.height():l.computeClientHeight(),t===!1?o():(e&&i.DOMMap.client.height(0),i.animateClient(a,o))},clientVisible:function(t){var e=this,i=e.DOMMap,n=i.client;return t?(i.client.css({height:"",position:"relative",visibility:"visible"}),e._detached&&(e[0].append(n),e._detached=!1),e.content.rendered||e.content.render()):e.parent.opts.autoClean?(n.detach(),e._detached=!0):i.client.css({visibility:"hidden",position:""}),e},destroy:function(){var t=this;return t.content.destroy(),t[0].destroy(),t}},j:{expanded:function(){return this._expanded},index:function(){return this.parent._items.indexOf(this)},name:function(t){return this.opt("name",t)},text:function(t){return this.opt("text",t,function(){this.DOMMap.titleText.html(t)})},con:function(t){return this.opt("icon",t,function(){Std.icon.update(this.DOMMap.titleIcon,t)})},enable:function(t){return this.content.enable(t),this},expand:function(t){var e=this,i=e.opts;return e._expanded?e:(e[0].addClass("selected"),e.DOMMap.title.addClass(i.titleExpandedClass),e.parent._expanded.push(e.clientVisible(e._expanded=!0)),e.updateHeight(t,!0),e.parent.emit("expand",e),e.parent.opts.multiple&&e.parent.update(t,e),e)},collapse:function(t){var e=this,i=e.opts,n=function(){e.clientVisible(!1)};return e._expanded?(t===!1?n():e.animateClient(0,n),e[0].removeClass("selected"),e._expanded=!1,e.DOMMap.title.removeClass(i.titleExpandedClass),e.parent._expanded.remove(e.parent._expanded.indexOf(e)),e.parent.update(t).emit("collapse",e),e):e}},k:function(t,e){var i=this;i.parent=e,i.DOMMap={title:newDiv("_title "+t.titleClass).height(t.titleHeight),client:newDiv("_client")},i[0]=newDiv("_item").append([i.DOMMap.title]),i.init_opts(t),i.initHeader(),i.initClient()}});