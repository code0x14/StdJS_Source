/**
    Std UI Kit Library
    http://ui.stdjs.com
	module: Accordion
*/
Std.ui.module("Accordion",{parent:"widget",events:"change",option:{level:4,defaultClass:"StdUI_Accordion",switchType:"click",items:null,minWidth:100,template:null,titleHeight:30,collapsible:!1,contentPadding:5,activeItem:0},"private":{current:null},extend:{render:function(){var e=this,t=e.opts,i=e._items;i.length>0&&(e._current=i._list[t.activeItem])&&(e.repaint(),e._current.client.main.show())},height:function(){var e=this;null!=e._current&&e.repaint()},enable:function(e){var t=this;t._items.items(function(t,i){i.client.widget.enable(e)})},destroy:function(){this.clear()},remove:function(e){var t=this,i=null;(i=t._items.items(e))&&(isWidget(i.client.widget)&&i.client.widget.remove(),i[0].remove(),t._items.remove(e)),void 0!==e&&t.rendered&&t.repaint()}},"protected":{computeClientHeight:function(){var e=this,t=e.opts;return Math.floor(e.height()-e.boxSize.height-e.boxSize.extraHeight-e._items.length*(t.titleHeight+2))+1},refreshClient:function(e,t){var i=e.widget;return isWidget(i)&&(i.rendered||i.render(),e.main.animate("end"),i.height(t)),this},createItem:function(e){var t=this,i=t.createItemHeader(e.text,e.icon),n=t.createItemClient(e,e.content);return{0:newDiv("_item").append([i.main,n.main]),header:i,client:n}},createItemHeader:function(e,t){var i=this,n={main:newDiv("_title").height(i.opts.titleHeight)};return isEmpty(t)||(n.main.append(n.icon=newDiv("_icon")),Std.icon.update(n.icon,t,{width:null,height:null})),n.main.append([n.text=newDiv("_text").html(e),n.arrow=newDiv("_arrow")]),n},createItemClient:function(e,t){var i=this,n=i.opts,r=newDiv("_client"),l=null,a=n.contentPadding;return isNumber(e.padding)&&(a=e.padding),isString(t)?l=Std.ui("widget",{html:t,tabIndex:null}):isObject(t)&&(l=isWidget(t)?t:null!==n.template?Std.ui("TemplateItem",{data:t,template:n.template}):Std.ui(t.ui||"widget",Std.extend({tabIndex:null},t))),null!==l&&(l[0].padding(a),l[0].appendTo(r)),{main:r,widget:l}},initEvents:function(){var e=this,t=e.opts;return e[0].delegate("mouseenter","._item > ._title",function(i){var n=this.parent().index(),r=t.switchType;e.enable()&&("mouseenter"===r&&e._items.items(n)!==e._current&&e.select(n),this.mouse({auto:!1,unselect:!0,click:function(){"click"===r&&e.select(n)},dblclick:function(){"dblclick"===r&&e.select(n)}},i))}),e}},"public":{items:function(e,t){var i=this;return i._items.items(e,t)},activeItem:function(e){var t=this;return void 0===e?t.indexOf(t._current):t.select(e)},template:function(e){var t=this,i=t.opts;return void 0===e?i.template:(isString(e)&&(e=Std.template(e)),e instanceof Std.template&&(i.template=e),t)},repaint:function(){var e=this,t=e._current;if(null!=t){var i=e.computeClientHeight();t.client.main.height(i),t[0].addClass("selected"),e.refreshClient(t.client,i)}return e},insert:function(e,t){var i=this,n=i.createItem(e);return-1!==t&&t<i.length?i[0].insertBefore(n[0],i._items._list[t][0]):i[0].append(n[0]),i._items.insert(n,t),i.rendered&&i.repaint(),i},append:function(e){var t=this,i=null;if(isArray(e))for(var n=0,r=e.length;r>n;n++)t._items.push(i=t.createItem(e[n])),t[0].append(i[0]);else t._items.push(i=t.createItem(e)),t[0].append(i[0]);return t.rendered&&t.repaint(),t},select:function(e){var t=this,i=t.opts,n=t._items.items(e),r=t.computeClientHeight(),l=t._current;return null==n?t:(null!=l&&(l[0].removeClass("selected"),l.client.main.css("overflow","hidden").animateTo({height:0},{duration:200,timingFunction:"ease"})),i.collapsible&&l===n?(t._current=null,t):(t._current!==n&&t.emit("change",n),n.client.main.removeClass("overflow").animateTo({height:r},{duration:200,timingFunction:"ease"},function(){t.refreshClient(n.client,r)}),t._current=n,t._current[0].addClass("selected"),t))},clear:function(){var e=this;return e._items.items(function(e,t){t[0].remove(),t.client.widget&&t.client.widget.destroy()}),e._items.clear(),e}},main:function(e,t){e._items=Std.items(),null!==t.template&&e.template(t.template),null!==t.items&&e.append(t.items),e.initEvents()},support:{rule:{children:"append"},html:{nodeName:["DIV"],create:function(e){this.append(e.children("ul",function(e,t){var i=t.children("li");if(i&&!(i.length<2)){var n=null,r=t.attr("std-content"),l=i[0],a=i[1];if(r&&"html"!==r)if("layout"==r){var c=a.attr("std-ui");c&&Std.ui(c)&&(n={layout:Std.ui.build(a,!1)})}else"iframe"==r?n={iframe:a.text()}:"data"==r&&(n=a.html().toObject());else n=a.html();return Std.extend({icon:l.attr("std-icon"),text:l.html(),content:n||{}},Std.options.get(t),3)}}))}}}});