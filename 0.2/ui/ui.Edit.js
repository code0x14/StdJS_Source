/**
    Std UI Kit Library
    http://ui.stdjs.com
    model: ui.Edit
	module: LineEdit,TextEdit
	Std.dom extend: editText
*/
Std.model("ui.Edit",{b:"widget",c:"focus blur change input",e:{min:"infinite",max:"infinite",value:"",type:"text",echoMode:"normal",fontSize:null,maxLength:0,readOnly:!1,showState:!1,placeHolder:null,placeHolderClass:""},h:{inputNodeName:"input",placeHolderVisible:!0,lastValue:""},g:{enable:function(t){var e=this,i=e.DOMMap.input,n="disabled";t===!1?i.attr(n,n):i.removeAttr(n)}},i:{init:function(){var t=this,e=t.opts;t.DOMMap={},t.type(e.type),t.echoMode(e.echoMode),t._lastValue=e.value,t.call_opts({value:"",readOnly:!1,maxLength:0,placeHolder:null},!0),t.call_opts({fontSize:null},!0),t.initEvents()},initPlaceHolder:function(){var t=this,e=t.opts;return t.DOMMap.placeHolder||(t.DOMMap.placeHolder=newDiv("_placeHolder "+e.placeHolderClass).appendTo(t[0]).unselect(!0)),""!==e.value?t.placeHolderVisible(!1):t._placeHolderVisible=!0,t},initInput:function(t){var e=this,i=e.opts,n=e.DOMMap;return n.input="password"===i.echoMode?new Std.dom(e._inputNodeName+"[type='password']"):newDom(e._inputNodeName),n.input.value(t),n.input.appendTo(e[0]).on("keydown keyup",Std.func(function(){e.placeHolderVisible(""===e.value())},5)),e},initInputEvent:function(){var t=this,e=t.opts,i=function(t,i){var n=t.which,a=t.keyCode,l=t.ctrlKey,o=i.value();if(t.shiftKey)return t.preventDefault();switch(!0){case 190===a&&!o.has(".")&&"int"!==e.type:isEmpty(o)&&i.value("0");break;case 173===a&&("infinite"===e.min||isNumber(e.min)&&e.min<0)&&!o.has("-"):case l&&(65===a||67===a):case a>36&&41>a:case 173===n&&0===o.length:case 8===a||13===a:case n>47&&58>n:case n>95&&106>n:break;case 9===a:break;default:t.preventDefault()}};t[0].on("click",function(){t.DOMMap.input.focus()}),t.DOMMap.input.on("change",function(){t.emit("change",e.value)}).on("keydown",function(e){Std.mold.or("number int",t.type())&&i(e,this)}).on("oninput"in t.DOMMap.input.dom?"input":"keyup",function(){var i=this.value();t.placeHolderVisible(""===i),Std.mold.or("number int",t.type())&&("infinite"!==e.min&&i<e.min?i=e.min:"infinite"!==e.max&&i>e.max&&(i=e.max),t.DOMMap.input.value(i=t.formatValue(i))),i!==t._lastValue&&t.emit("input",t._lastValue=e.value=i)})},initEvents:function(){var t=this,e=!1;return t[0].focussing(function(){0==e&&(e=!0,t.initInputEvent()),t.enable()&&(t.showState()&&t.removeClass("_state _success _error"),t.addClass("focused").emit("focus"),setTimeout(function(){t.DOMMap.input.focus()},1))},function(){t.enable()&&(t.showState()&&t.addClass(t.valid()?"_state _success":"_state _error"),t.removeClass("focused").emit("blur"),t.value(t.formatValue(t.DOMMap.input.value())))}),t[0].mouse(),t}},j:{showState:function(t){return this.opt("showState",t)},pattern:function(t){return this.opt("pattern",t)},select:function(){var t=this;return t.DOMMap.input.select(),t},focus:function(){var t=this;return t.DOMMap.input.focus(),t},blur:function(){var t=this;return t.DOMMap.input.blur(),t},maxLength:function(t){var e=this;return e.opt("maxlength",t,function(){e.DOMMap.input.attr("maxlength",t)})},lineHeight:function(t){var e=this;return e.opt("lineHeight",t,function(){e.DOMMap.input.lineHeight(t)})},fontSize:function(t){var e=this,i=e.DOMMap;return void 0==t?i.input.css("font-size"):(i.input.css("font-size",t),i.placeHolder&&i.placeHolder.css("font-size",t),e)},value:function(t){var e=this,i=e.DOMMap;return void 0===t?e.formatValue(i.input.value()):(null==t&&(t=""),e.placeHolderVisible(""===(t=e.formatValue(t))),e.rendered?e._lastValue!==t&&(i.input.value(e._lastValue=t),e.emit("change",t)):i.input.value(e._lastValue=t),e)},type:function(t){var e=this;return e.opt("type",t)},echoMode:function(t){var e=this,i=e.DOMMap;return this.opt("echoMode",t,function(){var t=e.rendered?e.value():e.opts.value;i.input&&(i.input.remove(),delete i.input),e.initInput(t)})},readOnly:function(t){var e=this,i=e.DOMMap.input;return e.opt("readOnly",t,function(){t===!0?i.attr("readOnly","readOnly"):i.attr("readOnly","")})},formatValue:function(t){var e=this,i=e.opts.type;return""===t?t:(Std.mold.or("number int",i)&&!isNumeric(t)&&(t=e._lastValue),t)},placeHolder:function(t){var e=this,i=e.DOMMap;return e.opt("placeHolder",t,function(){i.placeHolder||e.initPlaceHolder(),i.placeHolder.html(t)})},placeHolderVisible:function(t){var e=this,i=e.DOMMap;return void 0===t?e._placeHolderVisible:t!==e._placeHolderVisible&&i.placeHolder?(i.placeHolder.visible(e._placeHolderVisible=t),e):e},valid:function(){var t=this,e=t.type(),i=t.value(),n=t.validator();return Std.mold.or("number int",e)&&!isNumeric(i)?!1:"int"===e&&i.has(".")?!1:"email"!==e||/\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(text)?isFunction(n)?n(i):n in Std.validator?Std.validator[n](i):Std.is(n,i):!1}},k:function(t){t.init()},m:{rule:{content:"value"},html:{nodeName:["DIV"],create:function(t){this.value(t.html().trim())}}}}),Std.ui.module("LineEdit",{a:"ui.Edit",c:"focus blur change input open close",e:{level:3,label:null,labelClass:"",labelSide:"left",icon:"",iconSide:"left",dataList:null,listMaxHeight:300,minWidth:12,minHeight:12,iconWidth:22,iconHeight:22,defaultClass:"StdUI_LineEdit"},h:{inputNodeName:"input",listVisible:!1},g:{width:function(t){var e=this,i=e.opts,n=e.DOMMap,a=0,l=0,o=n.placeHolder,s=0,u=i.iconSide,r=i.labelSide;isNumber(t)||(t=e.width());var d=(t-=e.boxSize.width-e.boxSize.extraWidth)-4;if(n.label){var c=n.label.width()+e.labelBoxSize.width;"left"==r?a=2:"right"==r&&(l=2),o&&"left"==r&&(s=c+a),d-=c+2}n.icon&&("left"==u?a=2:"right"==u&&(l=2),o&&"left"==u&&(s+=i.iconWidth+a),n.label&&("left"==r&&"left"==u&&n.icon.marginLeft(2),"right"==r&&"right"==u&&n.icon.marginRight(2)),d-=i.iconWidth+2),0!==a&&n.input.marginLeft(a),0!==l&&n.input.marginRight(l),0!==s&&o.left(s),n.input.width(d)},height:function(t){var e=this,i=e.opts,n=e.DOMMap;isNumber(t)||(t=e.height()),t-=e.boxSize.height+e.boxSize.extraHeight,n.input.css({height:t,lineHeight:t}),n.placeHolder&&n.placeHolder.css({height:t}),n.label&&n.label.css({height:t}),n.icon&&i.iconHeight!=t&&n.icon.marginTop((t-i.iconHeight)/2),e[0].lineHeight(t)},destroy:function(){var t=this;t.DOMMap.dataList&&t.DOMMap.dataList.remove(),t._hideDataList&&Std.dom(document).off("click",t._hideDataList)},init_boxSize:function(){var t=this;t.DOMMap.label&&(t.labelBoxSize=t.DOMMap.label.boxSize())}},i:{initLabel:function(){var t=this,e=t.opts,i=t.DOMMap;return i.label=newDiv("_label "+e.labelClass).html(e.label),"left"==e.labelSide?i.label.prependTo(t):i.label.insertAfter(i.input),t},initIcon:function(){var t=this,e=t.opts,i=t.DOMMap;return i.icon=newDiv("_icon"),"left"==e.iconSide?i.icon.insertBefore(i.input):i.icon.insertAfter(i.input),Std.icon.update(i.icon,e.icon,{width:e.iconWidth,height:e.iconHeight}),t},initDataList:function(){var t=this,e=t.DOMMap,i=null;e.dataList=newDiv("StdUI_LineEdit_DataList").appendTo("body").unselect(!0).on("mouseenter mouseleave mousedown click",">._item",function(n){var a=n.name;"mouseenter"===a?this.addClass("hover"):"mouseleave"===a?this.removeClass("hover"):"mousedown"===a?(i&&i.removeClass("selected"),i=this.addClass("selected")):"click"===a&&(e.dataList.hide(),t.value(this.text()))}),t[0].on("dblclick",function(){t._listVisible||isEmpty(t.filterList(t.value()))||t.open()}),t.on("input",function(e){""===e||isEmpty(t.filterList(e))?t.close():t.open()}),Std.dom(document).on("click",t._hideDataList=function(t){e.dataList.contains(t.target)||e.dataList.hide()})}},j:{dataList:function(t){var e=this;return e.opt("dataList",t,function(){e.DOMMap.dataList||e.initDataList()})},filterList:function(t){var e=this,i=!1,n=[],a=Std.dom.fragment(),l=e.DOMMap.dataList;return l?(l.clear(),Std.each(e.dataList(),function(e,l){l.has(t)&&(i=!0,n.push(l),a.appendChild(newDiv("_item").html(l).dom))}),i&&l.append(a),n):e},open:function(){var t=this,e=t[0].offset(),i=t.opts.listMaxHeight,n=e.y+t.height()+1,a=t.DOMMap.dataList,l=0;return a?(a.removeStyle("height").show(),l=a.outerHeight(),isNumber(i)&&l>i&&a.outerHeight(l=i),n+l>Std.dom(window).height()&&(a.addClass("_top"),n=e.y-1-l),a.css({zIndex:++Std.ui.status.zIndex,left:e.x,top:n,outerWidth:t.width()}),t._listVisible||t.emit("open"),t._listVisible=!0,t):t},close:function(){var t=this,e=t.DOMMap.dataList;return e&&t._listVisible?(e.hide(),t.emit("close")):t},repaint:function(){var t=this;return t.size(t.width(),t.height()),t},icon:function(t){var e=this;return e.opt("icon",t,function(){e.DOMMap.icon||Std.icon.update(e.DOMMap.icon,t)})},iconSide:function(t){return this.opt("iconSide",t)}},k:function(t,e){t.init(),e.label&&t.initLabel(),e.icon&&t.initIcon(),isArray(e.dataList)&&t.initDataList()},m:{rule:{content:"value"},html:{nodeName:["DIV"],create:function(t){var e=t.children();e&&0!=e.length?this.dataList(Std.each(e,function(t,e){return e.text()},!0)):this.value(t.html().trim())}}}}),Std.ui.module("TextEdit",{a:"ui.Edit",e:{level:4,minWidth:28,minHeight:28,defaultClass:"StdUI_TextEdit"},h:{inputNodeName:"textarea"},g:{height:function(t){var e=this;isNumber(t)&&e.DOMMap.input.height(t-e.boxSize.height-e.boxSize.extraHeight)}}}),Std.dom.extend("editText",function(t){var e="StdUI_DOMEditText",i=this;if(i.hasData(e))return i;var n=Std.extend({text:null,type:"default",apply:null,change:null,offsetParent:null,className:e,multiLine:!1,changeText:!0,top:null,left:null,width:null,height:null,minWidth:null,minHeight:null,fixedWidth:!1,fixedHeight:!1,textSelected:!0},t);null==n.text&&(n.text=i.text());var a=0,l=0,o=0,s=0,u="float fontFamily fontSize textIndent paddingLeft paddingRight paddingTop paddingBottom lineHeight",r=newDom(n.multiLine?"textarea":"input",n.className).css({resize:"none",margin:0,padding:0}),d=newDom(i.nodeName(),i.className()).css({left:-999999,width:"auto",height:"auto",position:"absolute",visibility:"hidden"}).appendTo(i.parent()),c=function(t){var a=r.value();t&&r.is(t.target)||(r.remove(),d.remove(),i.removeData(e).show(),"fill"===n.type&&i.styleBack("position"),n.changeText&&i.html(a),isFunction(n.apply)&&n.apply.call(i,a,n.text),Std.dom(document).off("mousedown",c))},p=function(t){var e=r.value();if(d.html(e),!n.fixedWidth){var a=d.outerWidth();null!==n.minWidth&&a<n.minWidth&&(a=n.minWidth),r.outerWidth(a)}if(!n.fixedHeight){var l=d.outerHeight();null!==n.minHeight&&l<n.minHeight&&(l=n.minHeight),r.outerHeight(l)}t&&isFunction(n.change)&&n.change.call(i,e)};if("default"===n.type)r.insertAfter(i.hide());else if(null!==n.top&&(a=n.top),null!==n.left&&(l=n.left),"fill"===n.type)"static"===i.css("position")&&i.styleTo("position","relative"),i.clear().append(r.css({position:"absolute",zIndex:Std.ui.status.zIndex+1,top:a,left:l}));else if("cover"===n.type){var h=i.offset();r.appendTo("body").css({position:"absolute",zIndex:Std.ui.status.zIndex+1,top:null===n.top?h.y:a,left:null===n.left?h.x:l})}return Std.each(u,function(t,e){var n=i.css(e);d.css(e,n),r.css(e,n)}),n.css&&r.css(n.css),(isString(n.text)||isNumber(n.text))&&r.value(n.text),n.fixedWidth&&(o=null===n.width?i.outerWidth():n.width,"fill"===n.type&&(o-=i.css("borderLeftWidth")+i.css("borderRightWidth")),r.outerWidth(o)),n.fixedHeight&&(s=null===n.height?i.outerHeight():n.height,"fill"===n.type&&(s-=i.css("borderTopWidth")+i.css("borderBottomWidth")),r.outerHeight(s)),n.textSelected&&r.select(),p()||r.data(e,1).focus().on({blur:c,mousedown:function(t){t.stopPropagation()},keydown:function(e){13!==e.keyCode||!e.ctrlKey&&t.multiLine||c()}}).on("oninput"in i.dom?"input":"keydown",p),Std.dom(document).on("mousedown",c),r});