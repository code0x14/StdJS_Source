/**
    Std UI Kit Library
    http://ui.stdjs.com
	module: TaskBarItem,TaskBar
*/
Std.ui.module("TaskBarItem",{b:"Item",c:"active select",e:{activated:!1,selected:!1,defaultClass:"StdUI_Item StdUI_TaskBarItem"},j:{selected:function(e){var t=this;return t.opt("selected",e,function(){t[0].toggleClass("selected",e),t.emit("select",e),t.parent().emit("itemSelect",[e,t],!0)})},activated:function(e){var t=this;return t.opt("activated",e,function(){var i=t.parent();t[0].toggleClass("activated",e),t.emit("active",e),i.emit("itemActive",[e,t],!0),e===!1&&(t.selected()&&i.reselect(t),t[0].removeClass("hover"),t.selected(!1))})},updateStyle:function(e,t,i){var n=this;!n.iconHeight()!==t/2&&n.iconHeight(t/2).iconWidth(t/2),e!==n._spacing&&n[0].marginRight(n._spacing=e),n.height(t).width(i)}},k:function(e){e.call_opts({activated:!1,selected:!1},!0)}}),Std.ui.module("TaskBar",{b:"widget",c:"itemClick itemActive itemSelect itemContextMenu",e:{level:3,defaultClass:"StdUI_TaskBar",items:null,spacing:8,minItemHeight:26,tabIndex:null,multiRow:!0,taskMenu:null},h:{selectedItem:null},n:{initDocEvents:function(){var e=this;Std.dom(document).on("mousedown",e._docEvents=function(t){e._taskMenu&&!e._taskMenu[0].contains(t.target)&&e._taskMenu.hide()})},initTaskMenu:function(){var e=this,t=e.opts;e._taskMenu=isWidget(t.taskMenu)?t.taskMenu:Std.ui("Menu",t.taskMenu),isWidget(e._taskMenu)&&(e._taskMenu[0].css("position","absolute"),e._taskMenu.on({itemPress:function(){e._taskMenu.hide()}}).renderTo("body"))},initEvents:function(){var e=this,t=e.opts;e[0].on("contextmenu",function(e){e.preventDefault()}),e[0].on("mouseenter",">.StdUI_Item",function(){this.mouse({auto:!1,unselect:!0,click:function(t){return e.itemClick(t,this)}})}).on("contextmenu",">.StdUI_Item",function(i){if(!e._taskMenu&&isObject(t.taskMenu)&&e.initTaskMenu(),isWidget(e._taskMenu)){var n=e._taskMenu.show(),s=i.pageX,a=i.pageY,d=n.width(),u=n.height();s+d>Std.dom(window).width()&&(s=Std.dom(window).width()-d),n.toForeground()[0].css({top:a-u,left:s})}e.emit("itemContextMenu",[i,this.ui()],!0),i.preventDefault()})}},g:{render:function(){var e=this;isEmpty(e._items)||(Std.each(e._items,function(e,t){t.render()}),e.update()),e.initEvents(),e.initDocEvents()},destroy:function(){var e=this;isWidget(e._taskMenu)&&e._taskMenu.remove(),e._docEvents&&Std.dom(document).off("mousedown",e._docEvents)},remove:function(e){var t=this,i=t._items;if(isNumber(e))t.reselect(i[e]),i[e].remove(),i.remove(e);else if(isWidget(e)){var n=i.indexOf(e);-1!==n&&(t.reselect(e),i[n].remove(),i.remove(n))}}},i:{reselect:function(e){for(var t=this,i=t._items,n=i.indexOf(e),s=i.length,a=-1,d=n+1;s>d;d++)if(i[d].activated()){a=d;break}if(-1==a)for(var d=n-1;d>=0;d--)if(i[d].activated()){a=d;break}return-1!==a&&(t._selectedItem=i[a].selected(!0)),t},itemClick:function(e,t){var i=this,n=t.index(),s=i._items[n];i.select(s,!s.selected()),i.emit("itemClick",[e,n,s],!0)},createItem:function(e){var t=this,i=null;return isWidget(e)?i=e:isObject(e)?i=Std.ui(e.ui||"TaskBarItem",e||{}):(isString(e)||isNumber(e))&&(i=Std.ui("TaskBarItem",{text:e})),isWidget(i)&&(i.parent(t),i.verticalAlign("middle"),i.appendTo(t[0]),t.rendered&&i.render()),i},update:function(){var e=this,t=e.opts,i=e._items.length,n=e.width()-e.boxSize.width-e.boxSize.extraWidth,s=e.height()-e.boxSize.height-e.boxSize.extraHeight,a=t.spacing,d=5,u=200>n/d?n/(d=Math.floor(n/200)):n/d;return u*i>n&&(s/t.minItemHeight>=2&&t.multiRow?u*(s/=2)>=n&&i>=2*d&&(u=Math.floor(i%2==0?2*n/i:2*n/(i+1))):u=Math.floor((n-a)/i)),Std.each(e._items,function(e,t){t.updateStyle(a,s,u-a<s/2+t.boxSize.width?s/2+t.boxSize.width:u-a)}),e}},j:{items:function(e,t){return this._items.items(e,t)},add:function(e){var t=this,i=t.createItem(e);return null!==i&&t._items.push(i),i},taskMenu:function(e){var t=this;return t.opt("taskMenu",e,function(){t._taskMenu&&(t._taskMenu.remove(),t._taskMenu=null)})},select:function(e,t){var i=this;if(isNumber(e)&&(e=i._items[e]),t===!0){if(i._selectedItem===e&&e.selected())return i;e.activated()||e.activated(!0),i._selectedItem&&i._selectedItem.selected(!1),i._selectedItem=e.selected(!0)}else e.activated()&&e.activated(!1),e.selected(!1),i.reselect(e);return i},append:function(e){var t=this;return isArray(e)?Std.each(e,function(e,i){t.add(i)}):t.add(e),t.rendered&&t.update(),t}},k:function(e,t){e._items=[],t.items&&e.append(t.items)},m:{rule:{children:"append"},html:{create:function(e,t){this.append(Std.each(t,function(e,t){var i=t.attr("type"),n=t.attr("std-ui");return n&&Std.ui(n)?Std.ui.build(t,!1):"data"===i?t.html().toObject():Std.options.get(t)},!0))}}}});