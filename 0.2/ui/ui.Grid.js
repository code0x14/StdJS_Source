/**
    Std UI Kit Library
    http://ui.stdjs.com
	module: Grid
*/
!function(){var e=null,t=null,n=null,o=null,r=null,i=null,l=null,a=null,d=null,s=Std.ui.module("Grid",{b:"widget",c:"scroll clearRows clear dataSourceMessage selectionModeChange columnEvent rowEvent cellEvent cellEdit rowResizeStart rowResizeStop columnResizeStart columnResizeStop columnDropStart columnDropStop",e:{defaultClass:"StdUI_Grid",level:4,minWidth:120,minHeight:60,rows:null,rowHeight:30,rowCount:0,rowNumbers:!1,rowCheckable:!1,rowLabels:!1,rowResizable:!1,rowExtensible:!1,rowContentHeight:100,rowNumberWidth:40,rowLabelWidth:60,rowCheckBoxWidth:35,rowExpanderWidth:30,rowContextMenu:null,stripeRows:!1,verticalLine:!0,horizontalLine:!0,cellPadding:3,cellTextAlign:"left",cellEditable:!1,cellEditMode:"dblclick keypress",cellCoordText:"cell index <?=row?>:<?=col?>",cellContextMenu:null,mergedCells:null,columns:null,columnCount:0,columnHeight:29,columnWidth:80,columnPadding:3,columnTextAlign:"left",columnMenu:!1,columnDroppable:!1,columnResizable:!1,columnSortable:!1,columnContextMenu:null,columnSortMode:"click",headerVisible:!0,dataSource:null,deferRender:!0,scrollDelay:null,autoClean:!0,hoverMode:"row",selectionMode:"cells",selectionMarked:!0,valueType:"list"},f:{childModules:{}},h:{rangeStart:-1,rangeEnd:-1},n:{initEvents:function(){var e=this,t=e.DOMMap;e[0].on("keydown",function(e){e.keyCode}),t.table.unselect(!0).on("click",function(){})},initScrollEvent:function(){var e=this,t=e.DOMMap;t.viewBody.scrollTop(t.dataBody.scrollTop()),t.dataBody.on("scroll",function(){var n=this.scrollTop(),o=this.scrollLeft();t.viewBody.scrollTop(n),t.dataColumns.css("left",-o),e.emit("scroll",[n,o],!0)})},initChildModules:function(){var c=s.childModules;n=n||c.column,e=e||c.cell,t=t||c.row,r=r||c.mergedCells,o=o||c.container,i=i||c.selection,l=l||c.style,a=a||c.ViewBody,d=d||c.plugin},initColumnEvents:function(){var e=this,t=(e.opts,e.DOMMap);t.dataColumns.on("mouseenter","> ._column",function(n){var o=this.index(),r=e._columns[o],i={auto:!1};Std.each(["enter","leave","down","up","click","dblclick"],function(n,l){i[l]=function(n){if("down"===l){var i=t.dataColumns.plugin("resize");if(i&&0!==i.cursorCode)return;e.currentColumnIndex(o)}r.sortable()&&"down"===l||e._selection.columnEvents(n.name,r,n),r.triggerEvents(n.name,n),e.emit("columnEvent",[n.name,r,n],!0)}}),this.mouse(i,n)})},initRowEvents:function(){var e=this,t=e.opts,n=e.DOMMap;e._viewBody.initRowEvents(),n.dataBodyRows.on("mouseenter","> ._row",function(n){var o=this.data("row"),r={auto:!1,classStatus:"row"===t.hoverMode};Std.each(["enter","leave","down","up","click","dblclick"],function(t,n){r[n]=function(t){"down"===n&&Std.mold.or("INPUT TEXTAREA",t.target.nodeName)||e._selection.rowEvents(t.name,o,t),e.emit("rowEvent",[t.name,o,t],!0)}}),this.mouse(r,n)})},initCellEvents:function(){var e=this,t=e.opts,n=e.DOMMap,o=function(n,o,r){var i={auto:!1,classStatus:"cell"===t.hoverMode};Std.each(["enter","leave","down","up","click","dblclick"],function(t,n){i[n]=function(t){"down"===n&&Std.mold.or("INPUT TEXTAREA",t.target.nodeName)||(o.triggerEvents(t.name,t),e._selection.cellEvents(t,t.name,o,r)),e.emit("cellEvent",[t.name,o,t],!0)}}),o[0].mouse(i,n)};n.dataBody.on("mouseenter",">._cells > ._cell",function(e){return o(e,this.data("cell"),null)}),n.dataBody.on("mouseenter",">._rows > ._row > ._cells > ._cell",function(e){var t=this.parent("._row").data("row"),n=this.index(),r=t.cells[n];return o(e,r,n)})},initDOMTree:function(){var e=this,t=e.opts,n=e.DOMMap={},o=t.defaultClass;n.table=newDom("table").append(n.tbody=newDom("tbody").append([n.header=newDom("tr",o+"_Header"),n.body=newDom("tr",o+"_Body")])).appendTo(e[0]),n.header.append([n.viewHeaderTD=newDom("td").append(n.viewHeader=newDiv(o+"_ViewHeader").append(n.viewColumns=newDiv("_columns"))),n.dataHeaderTD=newDom("td").append(n.dataHeader=newDiv(o+"_DataHeader").append(n.dataColumns=newDiv("_columns")))]),n.body.append([n.dataBodyTD=newDom("td").append(n.dataBody=newDiv(o+"_DataBody").append([newDiv("_placeHolder"),n.dataBodyRows=newDiv("_rows").append(n.dataBodyLines=newDiv("_lines"))]))]),e._viewBody.initDOMTree()},initDataSource:function(){var e=this,t=e.opts,n=e.dataSource=Std.dataSource(t.dataSource),o=!0;"data"===n.type()&&(n.data=e._rows),n.on("error",function(){!o&&e._container.length>0&&e.clearRows()}).on("message",function(t){"rows"===t.name&&(!o&&e._container.length>0&&e.clearRows(),isArray(t.value)&&e.appendRow(t.value),o=!1),e.emit("dataSourceMessage",t)}).call("rows").call("data",function(n,o){isObject(o.cellModel)&&e.cellModel(o.cellModel),isNumber(o.columnCount)&&e.columnCount(o.columnCount),isNumber(o.rowCount)&&e.rowCount(o.rowCount),isArray(t.mergedCells)&&e.mergeCell(t.mergedCells),isArray(o.columns)&&e.appendColumn(o.columns),isArray(o.rows)&&e.appendRow(o.rows)})}},g:{render:function(){var e=this,t=e.opts;e._style.update(),e._container.init(),e.initEvents(),e.initScrollEvent(),e.initColumnEvents(),e.initCellEvents(),e.initRowEvents(),e.call_opts({cellContextMenu:null,rowContextMenu:null,columnContextMenu:null},!0),t.dataSource&&e.initDataSource()},width:function(e){var t=this,n=t.boxSize,o=t.DOMMap,r=t._viewBody.width();isNumber(e)||(e=t.width()),e=e-n.width-n.extraWidth,o.table.width(e),o.dataBody.width(t._dataBodyWidth=e-r),t._viewBody.updateWidth(),t._selection.update(),t.updateColumnsWidth()},height:function(e){var t=this,n=t.opts,o=t.DOMMap,r=t.boxSize;isNumber(e)||(e=t.height()),e=e-r.height-r.extraHeight,o.table.height(e),n.headerVisible&&(e-=n.columnHeight),o.header.height(n.columnHeight),o.dataBody.height(e),t._viewBody.height(e),t._container.rangeHeight(e)},destroy:function(){var e=this;e._inputElem&&(e._inputElem.remove(),e._inputElem=null),e._style.destroy(),e._container.destroy()}},"protected":{computeColumnsWidth:function(e){var t=this,n=t.opts;if(void 0===e){for(var o=0,r=0,i=n.columnCount;i>o;o++)t._columns[o].visible()&&(r+=t._columns[o].width());return r}},computeRowTop:function(e){var t=this,n=t._container;return isString(e)&&(e=n.itemName2Index(e)),n.computeItemTop(e)},computeColumnLeft:function(e){var t=this,n=t._columns;isString(e)&&(e=t._columnsMap[e]);for(var o=0,r=0;e>o;o++)n[o].visible()&&(r+=n[o].width());return r},createContainer:function(){var e=this,n=e.opts;return e._container=new o({items:e._rows,parent:e,monitor:e.DOMMap.dataBody,deferRender:n.deferRender,scrollDelay:n.scrollDelay,autoClean:n.autoClean,container:e.DOMMap.dataBodyRows,itemHeight:n.rowHeight,itemRender:function(n){return new t(n,e)},scroll:function(t){e.DOMMap.viewBody.scrollTop(t)},appear:function(e,t,n){t.update(n)},updateCurrentRange:function(t,o,r){e._rangeStart=t,e._rangeEnd=o,e._mergedCells.update(),(n.rowNumbers||n.rowCheckable||n.rowLabels||n.rowExtensible)&&(e.DOMMap.viewBodyRows.css("top",r),e.updateRangeRows(t,o))}}),e},updateColumnsWidth:function(e){for(var t=this,n=0,o=!1,r=t.columnCount();r>n;n++){var i=t._columns[n];if(isString(i.opts.width)){o=!0;break}}return e!==!1&&o===!0&&t.rendered===!0&&t._style.update(),t},updateColumnsClass:function(e){for(var t=this,n=t._columns,o=e||0,r=n.length;r>o;o++)n[o][0].className("_column _column"+o);return t},updateColumnsNameIndex:function(){var e=this;return Std.each(e._columns,function(t,n){var o=n.name();"string"==typeof o&&(e._columnsNameIndex[o]=t)}),e},updateRangeRows:function(e,t){for(var n=this,o=n._container._items,r=n._viewBody._rows,i=n._selection._markedRows,l=n.opts.selectionMode,a=0,d=!1,s=0,c=0;t-e>=a;a++){var u=o[e+a],h=u.data,m=r[a];if(m||(m=r[a]={row:newDiv("_row").insertBefore(n.DOMMap.viewBodySpacing)}),"checked"===l){var p=u.owner[0].hasClass("selected");h.checked===!0?p||u.owner[0].addClass("selected"):p&&u.owner[0].removeClass("selected")}m.index=e+a,m.row.data("viewRow",m),n._viewBody.updateViewRow(m,u.owner);var g="height"in m?m.height:n.opts.rowHeight;i&&n._viewBody.updateRowMark(a)&&(m.marked&&(d=!0,c+=g),d===!1&&(s+=g))}if(r.length>t-e)for(a=r.length-1;a>t-e;a--)a>=0&&(r[a].row.remove(),r.remove(a));return i&&n.DOMMap.viewSelection.css({top:s-1,height:c+1}),n}},j:{indexOf:function(e,t){return this._container.indexOf(e,t)},column:function(e){var t=this;return isString(e)?t._columnsMap[e]||null:t._columns[e]||null},row:function(e){var t=this,n=t._container.items(e);return null!==n?n.data:null},cell:function(e,t,n){var o=this,r=o._container.items(e),i=null;if(null===r)return i;if(isNumber(t)&&!isArray(r.data.cells)){if(!(t<o.opts.columnCount))return i;t=o._columns[t].name()}else if(isString(t)&&isArray(r.data.cells)){if(!(t in o._columnsNameIndex))return i;t=o._columnsNameIndex[t]}return void 0===n?r.data.cells&&(i=r.data.cells[t]):(r.data.cells[t]=i=n,r.owner&&r.owner.updateCell(t,n,!1)),void 0===i?null:i},selectedRange:function(){return this._selection.selectedRange()},selectedRanges:function(){return this._selection.selectedRanges()},selectedCell:function(e){var t=this._selection.selectedCell();return null!==t&&e===!0?this.cell(t.rowIndex,t.colIndex):t},selectedCells:function(e){var t=this._selection.selectedCells();if(null!==t&&e===!0)for(var n=0,o=t.length;o>n;n++)t[n]=this.cell(t[n].rowIndex,t[n].colIndex);return t},selectedRow:function(e){var t=this._selection.selectedRow();return null!==t&&e===!0?this.row(t):t},selectedRows:function(e){var t=this._selection.selectedRows();if(null!==t&&e===!0)for(var n=0,o=t.length;o>n;n++)t[n]=this.row(t[n]);return t},checkedRows:function(e){for(var t=this,n=t._container._items,o=[],r=0,i=n.length;i>r;r++)n[r].data.checked&&o.push(e===!0?r:n[r].data);return o},cellContextMenu:function(e){return this.opt("cellContextMenu",e,function(){this._plugin.initCellContextMenu()})},rowContextMenu:function(e){return this.opt("rowContextMenu",e,function(){this._plugin.initRowContextMenu()})},columnContextMenu:function(e){return this.opt("columnContextMenu",e,function(){this._plugin.initColumnContextMenu()})},stripeRows:function(e){return this.opt("stripeRows",e,function(){this.rendered&&this._container.update()})},selectionMarked:function(e){return this.opt("selectionMarked",e)},selectionMode:function(e){return this.opt("selectionMode",e,function(){this._selection._mode!==e&&this.emit("selectionModeChange",this._selection._mode=e)})},verticalLine:function(e){return this.opt("verticalLine",e,function(){this.rendered&&this._style.update()})},horizontalLine:function(e){return this.opt("horizontalLine",e,function(){this.rendered&&this._style.update()})},headerVisible:function(e){var t=this;return t.opt("headerVisible",e,function(){t.DOMMap.header.visible(e),t.rendered&&t.resize("height")})},cellEditable:function(e){return this.opt("cellEditable",e)},cellEditMode:function(e){return this.opt("cellEditMode",e)},cellCoordText:function(e){return this.opt("cellCoordText",e)},cellModel:function(e,t){var n=this;if(void 0===e)return n._cellModel;if(void 0!==t)n._cellModel[e]=t;else{if("string"==typeof e)return n._cellModel[e]||null;"object"==typeof e&&(Object.clear(n._cellModel),Std.extend(n._cellModel,e))}return n},mergeCell:function(e){return this._mergedCells.append(e),this},unmergeCell:function(e,t){var n=this,o=n._mergedCells;return isObject(e)&&"startRow"in e&&"startCol"in e&&(t=e.startCol,e=e.startRow),o.remove(e,t),n},lockCell:function(){},columnSortable:function(e){return this.opt("columnSortable",e)},columnSortMode:function(e){return this.opt("columnSortMode",e)},columnResizable:function(e){return this.opt("columnResizable",e,function(){e&&this._plugin.initColumnResizePlugin()})},columnDroppable:function(e){return this.opt("columnDroppable",e,function(){e&&this._plugin.initColumnDropPlugin()})},columnVisible:function(e,t){var n=this,o=n.column(e);return void 0===t?o.visible():(o.visible(t),n)},columnName2Index:function(e){var t=this,n=t._columnsNameIndex;return e in n?n[e]:-1},insertColumn:function(e,t){var o=this,r=o.opts,i=new n(e,o),l=o._columns;!isNumber(t)||-1===t||t>l.length?t=l.length:o._mergedCells.adjustRange("insertColumn",t),Std.each(o._columnsNameIndex,function(e,n){n>=t&&(o._columnsNameIndex[e]=n+1)});for(var a=0,d=o._container.length;d>a;a++){var s=o._container._items[a],c=s.owner,u=s.data.cells;u&&(u instanceof Array?u.insert(null,t):e.name&&(u[e.name]=null)),c&&c.insert(e.name,t)}return r.columnCount<=l.length&&r.columnCount++,e.name&&(o._columnsMap[e.name]=i,o._columnsNameIndex[e.name]=t),l.insert(i,t),i[0].insertTo(o.DOMMap.dataColumns,t),o.rendered&&(o._mergedCells.update(),o._selection.update(),o._container.update(),o._style.update()),o.updateColumnsClass()},appendColumn:function(e){var t=this,o=t.opts,r=t._columns,i=function(e){var i=new n(e,t);i[0].addClass("_column"+r.length).appendTo(t.DOMMap.dataColumns),e.name&&(t._columnsMap[e.name]=i,t._columnsNameIndex[e.name]=r.length),o.columnCount<=r.length&&o.columnCount++,r.push(i)};if(isArray(e))for(var l=0,a=e.length;a>l;l++)i(e[l]);else isObject(e)&&i(e);return t.rendered&&t._container.update()&&t._style.update(),t},sortColumn:function(e,t){var n=this,o=n.column(e);return o&&o.sortable()?(o.sort(t),n):n},moveColumn:function(e,t,o){var r=this,i=-1,l=-1,a=r._columns;if(e instanceof n?i=a.indexOf(e):isNumber(e)&&(e=a[i=e]),t instanceof n?l=a.indexOf(t):isNumber(t)&&(t=a[l=t]),i===l||e===t)return r;"after"===o?e[0].insertAfter(t[0]):e[0].insertBefore(t[0]),a.move(i,l=e[0].index());for(var d=0,s=r._container.length;s>d;d++){var c=r._container._items[d],u=c.owner,h=c.data.cells;u?u.moveCell(i,l):h&&h instanceof Array&&h.move(i,l)}return r.updateColumnsNameIndex(),r._mergedCells.adjustRange("move",i,l),r.rendered&&(r._container.update(),r._style.update(),r._selection.update(),r._mergedCells.update()),r.updateColumnsClass()},removeColumn:function(e){var t=this,n=t.opts,o=function(o){var r=null,i=null;isString(o)?(r=o,i=t._columnsNameIndex[r]):isNumber(o)&&(i=o,r=t._columns[i].name()),isString(r)&&(delete t._columnsMap[r],delete t._columnsNameIndex[r]),isNumber(i)&&(t._columns[i].destroy(),t._columns.remove(i));for(var l=0,a=t._container.length;a>l;l++){var d=t._container._items[l],s=d.owner,c=d.data.cells;s?s.removeCell(e):c&&(c instanceof Array?c.remove(i):delete c[r])}n.columnCount--,t._mergedCells.adjustRange("removeColumn",i)};if(isArray(e))for(var r=0,i=e.length;i>r;r++)o(e[r]);else o(e);return t.updateColumnsClass(),t.updateColumnsNameIndex(),t.updateColumnsWidth(!1),t.rendered&&(t._selection.clear(),t._mergedCells.update(),t._container.update(),t._style.update()),t.emit("removeColumn",e)},columnCount:function(e){var t=this,n=t._columns.length;if(void 0===e)return n;if(e>n){for(var o=new Array(6),r=[],i=function(e){void 0===o[e=void 0===e?5:e]?o[e]=65:90===o[e]?(i(e-1),o[e]=65):o[e]++},l=0;e>l;l++)if(i()||l>=n){for(var a="",d=0;6>d;d++)isNumber(o[d])&&(a+=String.fromCharCode(o[d]));r.push({text:a})}t.appendColumn(r)}else if(n>e)for(var l=n;l>e;l--)t.removeColumn(l-1);return t},rowName2Index:function(e){return this._container.itemName2Index(e)},rowHeight:function(e){var t=this;return t.opt("rowHeight",e,function(){t._container.itemHeight(e),t.rendered&&t._style.update()})},rowResizable:function(e){return this.opt("rowResizable",e,function(){e&&this._plugin.initRowResizePlugin()})},rowCheckable:function(e){var t=this,n=t.opts,o=t.DOMMap,r=t._viewColumns;return t.opt("rowCheckable",e,function(){t._viewBody.initCheckboxEvents(),e&&!r.checkbox?o.viewColumns.append(r.checkbox=newDiv("_column").width(n.rowCheckBoxWidth-2).append(o.checkbox=newDiv("StdUI_Grid_CheckBox"))):!e&&r.checkbox&&(r.checkbox.remove(),o.checkbox.remove(),delete o.checkbox,delete r.checkbox),t.rendered&&t._style.update()&&t.resize("width")&&t._container.update()})},rowNumbers:function(e){var t=this,n=t.opts,o=t.DOMMap,r=t._viewColumns;return t.opt("rowNumbers",e,function(){e&&!r.number?o.viewColumns.prepend(r.number=newDiv("_column").width(n.rowNumberWidth-2)):!e&&r.number&&(r.number.remove(),delete o.number,delete r.number),t.rendered&&t._style.update()&&t.resize("width")&&t._container.update()})},rowLabels:function(e){var t=this,n=t.opts,o=t.DOMMap,r=t._viewColumns;return t.opt("rowLabels",e,function(){e&&!r.label?o.viewColumns.append(r.label=newDiv("_column").width(n.rowLabelWidth-2)):!e&&r.label&&(r.label.remove(),delete o.label,delete r.label),t.rendered&&t._style.update()&&t.resize("width")&&t._container.update()})},rowExtensible:function(e){var t=this,n=t.opts,o=t.DOMMap,r=t._viewColumns;return t.opt("rowExtensible",e,function(){t._viewBody.initExpanderEvents(),e&&!r.expander?o.viewColumns.append(r.expander=newDiv("_column").width(n.rowExpanderWidth-2).append(o.expander=newDiv("_expander"))):!e&&r.expander&&(r.expander.remove(),o.expander.remove(),delete o.expander,delete r.expander),t.rendered&&t._style.update()&&t.resize("width")&&t._container.update()})},rowCount:function(e){var t=this,n=t._container.length;if(void 0===e)return n;if(e>n){for(var o=0,r=[];e-n>o;o++)r[o]={};t._container.append(r)}else if(n>e){for(var i=[];n>e;n--)i.push(n-1);t._container.remove(i)}return t},insertRow:function(e,t){var n=this;return isNumber(t)&&t>=0&&t<n._container.length&&n._mergedCells.adjustRange("insertRow",t),n._container.insert(e,t),n.rendered&&(n._mergedCells.update(),n._selection.update()),n},appendRow:function(e){var t=this;return t._container.append(e),t},removeRow:function(e){var t=this;if(isNumber(e))e<t._container.length&&t._mergedCells.adjustRange("removeRow",e);else if(isArray(e)){e.sort(function(e,t){return t-e});for(var n=0,o=e.length;o>n;n++)e[n]<t._container.length&&t._mergedCells.adjustRange("removeRow",e[n])}return t._container.remove(e),t.rendered&&(t._selection.clear(),t._mergedCells.update()),t},currentColumnIndex:function(e){var t=this._currentIndex;return void 0===e?t.column:(t.column=e,this)},currentRowIndex:function(e){var t=this._currentIndex;return void 0===e?t.row:(t.row=e,this)},currentCellIndex:function(e){var t=this._currentIndex;return void 0===e?t.cell:(t.cell=e,this)},scrollTop:function(e){var t=this,n=t.DOMMap.dataBody;return void 0===e?n.scrollTop():(n.scrollTop(e),t)},scrollLeft:function(e){var t=this,n=t.DOMMap.dataBody;return void 0===e?n.scrollLeft():(n.scrollLeft(e),t)},gotoRow:function(e,t){var n=this,o=n.computeRowTop(e);return isNumber(t)&&(o+=t),n.scrollTop(o),n},selectColumn:function(e){var t=this;return isString(e)&&(e=t.columnName2Index(e)),-1!==e&&t._selection.selectColumn(e),t},selectRow:function(e){var t=this;return isString(e)&&(e=t.rowName2Index(e)),-1!==e&&t._selection.selectRow(e),t},selectCell:function(e,t){var n=this;return isString(e)&&(e=n.rowName2Index(e)),isString(t)&&(t=n.columnName2Index(t)),-1!==e&&-1!==t&&n._selection.selectCell(e,t),n},selectRange:function(e,t,n,o){var r=this;return isString(e)&&(e=r.rowName2Index(e)),isString(t)&&(t=r.columnName2Index(t)),isString(n)&&(n=r.rowName2Index(n)),isString(o)&&(o=r.columnName2Index(o)),-1!==e&&-1!==t&&-1!==n&&-1!==o&&r._selection.selectRange(e,t,n,o),r},clearRows:function(){var e=this;return e._selection.clear(),e._container.clear(),e._mergedCells.clear(),e._viewBody.clear(),e.rowCount(0),e.emit("clearRows")},clear:function(){var e=this;return e.clearRows(),e.columnCount(0),e.emit("clear")},value:function(e){var t=this,n=t.opts,o=n.valueType,r=n.value;if(void 0===e){var i=null;return null===o?r:("list"===o?i=t._container._items:"map"===o&&(i=t._container._itemsMap),Std.each(i,function(e,t){return t.data.cells},!0))}return null===o&&(n.value=e),t},refresh:function(){var e=this;return e.updateColumnsClass(),e.updateColumnsNameIndex(),e.updateColumnsWidth(!1),e.rendered&&(e._selection.clear(),e._mergedCells.update(),e._container.update(),e._style.update()),e}},k:function(e,t){e.initChildModules(),e.addClass(e._identifier=t.defaultClass+Date.now()),e._viewBody=new a(e),e._style=new l(e),e._selection=new i(t.selectionMode,e,t),e._mergedCells=new r(e),e._plugin=new d(e),e._rows=[],e._columns=[],e._columnsMap={},e._columnsNameIndex={},e._viewColumns={},e._cellModel={},e._currentIndex={cell:null,row:null,column:null},e.initDOMTree(),e.createContainer(),t.rows&&e.appendRow(t.rows),t.columns&&e.appendColumn(t.columns),t.mergedCells&&e.mergeCell(t.mergedCells),e.call_opts({headerVisible:!0,cellModel:null,rowNumbers:!1,rowCheckable:!1,rowLabels:!1,rowResizable:!1,rowExtensible:!1,columnResizable:!1,columnDroppable:!1,columnSortable:!1,columnCount:0,rowCount:0},!0)},m:{rule:{children:"appendRow"},html:{nodeName:["DIV"],create:function(e){var t=[],n=[],o=function(e){Std.each(e.children(),function(e,n){t.push(Std.extend({text:n.trimHTML(),name:n.attr("std-name")},Std.options.get(n),3))})},r=function(e){n.push(Std.extend({cells:Std.each(e.children(),function(e,t){return t.html().trim()},!0)},Std.options.get(e)))},i=function(e){Std.each(e,function(e,t){"UL"===t.nodeName()&&o(t)})},l=function(e){Std.each(e,function(e,t){"UL"===t.nodeName()&&r(t)})};e.children(function(e,t){var n=t.attr("std-type"),o=t.children();"header"===n?i(o):"body"===n&&l(o)}),this.appendColumn(t),this.appendRow(n)}}}})}(),function(){Std.ui("Grid").childModules.column=Std.module({e:{name:null,parent:null,visible:!0,sortable:!0,droppable:!0,resizable:!0,editable:!0,className:"",text:"column",textAlign:"left",cellModel:null,cellFormatter:null},"protected":{destroy:function(){var e=this;return e[0].remove(),e},width:function(e){var t=this,n=t.opts,o=t.grid;return void 0===e?n.visible?null==n.width?o.opts.columnWidth:isString(n.width)?o._dataBodyWidth*(Std.convert.percent(n.width)/100):n.width:0:(n.width=e,o.rendered&&o._style.update(),t)},triggerEvents:function(e){var t=this,n=t.grid,o=t.sortable(),r=n.columnSortMode().split(" "),i="asc"===t._sortType?"desc":"asc";"click"===e?o&&r.has("click")&&t.sort(i):"dblclick"===e&&o&&r.has("dblclick")&&t.sort(i)}},j:{name:function(){return this.opt("name")},index:function(){return this.grid._columns.indexOf(this)},editable:function(e){return this.opt("editable",e)},resizable:function(e){return void 0===e?this.grid.columnResizable()&&this.opts.resizable:(this.opts.resizable=e,this)},droppable:function(e){return void 0===e?this.grid.columnDroppable()&&this.opts.droppable:(this.opts.droppable=e,this)},sortable:function(e){return void 0===e?this.grid.columnSortable()&&this.opts.sortable:(this.opts.sortable=e,this)},visible:function(e){var t=this.grid;return this.opt("visible",e,function(){this[0].visible(e),t.rendered&&(t.resize("width"),t._selection.clear(),t._mergedCells.update(),t._style.update())})},textAlign:function(e){return this.opt("textAlign",e,function(){})},text:function(e){return this.opt("text",e,function(){this.DOMMap.content.html(e)})},cellCSS:function(e){return this.opt("cellCSS",e,function(){this.grid.rendered&&this.grid._style.update()})},css:function(e,t,n){var o=this,r=o[0].css(e,t,n);return r===o[0]&&(r=o),r},cellFormatter:function(e){var t=this,n=t.opts;return void 0===e?isFunction(n.cellFormatter)?n.cellFormatter:null:(n.cellFormatter=e,t)},cellModel:function(e){var t=this,n=t.opts,o=t.grid;return void 0===e?"string"==typeof n.cellModel?o._cellModel[n.cellModel]||null:n.cellModel||null:(n.cellModel=e,t)},sort:function(e){var t=this,n=t.grid,o=t.name(),r=t.index();return n.DOMMap.columnArrow&&n.DOMMap.columnArrow.remove(),t[0].append(n.DOMMap.columnArrow=newDiv("_arrow _"+(e=void 0===e?"asc":e))),n._container.sort(t._sortType=e,function(e){if(!e)return null;var t=e.cells;return t instanceof Array?t[r]:"object"==typeof t?t[o]:void 0}),n.rendered&&n._selection.clear(),t}},k:function(e,t){var n=this,o=n.init_opts(e);n[0]=newDiv("_column"),n.grid=t,n.DOMMap={content:newDiv("_content").appendTo(n[0])},o.css&&n.css(o.css),o.className&&n[0].className("_column "+o.className),o.visible||n.visible(!1),o.text&&n.DOMMap.content.html(o.text)}})}(),function(){var e=Std.ui("Grid").childModules.cell=Std.module({f:{ui:function(e,t){var n=this,o=e.model;return n.widget||(n.widget=Std.ui(o.ui||"widget",o),n.widget.parent(n).renderTo(n[1]),isFunction(e.create)&&e.create.call(n,n,t,n.widget)),e.forceWidgetWidth&&n.widget.width(n[1].width()),e.forceWidgetHeight&&n.widget.height(n[1].height()),n.widget},template:function(e,t){var n=this;if(isString(t)&&(t={text:t}),n.template||(n.template=Std.template(e.model)),n.template&&isObject(t)){var o=n.template.build(t);return n[1].html(o),o}return null}},i:{coordText:function(){var e=this,t=e.rowIndex();return new Std.template(e.grid.cellCoordText()).build({row:t,col:e.index,line:t+1,columnText:e.grid.column(e.index).text()})},height:function(e){var t=this,n=t.grid;return void 0===e?t[0].height():(t[0].height(e-1),t[1].height(e-1-2*n.opts.cellPadding),t[1].lineHeight(e-1-2*n.opts.cellPadding),t)},clear:function(){var e=this;return e.widget&&(e.widget.destroy(),delete e.widget),e[1].clear(),e},destroy:function(){var e=this;return e.widget&&(e.widget.destroy(),delete e.widget),null!=e._timer&&(clearTimeout(e._timer),e._timer=null),e[0].remove(),e},updateByModel:function(t,n){var o=this;return t.type in e&&e[t.type].call(o,t,n),isFunction(t.update)&&t.update.call(o,o,n),o},updateByOption:function(e){var t=this;return"css"in e&&t.css(e.css),"on"in e&&t[0].on(e.on),"html"in e?t.html(e.html):"text"in e&&t.text(e.text),t},editByText:function(e){var t=this,n=!1,o=null,r=t.column().cellFormatter(),i="";r?isNumber(t.data)||isString(t.data)?i=t.data:isObject(t.data)&&("text"in t.data?i=t.data.text:"html"in t.data&&(i=t.data.html)):i=t[1].text();var l=t.grid._inputElem=t[1].editText({type:"cover",text:i,minWidth:t[0].outerWidth(),minHeight:t[0].outerHeight(),changeText:!1,textSelected:!1,className:"StdUI_Grid_DOMEditText",apply:function(r){o&&(o.remove(),o=null),isObject(t.data)?"text"in t.data?t.text(t.data.text=r):"html"in t.data&&t.html(t.data.html=r):(t.html(r),t.updateData(r)),isFunction(e)&&e.call(t,r),n=!0,t.status="",t.grid.emit("cellEdit",[t,r,i],!0),t.grid._inputElem=null}});t.grid.DOMMap.dataBody.once("scroll",function(){n===!1&&(o=newDiv("StdUI_Grid_CellCoord").appendTo("body"),o.html(t.coordText()),o.css({top:l.css("top")-o.outerHeight()-1,left:l.css("left"),zIndex:++Std.ui.status.zIndex}))})},editByModel:function(e){var t=this,n=Std.dom(document),o=function(e){t[1].contains(e.target)||(t.widget&&t.widget[0].fireEvent("blur"),t._timer=null,t.status="",t.clear().update(),n.off("mousedown",o))};return n.on("mousedown",o),t.clear().updateByModel(e,t.data)},triggerEvents:function(e){var t=this,n=t.grid,o=t.model(),r="default",i=n.cellEditable(),l=n.cellEditMode().split(" ");o&&o.mode&&(r=o.mode),"mouseenter"===e?"hover"===r&&t.clear().updateByModel(o,t.data):"mouseleave"===e?"hover"===r&&t.clear().update():"click"===e?i&&l.has("click")&&t.edit():"dblclick"===e&&i&&l.has("dblclick")&&t.edit()}},j:{column:function(){return this.grid._columns[this.index]},model:function(){return this.column().cellModel()},formatter:function(){return this.column().cellFormatter()},rowIndex:function(){var e=this;return e.merged?e.range.startRow:e.row.index()},css:function(e,t,n){var o=this,r=o[0].css(e,t,n);return r===o[0]&&(r=o),r},visible:function(e){var t=this;return void 0===e?t._visible:(e!==t._visible&&t[0].css("visibility",(t._visible=e)===!1?"hidden":""),t)},text:function(e){var t=this,n=t.formatter();return void 0===e?t[1].text():(t.widget&&(t.widget.destroy(),delete t.widget),"function"==typeof n&&(e=n.call(t,e)),t[1].text(e),t)},html:function(e){var t=this,n=t.formatter();return void 0===e?t[1].html():(t.widget&&(t.widget.destroy(),delete t.widget),"function"==typeof n&&(e=n.call(t,e)),t[1].html(e),t)},edit:function(){var e=this,t=e.data,n=e.column(),o=n.cellModel();return"edit"===e.status||isObject(t)&&t.locked||!n.editable()?e:(o&&"edit"===o.mode&&o.type&&o.editable!==!1?e.editByModel(o):o?o.type||o.editable===!1||e.editByText(function(t){isFunction(o.update)&&o.update.call(e,e,t)}):e.editByText(),e.status="edit",e)},updateData:function(e){var t=this,n=null;return n=t.merged?t.grid.row(t.range.startRow).cells:t.row.data.cells,isArray(n)?n[t.index]=e:t.name&&(n[t.name]=e),t.data=e,t},update:function(e,t,n){var o=this,r=o.column(),i=r.cellModel();if(void 0===e)e=o.data;else{if(e===o.data&&n!==!0)return o;t===!1?o.data=e:o.updateData(e)}return!i||i.mode&&"default"!==i.mode?isNumber(e)||isString(e)?o.html(e):isObject(e)&&o.updateByOption(e):o.updateByModel(i,e),o}},k:function(e,t,n,o){var r=this;"object"==typeof o?(r.grid=n,r.range=o,r.merged=!0):(r.row=n,r.grid=n.grid),r.name=t,r.index=e,r[0]=newDiv("_cell _cell"+e).append(r[1]=newDiv("_content")),r.merged===!0&&r[0].data("cell",r)}})}(),function(){{var e=Std.ui("Grid").childModules.cell;Std.ui("Grid").childModules.row=Std.module({i:{createContentWidget:function(e){var t=this,n={parent:t,appendTo:t[0],height:t.contentHeight(),tabIndex:null,defaultClass:"_content"};return isObject(e)?n=Std.extend(e,n):isString(e)&&(n.html=e),t.DOMMap.content=Std.ui("widget",n)},append:function(t){var n=this,o=n.length,r=n.cells[o]=new e(o,t||null,n);return n.DOMMap.cells.append(r[0]),"height"in n.data&&r.height(n.data.height),n.length++,n},insert:function(t,n){if(0===this.length)return this;var o=this,r=new e(n,t||null,o);r[0].insertBefore(o.cells[n][0]),o.cells.insert(r,n),"height"in o.data&&r.height(o.data.height),o.length++;for(var i=n;i<o.length;i++)o.cells[i].index!==i&&o.cells[i][0].className("_cell _cell"+(o.cells[i].index=i));return o},detach:function(){var e=this;return e[0].detach(),e},destroy:function(){for(var e=this,t=e.cells,n=0,o=t.length;o>n;n++)t[n].destroy();return e.DOMMap.content&&e.DOMMap.content.destroy(),e[0].remove(),e},contentHeight:function(e){var t=this,n=t.data,o=t.grid;return void 0===e?void 0!==n.contentHeight?n.contentHeight:o.opts.rowContentHeight:(n.contentHeight=e,t.DOMMap.content&&t.DOMMap.content.height(e),t)},height:function(e){var t=this,n=t.data,o=t.grid;if(void 0===e)return void 0!==n.height?n.height:o.opts.rowHeight;if(t.length>0)for(var r=0;r<t.length;r++)t.cells[r].height(e-1);return t.DOMMap.cells.css("lineHeight",e-1-2*o.opts.cellPadding).height((n.height=e)-1),t}},j:{length:0,index:function(){return this.grid.indexOf(this.data)},label:function(e){var t=this,n=t.data;return void 0===e?n.label||"":(n.label=e,t)},checked:function(e){var t=this,n=t.data;return void 0===e?!!n.checked:(n.checked=e,t)},expanded:function(e){var t=this,n=t.data;return void 0===e?!!n.expanded:(n.expanded=e,t)},selected:function(e){var t=this,n=t.selected;return void 0===e?!!n.selected:(n.selected=e,t)},moveCell:function(e,t){var n=this,o=n.data;o.cells instanceof Array&&o.cells.move(e,t);var r=n.cells[e],i=n.cells[t];if(e!==t&&r&&i){t>e?r[0].insertAfter(i[0]):r[0].insertBefore(i[0]),n.cells.move(e,t);for(var l=0;l<n.length;l++)n.cells[l].index!==l&&n.cells[l][0].className("_cell _cell"+(n.cells[l].index=l))}return n},removeCell:function(e){var t=this,n=t.grid,o=t.data,r=o.cells instanceof Array;isString(e)&&(r||delete o.cells[e],e=n._columnsNameIndex[e]),r&&o.cells.remove(e),e<t.length&&(t.cells[e].destroy(),t.cells.remove(e),t.length--);for(var i=e;i<t.length;i++)t.cells[i].index!==i&&t.cells[i][0].className("_cell _cell"+(t.cells[i].index=i));return t},updateStripeClass:function(e){var t=this,n=e%2==0?"_row":"_row _odd";return n!==t.className&&t[0].className(t.className=n),t},updateCell:function(e,t,n){var o=this,r=o.grid;return isString(e)&&(e=r._columnsNameIndex[e]),o.cells[e]&&o.cells[e].update(t,n),o},updateCells:function(e,t){var n=this;if(isArray(e))for(var o=0;o<n.length;o++)void 0===e[o]&&(e[o]=null),n.cells[o].update(e[o],!1,t);else Std.each(n.grid._columnsNameIndex,function(o,r){void 0===e[o]&&(e[o]=null),n.cells[r].update(e[o],!1,t)});return n},updateContent:function(e,t){var n=this,o=n.grid,r=n.data,i=n.DOMMap,l=n.height();return r.expanded?(i.content?i.content.show():n.createContentWidget(e).render(),l+=n.contentHeight()):!r.expanded&&i.content&&i.content.hide(),void 0!==t&&i.content&&(l===o.opts.rowHeight?o._container.unmarkItemHeight(t):o._container.markItemHeight(t,l)),n},update:function(e,t){var n=this,o=n.grid,r=n.data,i=o.opts.columnCount;if(void 0!==e&&o.opts.stripeRows&&n.updateStripeClass(e),n.length<i)for(var l=n.length,a=i;a>l;l++)n.append(o._columns[l].name());else if(i<n.length)for(var l=n.length;l>i;l--)n.cells[l-1].destroy(),n.cells.remove(l-1),
n.length--;return o.opts.rowExtensible&&r.extensible!==!1&&n.updateContent(r.content,e),n.updateCells(r.cells,t),n}},k:function(e,t){var n=this,o=n.DOMMap={};n[0]=newDiv(n.className="_row").data("row",n).append(o.cells=newDiv("_cells")),n.data=e,n.grid=t,n.cells=[],"name"in e&&(n.name=e.name),"height"in e&&n.height(e.height),e.cells||(e.cells=[])}})}}(),function(){{var e=Std.ui("Grid").childModules.cell;Std.ui("Grid").childModules.mergedCells=Std.module({i:{parseCellRange:function(e){var t={};return 2===(e=e.split("-")).length?(2===(e[0]=e[0].split(":")).length&&(t.startRow=~~e[0][0],t.startCol=~~e[0][1]),2===(e[1]=e[1].split(":")).length&&(t.endRow=~~e[1][0],t.endCol=~~e[1][1]),t):null}},j:{length:0,update:function(){for(var e=this,t=e.grid,n=t._rangeStart,o=t._rangeEnd,r=e.length-1;r>=0;r--){var i=e._cells[r],l=i.range;t._selection.rangeOverlap(l.startRow,l.endRow,n,o)&&e.updateCell(i)}return e},updateCell:function(t){var n=this,o=n.grid,r=t.range,i=o.DOMMap,l=o._selection.computeRangeSize("cells",r);i.dataBodyCells||(i.dataBodyCells=newDiv("_cells").appendTo(i.dataBody)),t.cell||(t.cell=new e(r.startCol,o._columns[r.startCol].name(),o,r),i.dataBodyCells.append(t.cell[0]));for(var a=r.startRow;a<=r.endRow;a++){var d=o._container._items[a].owner;if(d)for(var s=r.startCol;s<=r.endCol;s++){var c=d.cells[s];c&&c.visible(!1)}}o.opts.horizontalLine||(l.height+=1),t.cell[0].css({top:l.top,left:l.left,width:l.width-1}),t.cell.height(l.height),t.cell.update(o.cell(r.startRow,r.startCol),!1)},adjustRange:function(e,t,n){for(var o=this,r=o.grid,i=r.columnCount(),l=o._cells.length-1;l>=0;l--){var a=o._cells[l].range,d=a.startCol,s=a.startRow,c=a.endCol,u=a.endRow;"removeColumn"===e?d>t?(d--,c--):c>=t&&c--:"removeRow"===e?s>t?(s--,u--):u>=t&&u--:"insertColumn"===e?d>t?(d++,c++):c>=t&&c++:"insertRow"===e?s>t?(s++,u++):u>=t&&u++:"move"===e&&(d>t&&n>=d?(d--,c--):t>d&&c>t&&d>n?d++:t>d&&d>n?(d++,c++):t===d&&(c=n+(c-d),d=n)),0>d&&(d=0),c>=i&&(c=i-1),0>c-d||0>u-s||0>=c-d&&0>=u-s?o.remove(o._cells[l]):(o.visibleCells(s,u),a.startCol=d,a.startRow=s,a.endCol=c,a.endRow=u)}return o},append:function(e){var t=this,n=t.grid,o=function(e,o,r,i,l){var a=(r-o+1)*(l-i+1);if(!(0>=a)){for(var d=t.length-1;d>=0;d--){var s=t._cells[d],c=s.range;n._selection.rangeOverlap(c.startRow,c.endRow,o,r)&&n._selection.rangeOverlap(c.startCol,c.endCol,i,l)&&t.removeByItem(s)}t._cells.push({range:e}),t.length++}},r=function(e){isString(e)&&(e=t.parseCellRange(e)),isObject(e)&&o(e,e.startRow,e.endRow,e.startCol,e.endCol)};if(isArray(e))for(var i=0,l=e.length;l>i;i++)r(e[i]);else r(e);t.grid.rendered&&t.grid._container.updateCurrentRange()},visibleCells:function(e,t){for(var n=this,o=n.grid._container._items,r=e,i=o.length;t>=r&&!(r>=i);r++){var l=o[r].owner;if(l&&l.cells)for(var a=0;a<=l.cells.length;a++){var d=l.cells[a];d&&d.visible(!0)}}},unmerge:function(e,t,n,o,r){for(var i=this,l=!1,a=i.grid._container._items,d=t,s=a.length;n>=d&&!(d>=s);d++){var c=a[d].owner;if(c&&c.cells)for(var u=o;r>=u;u++){var h=c.cells[u];h&&(h.visible(!0),l===!1&&h.update(e,l=!0,!0))}}},removeByItem:function(e){var t=this,n=null,o=e.range;e.cell&&(n=e.cell.data,e.cell.destroy()),t._cells.remove(t._cells.indexOf(e)),t.length--,t.unmerge(n,o.startRow,o.endRow,o.startCol,o.endCol)},removeByIndex:function(e,t){for(var n=this,o=0,r=n.length;r>o;o++){var i=n._cells[o],l=i.range,a=l.startRow,d=l.endRow,s=l.startCol,c=l.endCol;if(e>=a&&d>=e&&t>=s&&c>=t){var u=null;i.cell&&(u=i.cell.data,i.cell.destroy()),n._cells.remove(o),n.length--,n.unmerge(u,a,d,s,c);break}}},remove:function(e,t){var n=this;return isObject(e)?n.removeByItem(e):(isString(e)&&(e=e.split(":"),t=e[1],e=e[0]),void n.removeByIndex(e,t))},clear:function(){for(var e=this,t=e._cells,n=0,o=e.length;o>n;n++){var r=t[n];r.cell&&(data=r.cell.data,r.cell.destroy())}return t.clear(),e.length=0,e}},k:function(e){var t=this;t.grid=e,t._cells=[]}})}}(),function(){Std.ui("Grid").childModules.selection=Std.module({i:{rangeOverlap:function(e,t,n,o){return e>=n&&o>=e||t>=n&&o>=t||n>=e&&t>=o?[n-e,o-t]:!1},formatRange:function(e){var t=this,n={};return n.startRow=e.startRow,n.endRow="endRow"in e?e.endRow:n.startRow,"startCol"in e?(n.startCol=e.startCol,n.endCol="endCol"in e?e.endCol:n.startCol):(n.startCol=0,n.endCol=t.grid.columnCount()-1),n},createSelection:function(e,t,n){var o=this,r=o.grid,i={dom:newDiv("_selection").append(newDiv("_block")).appendTo(r.DOMMap.dataBody),type:e,range:t,forceType:n};if(i.dom.data("selection",i),o._selections.push(i),o.updateSelection(i,null,n),"cell"===e||"cells"===e){var l=r._container._items[t.startRow];l.owner&&l.owner.cells[t.startCol]&&o.updateCurrentCell(t.startRow,t.startCol)}return i},startSelectRow:function(e,t){var n=this,o=n.createSelection("rows",{startRow:t,endRow:t});return this.startSelectRange(e[0],o,">._rows >._row",function(e){n.updateSelection(o,{startRow:t,endRow:e.data("row").index()})})},startSelectCell:function(e,t,n){var o=this,r=o.createSelection("cells",isObject(t)?Std.clone(t):{startRow:t,endRow:t,startCol:n,endCol:n});return this.startSelectRange(e[0],r,[">._rows > ._row > ._cells > ._cell",">._cells > ._cell"],function(e){var i=e.data("cell"),l={};l=isObject(t)?{startRow:t.startRow,startCol:t.startCol}:{startRow:t,startCol:n},i?(l.endRow=i.range.endRow,l.endCol=i.range.endCol):(l.endRow=e.parent("._row").data("row").index(),l.endCol=e.index()),o.updateSelection(r,l)})},startSelectColumn:function(e,t){var n=this,o=n.grid,r=e[0],i=n.selectColumn(t);return null===i?n:(n._tempCaller=function(e,l){if("mouseenter"===e){var a=o.DOMMap.dataColumns,d=a.context(l.target,"._column");d||(d=a.context(l.target,"> ._row > ._cells > ._cell")),d&&r.not(d)&&n.updateSelection(i,{startCol:t,endCol:(r=Std.dom(d)).index()},"column")}},Std.dom(document).once("mouseup",function(){n._tempCaller=null}),n)},startSelectRange:function(e,t,n,o){var r=this,i=r.grid,l=i.DOMMap.dataBody,a=function(e){var t=null;if(isString(n))t=l.context(e.target,n);else if(isArray(n))for(var o=0,r=n.length;r>o&&!(t=l.context(e.target,n[o]));o++);return t};return r._tempCaller=function(t,n){if("mouseenter"===t){var i=a(n);i&&e.not(i)&&o.call(r,e=Std.dom(i))}},Std.dom(document).once("mouseup",function(){r._tempCaller=null}),r},cellEvents:function(e,t,n,o){var r=this,i=n.row,l=n.merged?n.range:i.index(),a=isNumber(l)?l:l.startRow,d=isNumber(o)?o:l.startCol;"mousedown"===t&&(3===e.which?r.contains(a,d)||"cell"!==r._mode&&"cells"!==r._mode||(e.ctrlKey||r.clear(),r.selectCell(l,o)):"cell"===r._mode?r.clear().selectCell(l,o):"cells"===r._mode&&(e.ctrlKey||r.clear(),r.startSelectCell(n,l,o)),r.grid.currentRowIndex(a),r.grid.currentCellIndex(d),e.preventDefault()),r._tempCaller&&r._tempCaller(t,e,i,n,o)},rowEvents:function(e,t,n){var o=this;if("mousedown"===e){var r=t.index();3===n.which?o.contains(r)||"row"!==o._mode&&"rows"!==o._mode||(n.ctrlKey||o.clear(),o.selectRow(t.index())):"row"===o._mode?o.clear().selectRow(r):("rows"===o._mode||n.viewRow&&"checked"!==o._mode&&"cell"!==o._mode)&&(n.ctrlKey||o.clear(),o.startSelectRow(t,r)),o.grid.currentRowIndex(r),n.preventDefault()}o._tempCaller&&o._tempCaller(e,n,t)},columnEvents:function(e,t,n){var o=this;if("mousedown"===e){var r=t.index();"cells"===o._mode&&(n.ctrlKey||o.clear(),o.startSelectColumn(t,r)),n.preventDefault()}o._tempCaller&&o._tempCaller(e,n)},computeRangeSize:function(e,t){var n=this.grid,o=n._container.items("endRow"in t?t.endRow:t.startRow),r=n.computeRowTop(t.startRow),i=0,l=0,a=0;return"endRow"in t&&(a=n.computeRowTop(t.endRow)-r),"startCol"in t?(i=n.computeColumnLeft(t.startCol),l="endCol"in t?n.computeColumnLeft(t.endCol)-i+n._columns[t.endCol].width():n.computeColumnLeft(t.startCol)-i+n._columns[t.startCol].width()):l=n.computeColumnLeft(n._columns.length-1)+n._columns[n._columns.length-1].width(),{left:i,top:r,width:l,height:a+(o.owner?o.owner.height():n.opts.rowHeight)}},markColumn:function(){var e=this,t=e.grid,n=e._selections[0].range,o=0,r=0;"startCol"in n?"endCol"in n?(o=n.startCol,r=n.endCol):o=r=n.startCol:r=t.columnCount()-1;for(var i=0,l=t.columnCount();l>i;i++){var a=t._columns[i];i>=o&&r>=i?a[0].addClass("selected"):a[0].removeClass("selected")}return e._columnMarked=!0,e}},j:{selectedRange:function(){var e=this,t=e._selections.last();return t?e.formatRange(t.range):null},selectedRanges:function(){for(var e=this,t=[],n=e._selections,o=0,r=n.length;r>o;o++)t.push(e.formatRange(n[o].range));return t},selectedCell:function(){var e=this,t=e.selectedRange();return null===t?null:{rowIndex:t.startRow,colIndex:t.startCol}},selectedCells:function(){for(var e=this,t=[],n=e.selectedRanges(),o=0,r=n.length;r>o;o++)for(var i=n[o],l=i.startRow;l<=i.endRow;l++)for(var a=i.startCol;a<=i.endCol;a++)t.push(l+":"+a);for(r>1&&t.unique(),o=0,r=t.length;r>o;o++){var d=t[o].split(":");t[o]={rowIndex:~~d[0],colIndex:~~d[1]}}return t},selectedRow:function(){for(var e=this,t=e.grid.columnCount(),n=e._selections,o=0,r=n.length;r>o;o++){var i=n[o],l=i.range,a=i.type;if("row"===a||"rows"===a||"cells"===a&&0===l.startCol&&l.endCol===t-1)return l.startRow}return null},selectedRows:function(){for(var e=this,t=e.grid.columnCount(),n=[],o=e._selections,r=0,i=o.length;i>r;r++){var l=o[r],a=l.type,d=l.range;if("row"===a||"rows"===a||"cells"===a&&0===d.startCol&&d.endCol===t-1)if("endRow"in d)for(var s=d.startRow;s<=d.endRow;s++)n.push(s);else n.push(d.startRow)}return i>1&&n.unique(),n},selectColumn:function(e){var t=this;return t.grid.rowCount()<=0?null:t.createSelection("cells",{startRow:0,endRow:t.grid.rowCount()-1,startCol:e,endCol:e},"column")},selectRow:function(e){{var t=this;t.createSelection("row",{startRow:e})}return t},selectCell:function(e,t){{var n=this;n.createSelection("cell",isObject(e)?e:{startRow:e,startCol:t})}return n},contains:function(e,t){for(var n=this,o=n._selections,r=0,i=o.length;i>r;r++){var l=o[r].range,a=o[r].type,d=!1,s=!1;if("startRow"in l&&(d="endRow"in l?e>=l.startRow&&e<=l.endRow:e===l.startRow),d){if(void 0===t||"row"===a||"rows"===a)return!0;if("startCol"in l&&(s="endCol"in l?t>=l.startCol&&t<=l.endCol:t===l.startCol),s===!0)return s}}return!1},update:function(){for(var e=this,t=e._selections,n=0,o=t.length;o>n;n++)e.updateSelection(t[n],null,t[n].forceType);return e},updateSelectionRect:function(e){return e.dom.css({top:e.size.top-1,left:e.size.left-1,outerWidth:e.size.width+1,outerHeight:e.size.height+1}),this},updateCurrentCell:function(e,t){{var n=this;n.grid}return n._currentCell=null!==e?{row:e,col:t}:null,n},updateSelectionMark:function(e){var t=this,n=t.grid,o=n.DOMMap;1===t._selections.length&&"row"!==t._mode&&"rows"!==t._mode&&t.grid.selectionMarked()?(o.columnSelection||(o.columnSelection=newDiv("_selection").appendTo(o.dataColumns)),o.viewSelection||(o.viewSelection=newDiv("_selection").appendTo(o.viewBodyRows)),o.columnSelection.css({left:e.size.left-1,width:e.size.width+1}),t._markedRows={startRow:e.range.startRow,endRow:"endRow"in e.range?e.range.endRow:e.range.startRow},t.markColumn(),n._viewBody.updateRowMark()):t.clearMarked()},updateSelectionByMergedCells:function(e){for(var t=this,n=t.grid,o=e.range,r=function(e){var r=n._mergedCells._cells[e].range,i=t.rangeOverlap(r.startRow,r.endRow,o.startRow,o.endRow),l=t.rangeOverlap(r.startCol,r.endCol,o.startCol,o.endCol);i&&l&&Std.each("startRow startCol endRow endCol",function(e,t){o[t]=Math[2>e?"min":"max"](r[t],o[t])})},i=0,l=n._mergedCells.length;l>i;i++)r(i);for(i=l-2;i>=0;i--)r(i)},updateSelection:function(e,t,n){var o=this;return null==t&&(t=e.range),"endRow"in t&&t.endRow<t.startRow&&(t.endRow=[t.startRow,t.startRow=t.endRow][0]),"endCol"in t&&t.endCol<t.startCol&&(t.endCol=[t.startCol,t.startCol=t.endCol][0]),Std.each("startRow startCol endRow endCol",function(n,o){o in t&&(e.range[o]=t[o])}),"cells"===e.type&&"column"!==n&&o.updateSelectionByMergedCells(e),e.size=o.computeRangeSize(e.type,e.range),o.updateSelectionMark(e),o.updateSelectionRect(e),o},clearMarked:function(){var e=this,t=e.grid,n=t.DOMMap;if(e._columnMarked===!0){for(var o=0,r=t.columnCount();r>o;o++)t._columns[o][0].removeClass("selected");e._columnMarked=!1}return n.columnSelection&&(n.columnSelection.remove(),delete n.columnSelection),n.viewSelection&&(n.viewSelection.remove(),delete n.viewSelection),e._markedRows=null,t._viewBody.updateRowMark(),e},clear:function(){for(var e=this,t=e._selections,n=0,o=t.length;o>n;n++)t[n].dom.remove();return e._markedRows=null,e._currentCell=null,e.clearMarked(),e.updateCurrentCell(null),t.clear(),e}},k:function(e,t,n){var o=this;o.grid=t,o.opts=n,o._mode=e,o._selections=[],o._markedRows=null,o._currentCell=null}})}(),function(){Std.ui("Grid").childModules.style=Std.module({n:{initKeys:function(){var e=this,t=e.grid,n="."+t._identifier+" > table > tbody > tr > td >",o="."+t.opts.defaultClass;e._selectors=Std.extend({},{viewHeader:n+o+"_ViewHeader",viewHeaderColumns:n+o+"_ViewHeader > ._columns",viewHeaderColumn:n+o+"_ViewHeader > ._columns > ._column",viewHeaderCheckBox:n+o+"_ViewHeader > ._columns > ._column > .StdUI_Grid_CheckBox",dataHeader:n+o+"_DataHeader",dataHeaderColumns:n+o+"_DataHeader > ._columns",dataHeaderColumn:n+o+"_DataHeader > ._columns > ._column",dataHeaderColumnArrow:n+o+"_DataHeader > ._columns > ._column > ._arrow",viewBody:n+o+"_ViewBody",viewBodyRow:n+o+"_ViewBody > ._rows > ._row",viewBodyRowCheckBox:n+o+"_ViewBody > ._rows > ._row > ._cell > .StdUI_Grid_CheckBox",viewBodyCell:n+o+"_ViewBody > ._rows > ._row > ._cell",viewBodyRowExpander:n+o+"_ViewBody > ._rows > ._row > ._cell > ._expander",dataBodyPlaceHolder:n+o+"_DataBody > ._placeHolder",dataBodyRows:n+o+"_DataBody > ._rows",dataBodyRow:n+o+"_DataBody > ._rows > ._row",dataBodyRowCheckBox:n+o+"_DataBody > ._rows > ._row > .StdUI_Grid_CheckBox",dataBodyContent:n+o+"_DataBody > ._rows > ._row > ._content",dataBodyCells:n+o+"_DataBody > ._cells",dataBodyCell:n+o+"_DataBody > ._cells > ._cell",dataBodyCellContent:n+o+"_DataBody > ._cells > ._cell > ._content",dataBodyRowCells:n+o+"_DataBody > ._rows > ._row > ._cells",dataBodyRowCell:n+o+"_DataBody > ._rows > ._row > ._cells > ._cell",dataBodyRowCellContent:n+o+"_DataBody > ._rows > ._row > ._cells > ._cell > ._content"})}},i:{appendHeaderStyle:function(){var e=this,t=e.grid,n=t.opts,o=e._lines,r={},i=n.columnHeight-1,l=n.columnPadding;r.viewHeaderCheckBox={marginTop:(i-16)/2+"px"},r.viewHeaderColumns=r.dataHeaderColumns={height:i+"px"},r.viewHeaderColumn={height:i+"px"},r.dataHeaderColumn={height:i-2*l+"px",lineHeight:i-2*l+"px",textAlign:n.columnTextAlign,padding:l+"px"},r.dataHeaderColumnArrow={marginTop:(i-2*l)/2-3+"px"},n.columnSortable&&(r.dataHeaderColumn.cursor="pointer");for(var a=0,d=0,s=n.columnCount;s>a;a++){var c=t._columns[a],u=c.width(),h=c.visible();o[a]||(o[a]=newDiv("_line").appendTo(t.DOMMap.dataBodyLines)),e._css.append(e._selectors.dataHeaderColumn+a,{width:u-2-2*n.columnPadding+"px"}),h&&(d+=u),c.opts.verticalLine!==!1&&h?n.verticalLine===!0&&o[a].css("left",d-1):o[a].css("left",-99)}if(o.length>s)for(a=s;a<o.length;a++)o[a].remove(),o.remove(a);return Std.each(r,function(t,n){e._css.append(e._selectors[t],n)}),e},appendViewBodyStyle:function(){var e=this,t=e.grid,n=t.opts,o=n.rowHeight,r=e._selectors;return n.rowNumbers&&e._css.append(r.viewBodyCell+"._number",{width:n.rowNumberWidth-1+"px"}),n.rowLabels&&e._css.append(r.viewBodyCell+"._label",{width:n.rowLabelWidth-1+"px"}),n.rowCheckable&&e._css.append(r.viewBodyCell+"._checkbox",{width:n.rowCheckBoxWidth-1+"px"}),n.rowExtensible&&e._css.append(r.viewBodyCell+"._expander",{width:n.rowExpanderWidth-1+"px"}),Std.each({viewBodyRow:{height:o-1+"px",lineHeight:o-1+"px"}},function(t,n){e._css.append(r[t],n)}),e},appendDataBodyStyle:function(){for(var e=this,t=e.grid,n=t.opts,o=e._selectors,r=n.rowHeight,i=n.cellPadding,l=t.computeColumnsWidth(),a=0,d=n.columnCount;d>a;a++){var s=t._columns[a],c=s.cellCSS(),u={width:s.width()-1+"px"};s.visible()?isObject(c)&&Std.extend(u,c):u.display="none",e._css.append(o.dataBodyRowCell+a,u)}return Std.each({dataBodyPlaceHolder:{width:l+"px"},dataBodyCells:{textAlign:n.cellTextAlign},dataBodyCellContent:{padding:i+"px"},dataBodyRowCheckBox:{marginTop:(r-1-16)/2+"px"},dataBodyRow:function(){var e={width:l+"px"};return n.horizontalLine||(e.borderColor="transparent"),e}(),dataBodyRowCells:{width:l+"px",height:r-1+"px",lineHeight:r-1-2*i+"px",textAlign:n.cellTextAlign},dataBodyContent:function(){var e={};return n.horizontalLine||(e.borderColor="transparent"),e}(),dataBodyRowCell:{height:r-1+"px"},dataBodyRowCellContent:{height:r-1-2*i+"px",padding:i+"px"}},function(t,n){e._css.append(o[t],n)}),e}},j:{selector:function(e){return this._selectors[e]},update:function(){var e=this;e._css.clear(),e.appendHeaderStyle(),e.appendDataBodyStyle(),e.appendViewBodyStyle()},destroy:function(){this._css.remove()}},k:function(e){var t=this;t.grid=e,t._css=new Std.css,t._lines=[],t.initKeys()}})}(),function(){Std.ui("Grid").childModules.container=Std.module({e:{items:null,itemRender:null,itemHeight:32,rangeHeight:0,autoClean:!1,container:null,deferRender:!0,scrollDelay:null,direction:"vertical",spacingClassName:"_spacing"},n:{init:function(){var e=this,t=e.opts;t.deferRender?e.initSpacings():e.renderItems(),e._ready=!0,e.updateScrollValue(),e.update(),e.initScrollEvent()},initScrollEvent:function(){var e=this,t=e.opts,n=function(){e.updateScrollValue(),(e._timer=null||e.updateRangeIndex())&&e.updateCurrentRange(),"function"==typeof t.scroll&&t.scroll.call(e,e._scrollValue)};t.monitor.on("scroll",e._scrollEvent=function(){t.scrollDelay===!1?n():(null!==e._timer&&(clearTimeout(e._timer),e._timer=null),e._timer=setTimeout(n,t.scrollDelay))})}},i:{initSpacings:function(){var e=this,t=e.opts;t.autoClean&&t.container.append(e.createSpacing(0,0).dom),t.container.append(e.createSpacing(0,e.length-1).dom)},destroy:function(){var e=this,t=e.opts;return null!==e._timer&&(clearTimeout(e._timer),e._timer=null),t.monitor.off("scroll",e._scrollEvent),e.clear()},markItemHeight:function(e,t,n){var o=this,r=o.opts,i=o._itemsHeight,l=i.length;if(t===r.itemHeight)return o;if(n===!0)i.push({index:e,height:t});else if(n===!1){for(var a=0;l>a&&!(i[a].index>=e);a++);i.insert({index:e,height:t},a)}else{for(var a=0,d=!1;l>a;a++)if(i[a].index===e){i[a].height=t,d=!0;break}d===!1&&o.markItemHeight(e,t,!1)}return o},unmarkItemHeight:function(e){for(var t=this,n=t._itemsHeight,o=0,r=n.length;r>o;o++)if(n[o].index===e){n.remove(o);break}return t},computeItemTop:function(e){for(var t=this,n=t.opts,o=e*n.itemHeight,r=0,i=t._itemsHeight.length;i>r;r++){var l=t._itemsHeight[r];if(!(l.index<e))break;o+=l.height-n.itemHeight}return o},computeSpacingSize:function(e,t){var n=this,o=n.opts;if(e>t||-1===e&&-1===t)return 0;for(var r=(t-e+1)*o.itemHeight,i=0,l=n._itemsHeight.length;l>i;i++){var a=n._itemsHeight[i];if(a.index>=e&&a.index<=t)r-=o.itemHeight,r+=a.height;else if(a.index>t)break}return r},createSpacing:function(e,t,n){var o=this,r=o.opts,i={children:[],startIndex:e,endIndex:t,dom:newDiv(r.spacingClassName)};return void 0===n||-1===n?o._spacings.push(i):o._spacings.insert(i,n),o.updateSpacingSize(i,o.computeSpacingSize(e,t)),i},findSpacing:function(e,t,n){for(var o=this,r=null,i=o._spacings,l=0,a=i.length;a>l;l++){if(e>=i[l].startIndex&&e<=i[l].endIndex){r=t===!0?l:i[l],isFunction(n)&&n.call(o,l,i[l]);break}if(i[l].startIndex>e)break}return r},fillSpacing:function(e,t,n,o){var r=this,i=r.opts,l=r._spacings[n],a=i.container;if(void 0!==o)"first"===o?(a.insertBefore(e[0],l.dom),r.updateSpacing(l,l.startIndex+1,l.endIndex)):"last"===o&&(a.insertAfter(e[0],l.dom),r.updateSpacing(l,l.startIndex,l.endIndex-1));else{var d=r.createSpacing(l.startIndex,t-1,n);r.updateSpacing(l,t+1,l.endIndex),a.insertBefore(d.dom,l.dom),a.insertBefore(e[0],l.dom)}return r},updateScrollValue:function(){var e=this,t=e.opts;return"vertical"===t.direction?e._scrollValue=t.monitor.scrollTop():"horizontal"===t.direction&&(e._scrollValue=t.monitor.scrollLeft()),e},updateSpacing:function(e,t,n){var o=this,r=o.opts,i=o._spacings,l=i.last();return isNumber(e)&&(e=i[e]),t>n&&l!==e&&(t=-1,n=-1),n>=o.length&&(n=o.length-1),-1!==t||-1!==n||r.autoClean||i[0]===e||l===e?(e.startIndex=t,e.endIndex=n,o.updateSpacingSize(e,o.computeSpacingSize(t,n))):o.removeSpacing(e),o},updateSpacingSize:function(e,t){var n=this,o=n.opts,r=e.children,i=r.length,l=5e6,a=function(e,t){"vertical"===o.direction?e.height(t):"horizontal"===o.direction&&e.width(t)};if((e.size=t)<=l)i>0&&(Std.each(r,function(e,t){t.remove()}),r.clear()),a(e.dom,t);else{var d=Math.ceil(t/l);if(i>d)for(var s=i-d-1;s>=0;s--)r[s].remove(),r.remove(s);for(var s=0;d>s;s++)r[s]||(r[s]=newDiv(o.spacingClassName).appendTo(e.dom)),a(r[s],l>t?t:l),t-=l;a(e.dom,"")}return n},updateSpacings:function(){for(var e=this,t=e.opts,n=e._spacings,o=t.direction,r=null,i=0,l=n.length;l>i;i++){var a=n[i];null!==r&&r.endIndex===a.startIndex+1&&(a.size+=r.size,a.startIndex=r.startIndex,"vertical"===o?a.dom.height(a.size):"horizontal"===o&&a.dom.width(a.size),e.removeSpacing(i--),l--),r=n[i]}return r},updateRangeIndex:function(){for(var e,t=this,n=t.opts,o=n.itemHeight,r=t._itemsHeight,i=t._scrollValue,l=0,a=0,d=0,s=-1,c=0,u=0,h=r.length;h>d;d++){var m=(e=r[d]).height,p=(e.index-1-s)*o+u;if(!(i>=l+p)){d>0&&d--;break}u=m,s=e.index,a=(l+=p)+u}if((s=0>=s?0:s)+1&&i-a>0){var g=Math.floor((i-a)/o);s+=g,l+=g*o}for(u=a=0,c=s;h>d;d++)if(!(s>=(e=r[d]).index)){if(u=e.index==c+1?e.height:(e.index-c)*o+e.height,a+u>=i-l+n.rangeHeight)break;c=e.index,a+=u}return(c+=Math.ceil((i-l+n.rangeHeight-a)/o))>=t.length&&(c=t.length-1),t._rangeStart!==s||t._rangeEnd!==c?(t._rangeEnd=c,t._rangeStart=s,!0):!1},updateCurrentRange:function(){var e=this,t=e.opts,n=e._items,o=e.computeItemTop(e._rangeStart);t.deferRender&&t.autoClean&&(e.clearRenderedItems(!0),e.updateSpacing(0,0,e._rangeStart-1),e.updateSpacing(1,e._rangeEnd+1,e.length-1));for(var r=e._rangeStart;r<=e._rangeEnd;r++)!t.deferRender||n[r].owner&&n[r].rendered||e.renderItem(r),isFunction(t.appear)&&t.appear.call(e,n[r].data,n[r].owner,r);return t.deferRender&&!t.autoClean&&e.updateSpacings(),isFunction(t.updateCurrentRange)&&t.updateCurrentRange.call(e,e._rangeStart,e._rangeEnd,o),e},renderItems:function(){for(var e=this,t=e.opts,n=e._items,o=0,r=e.length;r>o;o++){var i=e._items[o].data,l=t.itemRender(i,o);t.container.append(l[0]),n[o].owner=l.update(o),n[o].rendered=!0}return e},renderItem:function(e){var t=this,n=t.opts,o=t._items[e],r=o.data,i=o.owner="owner"in o?o.owner:n.itemRender(r,e);if((o.rendered=!0)&&n.autoClean){var l=null,a=t._renderedList;a.sort(function(e,t){return e.index-t.index}).each(function(t,n){return n.index>e?l=n.item:void 0}),i[0].insertBefore(null===l?t._spacings[1].dom:l.owner[0]),t._renderedLength=a.push({item:t._items[e],index:e})}else{var d=t.findSpacing(e,!0,function(n,o){var r;e===o.startIndex?r="first":e===o.endIndex&&(r="last"),t.fillSpacing(i,e,n,r)});null===d&&(t._items[e+1].owner?i[0].insertBefore(t._items[e+1].owner[0]):t._items[e-1].owner&&i[0].insertAfter(t._items[e-1].owner[0]))}return t},adjustIndex:function(e,t){for(var n=this,o=n._spacings,r=o.length-1;r>=0;r--){var i=o[r],l=i.startIndex,a=i.endIndex;l>e?"+"===t?(l++,a++):"-"===t&&(l--,a--):l>=e&&a>=e&&("+"===t?a++:"-"===t&&a--),n.updateSpacing(i,l,a)}return Std.each(n._renderedList.concat(n._itemsHeight),function(n,o){o.index>=e&&("+"===t?o.index++:"-"===t&&o.index--)}),n},removeSpacing:function(e){var t,n=this,o=n._spacings;return isNumber(e)?t=o[e]:e=o.indexOf(t=e),t.dom.remove(),n._spacings.remove(e),n},clearRenderedItems:function(e){for(var t=this,n=t._renderedLength-1;n>=0;n--){var o=t._renderedList[n],r=o.index;e===!0&&r>=t._rangeStart&&r<=t._rangeEnd||(t._renderedLength--,t._renderedList.remove(n),o.item.rendered=!1,o.item.owner.detach())}return t}},j:{indexOf:function(e,t){for(var n=t||0;n<this.length;n++)if(this._items[n].data===e)return n;return-1},rangeHeight:function(e){return this.opt("rangeHeight",e,function(){this._ready&&this.updateScrollValue().update()})},itemName2Index:function(e){var t=this,n=t._itemsMap;return e in n?t._items.indexOf(n[e]):-1},itemHeight:function(e){var t=this;return t.opt("itemHeight",e,function(){t._ready&&(Std.each(t._spacings,function(e,n){t.updateSpacing(n,n.startIndex,n.endIndex)}),t.updateScrollValue().update())})},items:function(e,t){var n=this,o=null;if("number"==typeof e)o=n._items[e]||null;else if("string"==typeof e)o=n._itemsMap[e]||null;else if(isFunction(e))return 0===n.length?null:Std.each(n._items,function(t,o){return e.call(n,t,o)},t);return o},reset:function(){var e=this,t=e.opts,n=e._items;e._itemsHeight.clear(),e._renderedList.clear(),e._renderedLength=0;for(var o=e._spacings.length-1;o>=0;o--)e.removeSpacing(o);for(o=0;o<e.length;o++){var r=n[o].data;n[o].owner&&(n[o].owner.destroy(),delete n[o].owner),"height"in r&&e._itemsHeight.push({index:o,height:r.height})}return t.deferRender?e.initSpacings():e.renderItems(),e},sort:function(e,t){var n=this,o=n._items;return o.sort(function(n,o){return null==(n=t(n.data))||null==(o=t(o.data))?-1:"asc"===e?null==n||null==o?-1:(("string"==typeof n||"string"==typeof o)&&(n+"").localeCompare(o+""),n>o?1:n===o?0:-1):"desc"===e?null==n||null==o?-1:(("string"==typeof n||"string"==typeof o)&&(o+"").localeCompare(n+""),o>n?1:n===o?0:-1):void 0}),n.reset().updateScrollValue().update()},update:function(){var e=this;return e.updateRangeIndex(),e.updateCurrentRange(),e},signin:function(e,t,n){if("name"in t&&(this._itemsMap[t.name]=n),"height"in t||t.expanded){var o="height"in t?t.height:this.opts.itemHeight;t.expanded&&(o+="contentHeight"in t?t.contentHeight:this.opts.parent.opts.rowContentHeight),o!==this.opts.itemHeight&&this.markItemHeight(e,o,e===this.length)}return this.length++,this},insert:function(e,t){var n=this,o=n.opts,r=null,i=n._items,l=n._ready;if(void 0===t||0>t||t>=n.length)return n.append(e);if(l&&n.adjustIndex(t,"+"),o.deferRender||!l)i.insert(r={data:e},t);else{var a=o.itemRender(e);i.insert(r={data:e,owner:a},t),o.container.insert(a[0],t+1)}return n.signin(t,e,r)._ready?(!o.deferRender||o.autoClean||n.findSpacing(t)||n.renderItem(t),n.update()):n},append:function(e){var t=this,n=t.opts,o=t._items,r=t._ready,i=function(e){var i=null;if(n.deferRender||!r)o.push(i={data:e});else{var l=n.itemRender(e,t.length);o.push(i={owner:l,data:e}),l[0].appendTo(n.container)}t.signin(t.length,e,i)};if(isArray(e))for(var l=0,a=e.length;a>l;l++)i(e[l]);else isObject(e)&&i(e);if(r){if(n.deferRender&&!n.autoClean){var d=t._spacings.last();t.updateSpacing(d,d.startIndex,t.length-1)}t.update()}return t},remove:function(e){var t=this,n=t.opts,o=t._items,r=t.length,i=function(e){e>=r||(o[e].owner&&o[e].owner.destroy(),"name"in o[e].data&&delete t._itemsMap[o[e].data.name],t.length--,t.unmarkItemHeight(e),o.remove(e),n.deferRender&&t._ready&&t.adjustIndex(e,"-"))};return void 0===e?t.destroy():(isNumber(e)?i(e):isArray(e)&&e.sort(function(e,t){return t-e}).each(function(e,t){i(t)}),t._ready&&t.update(),t)},clear:function(){var e=this,t=e.opts;e._renderedLength>0&&e.clearRenderedItems();for(var n=0;n<e.length;n++)e._items[n].owner&&e._items[n].owner.destroy();for(n=e._spacings.length-2;n>=0;n--)0===n&&t.deferRender&&!t.autoClean&&e.removeSpacing(n);return Object.clear(e._itemsMap),e._items.clear(),e._itemsHeight.clear(),e.length=0,e}},k:function(e){var t=this,n=t.init_opts(e);t.length=0,t._ready=!1,t._timer=null,t._rangeStart=-1,t._rangeEnd=-1,t._items=n.items,t._itemsMap={},t._spacings=[],t._itemsHeight=[],t._renderedList=[],t._renderedLength=0,t._scrollValue=0}})}(),function(){Std.ui("Grid").childModules.ViewBody=Std.module({n:{initDOMTree:function(){var e=this,t=e.grid,n=t.DOMMap;n.body.prepend(n.viewBodyTD=newDom("td").append(n.viewBody=newDiv(t.opts.defaultClass+"_ViewBody").append(n.viewBodyRows=newDiv("_rows").append(n.viewBodySpacing=newDiv("_spacing")))))},initCheckboxEvents:function(){var e=this,t=e.grid,n=t.DOMMap,o=t._container,r=function(){var e=this,n=!e.hasClass("checked"),r=e.parent("._row").data("viewRow").index,i=o._items[r];return i.owner&&"checked"===t.opts.selectionMode&&i.owner[0].toggleClass("selected",n),e.toggleClass("checked",i.data.checked=n),!1},i=function(){for(var e=this,t=e.hasClass("checked"),n=0,r=o._items.length;r>n;n++){var i=o._items[n].data;i.checked=!t}e.toggleClass("checked",!t),o.update()};n.viewColumns.on("mouseenter",">._column > .StdUI_Grid_CheckBox",function(e){this.mouse({auto:!1,click:i},e)}),n.viewBodyRows.on("mouseenter"," >._row > ._cell._checkbox > .StdUI_Grid_CheckBox",function(e){this.mouse({auto:!1,down:Std.func(!1),click:r},e)})},initExpanderEvents:function(){var e=this,t=e.grid,n=t.DOMMap,o=t._container,r=function(){var n=this,r=n.parent("._row").data("viewRow"),i=r.index,l=t.row(i),a=o._items[i].owner;return n.toggleClass("_expanded",l.expanded=!n.hasClass("_expanded")),a.update(i),t._selection.update(),e.updateViewRow(r,a),t._mergedCells.update(),e.updateRowMark(),!1};n.viewBodyRows.on("mouseenter",">._row > ._cell._expander > ._expander",function(e){this.mouse({auto:!1,down:Std.func(!1),click:r},e)})},initRowEvents:function(){var e=this,t=e.grid,n=t.DOMMap;n.viewBodyRows.on("mouseenter mouseleave mousedown click","> ._row",function(e){var o=this.data("viewRow"),r=t._container.items(o.index),i=r.owner[0];if(e.viewRow=!0,"mousedown"===e.name){e.preventDefault();var l=n.viewBodyRows.plugin("resize");if(l&&0!==l.cursorCode)return}"mouseenter"===e.name?i.fireEvent("mouseover",e):"mouseleave"===e.name?i.fireEvent("mouseout",e):i.fireEvent(e.name,e)})}},i:{width:function(){var e=this,t=e.grid,n=t.opts,o=0;return n.rowNumbers&&(o+=n.rowNumberWidth),n.rowCheckable&&(o+=n.rowCheckBoxWidth),n.rowLabels&&(o+=n.rowLabelWidth),n.rowExtensible&&(o+=n.rowExpanderWidth),o},height:function(e){var t=this,n=t.grid.DOMMap;return void 0===e?n.viewBody.height():(n.viewBody.height(e),n.viewBodySpacing.height(e),t)},updateWidth:function(){var e=this,t=e.grid.DOMMap,n=e.width();return t.viewBody.width(n),t.viewBodyRows.width(n),t.viewBodySpacing.width(n-1),e},clear:function(){for(var e=this,t=e._rows,n=0,o=t.length;o>n;n++)t[n].row.remove();return t.clear(),e}},j:{updateRowMark:function(e){var t=this,n=t.grid,o=n.DOMMap,r=t._rows,i=n._selection._markedRows;if(void 0===e){for(var l=0,a=r.length,d=!1,s=0,c=0;a>l;l++)if(t.updateRowMark(l)&&i){var u="height"in r[l]?r[l].height:n.opts.rowHeight;r[l].marked&&(d=!0,c+=u),d===!1&&(s+=u)}i&&o.viewSelection.css({top:s-1,height:c+1})}else{var h=r[e];i&&h.index>=i.startRow&&h.index<=i.endRow?h.marked||(h.row.addClass("selected"),h.marked=!0):h.marked&&(h.row.removeClass("selected"),delete h.marked)}return t},updateViewRow:function(e,t){var n=this,o=n.grid,r=o.opts,i=e.index,l=t.height();(e.expanded=t.expanded())&&(l+=t.contentHeight()),r.rowHeight!==l?e.row.height((e.height=l)-1).lineHeight(l-1):"height"in e&&(e.row.removeStyle("height lineHeight"),delete e.height),r.rowNumbers&&(!e.numberCell&&e.row.prepend(e.numberCell=newDiv("_cell _number")),e.number!==i+1&&e.numberCell.html(e.number=i+1)),r.rowCheckable&&(!e.checkboxCell&&e.row.append(e.checkboxCell=newDiv("_cell _checkbox").append(e.checkbox=newDiv("StdUI_Grid_CheckBox"))),e.checkbox.toggleClass("checked",!!t.checked())),r.rowLabels&&(!e.labelCell&&e.row.append(e.labelCell=newDiv("_cell _label")),e.label!==t.label()&&e.labelCell.html(t.label())),r.rowExtensible&&(!e.expander&&e.row.append(e.expanderCell=newDiv("_cell _expander").append(e.expander=newDiv("_expander"))),e.expander.toggleClass("_expanded",e.expanded))}},k:function(e){this.grid=e,this._rows=[]}})}(),function(){Std.ui("Grid").childModules.plugin=Std.module({n:{initRowContextMenu:function(){var e=this,t=e.grid,n=t.DOMMap.tbody.plugin("contextMenu",{handle:"> tr > td > .StdUI_Grid_DataBody > ._rows > ._row",menu:t.opts.rowContextMenu});t.DOMMap.viewBodyRows.on("contextmenu","> ._row",function(e){return n.show().move(e.pageX+1,e.pageY+1),!1})},initCellContextMenu:function(){var e=this,t=e.grid,n=t.opts;t.DOMMap.body.plugin("contextMenu",{handle:"> td > .StdUI_Grid_DataBody > ._rows > ._row > ._cells > ._cell,> td > .StdUI_Grid_DataBody > ._cells > ._cell",
menu:n.cellContextMenu})},initColumnContextMenu:function(){var e=this,t=e.grid,n=t.opts;t.DOMMap.dataColumns.plugin("contextMenu",{handle:"> ._column",menu:n.columnContextMenu})},initRowResizePlugin:function(){var e=this,t=e.grid,n=t.opts,o=0,r=0,i=0;t.DOMMap.viewBodyRows.plugin("resize",{top:!1,left:!1,right:!1,items:"> ._row",cursor:"row-resize",helper:"original",opacity:1,minHeight:2*n.cellPadding,check:function(e){return n.rowResizable&&!e.data("viewRow").expanded}}).on({start:function(n){var l=n.self.data("viewRow");o=n.e.pageY,i=n.self.height(),e.createResizer("horizontal").css("top",r=n.self.offset().y-t[0].offset().y+i-1),t.emit("rowResizeStart",l.index)},stop:function(e){var n=e.self.data("viewRow");t._container.items(n.index).owner.height(n.height=e.height),t._container.markItemHeight(n.index,e.height).update(),t._selection.update(),t._mergedCells.update(),t.DOMMap.resizer.remove(),t.emit("rowResizeStop",n.index)},move:function(e){i+(e.e.pageY-o)>2*n.cellPadding&&(e.self.lineHeight(e.self.height()),t.DOMMap.resizer.css("top",r+(e.e.pageY-o)))}})},initColumnResizePlugin:function(){var e=this,t=e.grid,n=t.opts,o=null,r=0,i=0,l=0,a=-1;t.DOMMap.dataColumns.plugin("resize",{top:!1,left:!1,bottom:!1,opacity:1,items:"> ._column",cursor:"col-resize",helper:"original",minWidth:2*n.columnPadding,check:function(e,n){return t.column(e.index()).resizable()?void 0:(n.stopFire(),!1)}}).on({start:function(d){r=d.e.pageX,o=t.column(a=d.self.index()),l=d.self.width()+2*n.columnPadding,e.createResizer("vertical").css("left",i=d.self.offset().x-t[0].offset().x+l),t.emit("columnResizeStart",a)},stop:function(e){o.width(e.width),t._selection.update(),t._mergedCells.update(),t.DOMMap.resizer.remove(),t.emit("columnResizeStop",a)},move:function(e){l+(e.e.pageX-r)>2*n.columnPadding&&t.DOMMap.resizer.css("left",i+(e.e.pageX-r))}})},initColumnDropPlugin:function(){var e=this.grid,t=e.opts,n=null,o=null,r=null,i="",l=null,a=null,d=-1;e.DOMMap.dataColumns.plugin("drop",{items:"> ._column",accept:e._style.selector("dataHeaderColumn"),helper:"rect",helperClass:"StdUI_Grid_ColumnHelper",placeHolder:"clone",forcePlaceHolderSize:!1,check:function(t,n){return e.column(t.index()).droppable()?void 0:(n.stopFire(),!1)}}).on({leave:function(){o.hide(),a=null},start:function(r){var i=Std.ui.status.zIndex+1;n=r.helper.html((l=e._columns[d=r.self.index()]).text()).css({zIndex:i,lineHeight:r.height-2,textIndent:t.columnPadding+"px"}),o=new Std.doms(".StdUI_Grid_ColumnPointer._top,.StdUI_Grid_ColumnPointer._bottom").appendTo("body"),o[0].css("zIndex",i),o[1].css("zIndex",i),e.emit("columnDropStart",d)},enter:function(t){(r=t.containment.offset())&&(a=e._columns[t.containment.index()])!==l&&(o.show(),o[0].css("top",r.y-10),o[1].css("top",r.y+t.containment.outerHeight()))},move:function(e){e.containment&&a&&(e.pageX<r.x+a.width()/2&&(i="before")?o.left(r.x-6):(i="after")&&o.left(r.x+a.width()-6))},stop:function(t){o.remove(),t.containment&&i&&l&&a&&(e.moveColumn(l,a,i),e._selection.clear()),e.emit("columnDropStop",d)}})}},"protected":{createResizer:function(e){var t=this,n=t.grid,o=n.DOMMap.resizer=newDiv("_resizer _"+e);return o.appendTo(n[0]),o}},k:function(e){this.grid=e}})}();