/**
    Std UI Kit Library
    http://ui.stdjs.com
	module: MenuBar
*/
Std.ui.module("MenuBar",{b:"widget",e:{defaultClass:"StdUI_MenuBar",level:3,minHeight:16,items:null},h:{state:0,selectedIndex:-1},n:{initKeyboard:function(){var e=this,t=!1,n=Std.dom(document);n.on("mousedown",e._mousedown=function(t){var n=t.target,i=e.currentSelected();i&&i.menu&&Std.dom(i.menu).contains(n)||(e[1].is(n)||!e[1].contains(n))&&e.clearStates()}),n.on("keyup",e._keyup=function(){t===!0&&e.enable()&&(e.updateLabels(),t=!1)}),n.on("keydown",e._keydown=function(n){var i=Std.dom(n.target),s=e[0].offsetParent();s&&(i.is(s)||s.contains(i))&&e[0].visible()&&e.enable()&&(18===n.keyCode?(e.updateLabels(t=!0),n.preventDefault()):27===n.keyCode?e.clearStates():n.altKey&&(e._items.items(function(t,i){return-1!==i.text.toUpperCase().indexOf("&"+String.fromCharCode(n.keyCode))?(t===e._selectedIndex?e.clearStates():e.select(t),e.focus(),!0):void 0}),n.preventDefault()))}),e[0].on("keydown",function(t){e.enable()&&e.keyEvent(t)})},initEvents:function(){var e=this,t=!1;e[0].on("mouseenter","._item",function(n){var i=this.index();e.enable()&&this.mouse({auto:!1,click:function(){i!==e._selectedIndex?e.select(i):e.clearStates()}},n),t||e[0].unselect(t=!0),e.enable()&&1==e._state&&e.select(i)})}},g:{render:function(){},height:function(e){var t=this;isNumber(e)||(e=t.height()),t[1].lineHeight(e-=t.boxSize.height),t._items.items(function(t,n){n.iconElem&&n.iconElem.marginTop((e-n.iconElem.height())/2)})},destroy:function(){var e=this;Std.dom(document).off({keydown:e._keydown,keyup:e._keyup,mousedown:e._mousedown}),e._items.items(function(e,t){t.menu&&t.menu.remove()})},remove:function(e){var t=this,n=null;isObject(e)&&(e=t._items.indexOf(e)),(isNumber(e)||isString(e))&&(n=t._items.items(e))&&(n.menu&&n.menu.remove(),n.elem.remove(),t._items.removeItem(e))}},i:{keyEvent:function(e){var t=this,n=t._items.length,i=t._selectedIndex;switch(e.keyCode){case 37:0>=i&&(i=n),t.select(i-1);break;case 39:i>=n-1&&(i=-1),t.select(i+1);break;case 40:var s=t._items.items(i),u=s.menu.focus();null==u._currentItem&&u.select(0)}},showMenu:function(){var e=this,t=e.currentSelected();if(t){var n=t.elem.offset(),i=t.menu;i&&i.show()[0].css({left:n.x,top:n.y+e.height()})}return e},createItem:function(e){var t=this,n=newDiv("_item").appendTo(t[1]),i=null,s=null;isEmpty(e.icon)||Std.icon.update(i=newDiv("_icon").appendTo(n),e.icon,{width:null,height:null}),isString(e.text)&&(s=newDiv("_text").html(e.text.replace("&","")).appendTo(n));var u={elem:n,iconElem:i,textElem:s,name:e.name,text:e.text,items:e.items};return isObject(e.items)?u.items=e.items:e.menu&&(isWidget(e.menu)?u.menu=e.menu:isPlainObject(e.menu)&&(u.menu=Std.ui(e.menu.ui||"Menu",e.menu))),u},formatLabel:function(e){var t=e.indexOf("&"),n="";if(-1==t)return e;for(var i=0,s=e.length;s>i;i++){var u=e.charAt(i);n+="&"===u&&s>i+1?"<span style='text-decoration: underline'>"+e.charAt(++i)+"</span>":u}return n},updateLabels:function(e){var t=this;return t._items.items(function(n,i){var s="";s=e===!0?t.formatLabel(i.text):i.text.replace(/&/,""),i.textElem.html(s)}),t},clearStates:function(){var e=this,t=e.currentSelected();return t&&null!==t.menu&&(t.elem.removeClass("selected"),t.menu&&t.menu.hide(),e._selectedIndex=-1,e._state=0),e},currentSelected:function(){var e=this;return-1===e._selectedIndex?null:e._items._list[e._selectedIndex]}},j:{items:function(e,t){return this._items.items(e,t)},select:function(e){var t=this,n=t._items._list[e];return null==n?t:(!n.menu&&n.items&&(n.menu=Std.ui("Menu",{items:n.items})),n.menu&&!n.menu.rendered&&(n.menu instanceof Std.ui("Menu")&&n.menu.on("itemPress",function(){t.clearStates()}),n.menu[0].css("position","absolute"),n.menu.parent(t).renderTo("body")),t.clearStates(),n.elem.addClass("selected"),t._state=1,t._selectedIndex=e,t.showMenu())},append:Std.func(function(e){var t=this;t._items.push(t.createItem(e))},{each:[isArray]})},k:function(e,t,n){e._items=Std.items(),e.initEvents(),e.initKeyboard(),n.append(e[1]=newDiv("_items")),t.items&&e.append(t.items)},support:{rule:{children:"append"},html:{nodeName:["DIV"],create:function(e){this.append(e.children(function(e,t){var n=t.attr("std-ui"),i={icon:t.attr("std-icon"),text:t.attr("title"),action:t.attr("std-action")};return n&&Std.ui(n)&&(i.menu=Std.ui.build(t,!1)),Std.extend(i,Std.options.get(t))}))}}}});