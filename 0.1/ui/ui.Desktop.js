Std.ui.module("Desktop_Item",{parent:"Item",option:{type:"file",defaultClass:"StdUI_Desktop_Item",boxSizing:"border-box",desktop:null,tabIndex:null,contextMenu:null},extend:{render:function(){var e=this;e.parent().plugin("drag",{}),e.call_opts({contextMenu:null},!0)},height:function(){var e=this,t=e.D,n=e.height()-e.boxSize.height,i=n-e.D.text.height()-10-3;t.icon.css({width:i,height:i})},remove:function(){var e=this,t=e.contextMenu();isWidget(t)&&t.remove()}},"public":{type:function(e){return this.opt("type",e)},desktop:function(e){return this.opt("desktop",e)},contextMenu:function(e){var t=this,n=t.opts;return void 0===e?n.contextMenu:(isWidget(e)?n.contextMenu=e:isObject(e)&&(n.contextMenu=Std.ui(e.ui||"Menu",e)),isWidget(n.contextMenu)&&(n.contextMenu.renderState||n.contextMenu.renderTo(t.desktop()),n.contextMenu.hide().on("itemPress",function(){this.hide()})),t)}}}),Std.ui.module("Desktop_Applications",{parent:"widget",option:{defaultClass:"Desktop_Applications",boxSizing:"border-box",master:null,groups:null,visible:!1},"private":{currentGroup:null},extend:{visible:function(e){var t=this;e===!0&&(null===t._currentGroup&&t.showGroup("*"),t.toForeground().focus(),t.update())},render:function(){var e=this;e.initEvents(),e.toForeground()},height:function(){var e=this;e.update()},width:function(){var e=this;e.update()}},"protected":{initEvents:function(){var e=this;e[0].on("keydown",function(t){switch(t.keyCode){case 27:e.hide()}}).on("contextmenu",function(e){e.preventDefault()}),e[5].on("mouseenter","._group",function(t){this.mouse({auto:!1,click:function(){e.showGroup(this.data("groupName"))}},t)})},initElements:function(){var e=this;e[0].append(e[1]=newDiv("_main").append([e[2]=newDiv("_header").append([e[2.1]=newDiv("_search").append([e[2.2]=newDom("input").attr("placeholder","search..")])]),e[3]=newDiv("_body").append([e[4]=newDiv("_items"),e[5]=newDiv("_groups")])]))},createItem:function(e){var t=this,n=newDiv("_item").append([newDiv("_icon").append(newDom("img").attr("src",e.icon)),newDiv("_text").html(e.text||"")]);return t[4].append(n.data("option",e)),n}},"public":{master:function(e){return this.opt("master",e)},update:function(){var e=this,t=e[1],n=t.width(),i=t.height();return t.css({top:(e.height()-i)/2,left:(e.width()-n)/2}),e[3].css({height:i-e[2].height()}),e[4].css({width:n-e[5].width()}),e},appendGroup:Std.func(function(e,t){var n=this,i=newDiv("_group").html(t).appendTo(n[5]).data("groupName",e);e in n._groups&&n.removeGroup(e),n._items[e]=[],n._groups[e]=i},{each:[isObject]}),insertGroup:function(){},removeGroup:function(e){var t=this;return t._groups[e].remove(),delete t._items[e],delete t._groups[e],t},showGroup:function(e){var t=this.clearItems();if("*"===e)Std.each(t._items,function(e,n){Std.each(n,function(e,n){t.createItem(n)})});else{if(!(e in t._groups))return t;Std.each(t._items[e],function(e,n){t.createItem(n)})}if(t._currentGroup){var n=t._groups[t._currentGroup];n.removeClass("selected")}return t._groups[t._currentGroup=e].addClass("selected"),t},append:Std.func(function(e,t){var n=this,i=n._items;return isArray(t)?Std.each(t,function(t,n){i[e].push(n)}):isObject(t)&&i[e].push(t),n},{each:[isObject]}),insert:function(){},clearItems:function(){var e=this;return e[4].clear(),e}},main:function(e,t){e._items={},e._groups={},e.initElements(),e.appendGroup("*","All"),t.group&&e.appendGroup(t.group)}}),Std.ui.module("Desktop_ControlBar",{parent:"widget",option:{level:2,master:null,height:40,defaultClass:"StdUI_Desktop_ControlBar",boxSizing:"border-box"},extend:{render:function(){var e=this;e.initLayout()},height:function(e){var t=this,n=e-t.boxSize.height;t.components.applicationsBtn.size(n,n)}},"protected":{initLayout:function(){var e=this,t=e.components;return e.layout({ui:"HBoxLayout",items:[t.applicationsBtn,{ui:"spacing",width:5},t.taskBar,t.tray,t.dateTimeView]}),e}},"public":{master:function(e){return this.opt("master",e)},append:function(){},insert:function(){}},main:function(e,t){var n=t.master;e.components={tray:Std.ui("Tray",{level:4,width:200,fixedLayoutWidth:!0}),taskBar:Std.ui("Desktop_TaskBar",{master:n}),dateTimeView:Std.ui("DateTimeView",{type:"time",fontSize:21}),applicationsBtn:Std.ui("Image",{className:"Std_Desktop_TaskButton",value:"images/startButton.png"})},e.components.applicationsBtn[0].mouse({click:function(){var e=n.applications;e.visible()?e.hide():(e.renderState||e.render(),e.show())}})}}),Std.ui.module("Desktop_Main",{parent:"widget",option:{level:5,defaultClass:"StdUI_Desktop_Main",boxSizing:"border-box",itemWidth:96,itemHeight:96,width:800,height:600,items:null,master:null,wallpaper:null},"private":{cursor:null,selected:null,cursorTimer:null,currentMenu:null},extend:{render:function(){var e=this;e[0].unselect(!0).append(e[1]=newDiv("_background")),e.initDesktopMenu(),e.initContextMenu(),e.initDesktopItemMenu(),e.initEvents(),e.initDocEvents(),e.initKeyboard(),e.initSelection()},remove:function(e){var t=this;void 0===e?t._docEvents&&Std.dom(document).off("mousedown",t._docEvents):isWidget(e)&&t.layout().removeChild(e)}},"protected":{initSelection:function(){var e=this,t=!1,n=null,i=0,o=0,s=0,r=0,u=0,c=0,a=newDiv("_selection").appendTo(e[0]),l=function(){e.layout().each(function(t,n){o<n.left()+n.width()&&i<n.top()+n.height()&&o+s>n.left()&&i+r>n.top()?e.select(n.item()):e.clearSelected(n.item())})},d=function(e){return 0==t?(a.show().css({width:0,height:0,zIndex:Std.ui.status.zIndex+1}),t=!0,void(n=setInterval(l,100))):void a.css({top:i=(r=e.pageY-c)<0?e.pageY:c,left:o=(s=e.pageX-u)<0?e.pageX:u,width:s=0>s?Math.abs(s):s,height:r=0>r?Math.abs(r):r})};return e[1].mouse({down:function(t){1===t.which&&(u=t.pageX,c=t.pageY,e[0].on("mousemove",d))},up:function(){t=!1,a.hide(),clearInterval(n),e[0].off("mousemove",d)}}),e},initKeyboard:function(){var e=this;return e[0].on("keydown",function(t){switch(t.keyCode){case 9:break;case 13:e.executionSelected();break;case 27:e.clearSelected();break;case 46:e.deleteSelected();break;case 113:isEmpty(e._selected)||(e.rename(e._selected[0]),e.clearSelected());break;default:return}}),e},initDocEvents:function(){var e=this;return Std.dom(document).on("mousedown",e._docEvents=function(t){var n=t.target,i=e._currentMenu;i&&!i[0].contains(n)&&(i.hide(),e._currentMenu=null)}),e},deleteSelected:function(){var e=this,t=[],n=e._selected;return isEmpty(n)?e:(Std.each(e._selected,function(e,n){t.push(n.text())}),Std.ui("MessageBox",{type:"question",title:"delete",renderTo:e.master(),text:"are sure you want to do this? this file will be removed!",buttons:"yes no",className:"",defaultButton:"yes",detailedText:t.join(" , "),on:{yes:function(){Std.each(n,function(t,n){e.remove(n)}),n.clear()}}}),e)},initEvents:function(){var e=this,t=e.master();t.on("mousedown",function(t){var n=Std.dom(t.target);n.is(".StdUI_Desktop_Item")||n.parent(".StdUI_Desktop_Item")||e.clearSelected()}),e[0].on("mouseenter",".StdUI_Desktop_Item",function(){var t=this.ui();this.mouse({auto:!1,unselect:!0,down:function(n){e.focus(),n.ctrlKey||e.clearSelected(),e._contextMenu.visible()&&e._contextMenu.hide(),e._selected.has(t)?1===n.which&&e.clearSelected(t):e.select(t),n.preventDefault()},dblclick:function(){e.executionSelected()}}).unselect(!0)})},initDesktopItemMenu:function(){var e=this;e._itemMenu=Std.ui("Menu",{renderTo:e,visible:!1,width:200,css:{position:"absolute"},animation:{visible:"StdUI_Desktop_Menu"},items:[{text:"Open",css:{fontWeight:"bold"},click:function(){e.executionSelected()}},{text:"Open With ... ",click:function(){}},{ui:"sep"},{text:"Cut (Ctrl+X)"},{text:"Copy (Ctrl+C)"},{text:"Paste (Ctrl+V)"},{ui:"sep"},{text:"Move To..."},{text:"Copy To..."},{text:"Rename...",click:function(){isEmpty(e._selected)||(e.rename(e._selected[0]),e.clearSelected())}},{text:"Delete (Delete)"},{ui:"sep"},{text:"Properties"}],on:{itemPress:function(){e._itemMenu.hide()}}})},initDesktopMenu:function(){var e=this;e._contextMenu=Std.ui("Menu",{renderTo:e,visible:!1,width:200,css:{position:"absolute"},animation:{visible:"StdUI_Desktop_Menu"},items:[{text:"Lock component",iconClass:"StdUI_Desktop_Icon _lock"},{ui:"sep"},{text:"Sort by",items:[{text:"Type"},{text:"Name (Asc)"},{text:"Name (Desc)"}]},{text:"Create",items:[]},{text:"Refresh",iconClass:"StdUI_Desktop_Icon _refresh",click:function(){e.layout().update()}},{text:"Lock",iconClass:"StdUI_Desktop_Icon _lock2"},{ui:"sep"},{text:"Show full screen (F11)",value:"fullScreen",iconClass:"StdUI_Desktop_Icon _fullScreen",click:function(){e.master().fullScreen()}}],on:{visible:function(){e.updateContextMenu()},itemPress:function(){e._contextMenu.hide()}}})},initContextMenu:function(){var e=this,t=function(t,n){if(t.visible()&&e._currentMenu===t)t.hide();else{t[0].css("position","absolute"),t.show();var i=n.pageX,o=n.pageY,s=t.width(),r=t.height();i+s>e.width()&&(i=e.width()-s),o+r>e.height()&&(o-=r),t.toForeground().move(i,o).focus()}e._currentMenu=t,n.preventDefault()};e[1].on("contextmenu",function(n){t(e._contextMenu,n)}),e[0].on("contextmenu",".StdUI_Desktop_Item",function(n){var i=this.ui();i.contextMenu()?t(i.contextMenu(),n):t(e._itemMenu,n)})}},"public":{master:function(e){return this.opt("master",e)},executionSelected:function(){var e=this;return Std.each(e._selected,function(t,n){e.execution(n)}),e},select:function(e){var t=this;return isWidget(e)&&(t._selected.has(e)||(e[0].parent().css("zIndex",1),e.addClass("selected"),t._selected.push(e))),t},wallpaper:function(e){var t=this;return t[1].backgroundImage(e),t},rename:function(e){var t=this,n=e.text(),i=null,o=newDom("span","_temp").appendTo(e[0]).css({visibility:"hidden",fontFamily:e.D.text.css("fontFamily")}),s=function(){i=setTimeout(function(){o.html(r.value());var e=o.width(),t=o.height();r.css({width:10>e?10:e,height:18>t?18:t})},5)},r=newDom("textarea").appendTo(e).on({mousedown:function(e){e.stopPropagation()},keydown:function(e){13==e.keyCode&&r.blur(),s(),e.stopPropagation()},blur:function(){e.D.text.show(),o.remove(),r.remove(),e.text(r.value()),t.select(e).focus()}}).value(n).focus().select().css("fontFamily",e.D.text.css("fontFamily"));return e.D.text.hide(),t},clearSelected:function(e){var t=this,n=t._selected;if(void 0===e)Std.each(n,function(e,t){t[0].parent().removeStyle("z-index"),t.removeClass("selected")}),n.clear();else if(n.has(e)){var i=n.indexOf(e);n.remove(i),e[0].parent().removeStyle("z-index"),e.removeClass("selected")}return t},append:function(e){var t=this,n=t.layout();return isArray(e)?Std.each(e,function(e,i){n.append(Std.extend({ui:"Desktop_Item",desktop:t},i))}):isObject(e)&&n.append(Std.extend({ui:"Desktop_Item",desktop:t},e)),n.update(),t},updateContextMenu:function(){var e=this;return e._contextMenu&&e._contextMenu.each(function(e,t){var n=t.value();return"fullScreen"==n?(t.text(Std.dom("body").fullScreen()?"Exit full screen (F11)":"Show full screen (F11)"),!0):void 0}),e},execution:function(e){var t=this,n=t.master();return clearTimeout(t._cursorTimer),t._cursorTimer=setTimeout(function(){n.cursor(null)},1e4),n.cursor("wait"),Std.dom("img",e).clone().css({position:"absolute",zIndex:2,left:e[0].offset().x,top:e[0].offset().y,width:e.width(),height:e.width()}).appendTo(t).animate("end").animate({0:{filter:"blur(0px)",opacity:.9,transform:"scale(0.9)"},to:{filter:"blur(8px)",opacity:0,transform:"scale(1.5)"}},{duration:600,timingFunction:"ease-out"},function(){this.remove()}),n.execution(e,function(){n.cursor(null)}),t}},main:function(e,t){e._selected=[],e.layout({ui:"GridLayout",spacing:10,rows:"auto",columns:"auto",autoFlow:"column",cellWidth:t.itemWidth,cellHeight:t.itemHeight,items:t.items})}}),Std.ui.module("Desktop_TaskBar",{parent:"TaskBar",option:{level:4,master:null,boxSizing:"border-box"},extend:{render:function(){this.initTaskMenu()},initTaskMenu:function(){var e=this;e.on("itemContextMenu",function(t,n){e._current=n})}},"private":{current:null},"protected":{initProcessEvents:function(){var e=this,t=e.master();return t.on("createProcess",function(t){t.on("createWindow",function(n){e.bindProcessWindow(t,n)})}),e},initTaskMenuData:function(){var e=this;return e.taskMenu({width:200,items:[{text:"Restore",iconClass:"_restore",click:function(){e._current.value().restore()}},{text:"Minimize",iconClass:"_min",click:function(){e._current.value().minimize(!0)}},{text:"Maximize",iconClass:"_max",click:function(){e._current.value().maximize(!0)}},{ui:"sep"},{text:"More Action",items:[],enable:!1},{text:"New instance",enable:!1},{ui:"sep"},{text:"Close",iconClass:"_close",css:{fontWeight:"bold"},click:function(){e._current.value().close()}}],animation:{visible:"StdUI_Desktop_Menu"}})}},"public":{master:function(){return this.opts.master},bindProcessWindow:function(e,t){var n=this,i=n.add({icon:t.titleIcon()||e.icon(),text:t.title()||e.name(),value:t});return i.on({select:function(e){e===!0&&t.focus()},active:function(e){t.emit(!1),t.minimize(!e),t.emit(!0)}}),t.on({focusin:function(){n.select(i,!0)},minimize:function(e){i.actived(!e)},remove:function(){n.remove(i),n.update()}}),e.task=i,n.update()}},main:function(e){e.initTaskMenuData(),e.initProcessEvents()}}),Std.ui.module("Desktop",function(){var e=Std.module({model:"events",events:"create error message exit",option:{pid:0,url:null,name:"null",icon:"",address:"",argv:null,worker:null,master:null,fileExts:null},"protected":{initWorker:function(e){var t=this,n=e.main,i=null;return isString(n)&&(n=new Function("return "+n)()),isObject(e.mainWindow)&&(i=t.createWindow(e.mainWindow,!0)),isFunction(n)&&n(t,t.opts.argv,t.master(),i),t.emit("create",t.worker)},initApplication:function(){var e=this,t=!1,n=e.worker=new Worker(e.address()+"/index.js");n.onerror=function(t){console.log(t),e.emit("error",t)},n.onmessage=function(n){var i=n.data;isString(i)?"exit"==i&&e.exit():isObject(i)&&"init"===i.type&&0==t?(t=!0,i.packages?Std.use(i.packages,function(){e.initWorker(i)}):e.initWorker(i)):e.emit("message",n)}}},"public":{postMessage:function(e){var t=this;return t.worker.postMessage(e),t},createTray:function(e){var t=this,n=t.master().controlBar().components.tray,i=n.add(Std.extend({icon:t.icon(),name:t.name()},e));return n.update(),t.on("exit",function(){n.remove(i)}),i},createMainWindow:function(e){return this.createWindow(e||{},!0)},createWindow:function(e,t){var n=this,i=n.master(),o=n._windows,s=Std.ui("Window",Std.extend({value:n,title:t?n.name():"window - "+n.name(),titleIcon:n.icon(),className:"StdUI_Desktop_Window",renderTo:i.desktop(),animation:{minimize:"StdUI_Desktop_Window_Minimize",maximize:"StdUI_Desktop_Window_Maximize"}},e||{}));return s.on({remove:function(){o.remove(o.indexOf(s)),t===!0&&n.exit()}}),o.push(s),n.emit("createWindow",s),s},exit:function(){var e=this,t=e.worker,n=e._windows;return Std.each(n,function(e,t){t.remove()}),t&&t.terminate(),n.clear(),e.emit("exit")}},main:function(e){var t=this,n=t.init_opts(e);t._windows=[],n.on&&t.on(n.on),n.address&&t.initApplication()},entrance:function(e,t){Std.each("pid address name icon path master",function(e,n){t[n]=function(){return this.opts[n]}})}});return{parent:"widget",events:"update createProcess",option:{level:4,width:1024,height:768,minWidth:600,minHeight:400,desktopItemWidth:100,desktopItemHeight:100,defaultClass:"StdUI_Desktop",boxSizing:"border-box",wallpaper:null},"private":{processID:0,processes:null,componentLocked:!0,currentDesktopID:0},extend:{render:function(){var e=this;e.initLayout(),e.factorySetting(),e.initApplicationsView(),e.call_opts({wallpaper:null},!0)},remove:function(){var e=this,t=e._processes;Std.each(t,function(n){e.terminateProcess(n),delete t[n]})}},"protected":{initLayout:function(){var e=this;return e.layout(Std.ui("VBoxLayout",{spacing:0})),e},initApplicationsView:function(){var e=this;e.applications=Std.ui("Desktop_Applications",{master:e,renderTo:e.desktop(),animation:{visible:"Desktop_Applications_Visible"}})},createMainDesktop:function(){var e=this,t=e.opts,n=Std.ui("Desktop_Main",{master:e,itemWidth:t.desktopItemWidth,itemHeight:t.desktopItemHeight});return e._desktops.push(n),n},createControlBar:function(){var e=this,t=Std.ui("Desktop_ControlBar",{master:e});return e._controlBars.push(t),t},createProcess:function(t,n,i,o,s){var r=this,u=++r._processID,c=o.split(" "),a=r._processes[u]=new e({PID:u,name:t,icon:n,path:i,argv:c,master:r,address:c[0]});return a.on({exit:function(){delete r._processes[u]},create:function(){Std.func(s).call(r,a)}}),r.emit("createProcess",a),a},terminateProcess:function(e){var t=this,n=t._processes;return isNumber(e)&&e in n&&(n[e].exit(),delete n[e]),t}},"public":{process:function(e){return this._processes[e]||null},desktop:function(e){return this._desktops[void 0===e?0:e]},controlBar:function(e){return this._controlBars[void 0===e?0:e]},fullScreen:function(){var e=Std.dom("body");return e.fullScreen(!e.fullScreen())},wallpaper:function(e){var t=this;return Std.each(t._desktops,function(t,n){n.wallpaper(e)}),t},cursor:function(e){var t=this,n="";switch(e){case"wait":n="_waiting"}return isEmpty(n)?""==n&&t._cursor&&t.removeClass(t._cursor):t.addClass(t._cursor=n),t},execution:function(e,t){var n=this,i=null,o=null,s=null,r=null,u=null,c=null;if(isWidget(e)?(i=e.type(),o=e.text(),s=e.icon(),c=e.value()):isObject(e)&&(i=e.type||"file",o=e.name,s=e.icon,r=e.path,c=e.address),"application"===i)isString(c)&&(u=n.createProcess(o,s,r,c,t));else if("file"===i){var a=Std.url.suffix(o);if(a in n._fileExts){var e=n._fileExts[a];u=n.createProcess(o,s,r,e.application+" "+c,t)}}return u},createFileExt:Std.func(function(e,t){var n=this;return n._fileExts[e]={icon:t.icon,application:t.application,description:t.description}},{each:[isObject]}),removeFileExt:function(e){return delete this._fileExts[e],this},appendDesktopItem:function(e,t){var n=this;if(!(e.type&&"file"!=e.type||e.icon||e.iconClass||!e.text)){var i=Std.url.suffix(e.text);i in n._fileExts&&(e.icon=n._fileExts[i].icon)}return n.desktop(t).append(e),n},factorySetting:function(){var e=this,t=e.createMainDesktop(),n=e.createControlBar();return e.layout().append([t,n]),e.updateLayout(),e}},main:function(e,t){e._desktops=[],e._controlBars=[],e._fileExts={},e._processes={},e._components={},isObject(t.fileExts)&&e.createFileExt(t.fileExts)}}});