Std.ui.module("TaskBarItem",{parent:"Item",events:"active select",option:{activated:!1,selected:!1,defaultClass:"StdUI_Item StdUI_TaskBarItem"},"public":{selected:function(e){var t=this;return t.opt("selected",e,function(){t[0].toggleClass("selected",e),t.emit("select",e),t.parent().emit("itemSelect",[e,t],!0)})},activated:function(e){var t=this;return t.opt("activated",e,function(){var i=t.parent();t[0].toggleClass("activated",e),t.emit("active",e),i.emit("itemActive",[e,t],!0),e===!1&&(t.selected()&&i.reselect(t),t[0].removeClass("hover"),t.selected(!1))})},updateStyle:function(e,t,i){var n=this;!n.iconHeight()!==t/2&&n.iconHeight(t/2).iconWidth(t/2),e!==n._spacing&&n[0].marginRight(n._spacing=e),n.height(t).width(i)}},main:function(e){e.call_opts({activated:!1,selected:!1},!0)}}),Std.ui.module("TaskBar",{parent:"widget",events:"itemClick itemActive itemSelect itemContextMenu",option:{level:3,defaultClass:"StdUI_TaskBar",items:null,height:35,spacing:8,minItemHeight:26,tabIndex:null,multiRow:!0,taskMenu:null},"private":{selectedItem:null},extend:{render:function(){var e=this;isEmpty(e._items)||(Std.each(e._items,function(e,t){t.render()}),e.update()),e.initEvents(),e.initDocEvents()},remove:function(e){var t=this,i=t._items;if(void 0===e)isWidget(t._taskMenu)&&t._taskMenu.remove(),t._docEvents&&Std.dom(document).off("mousedown",t._docEvents);else if(isNumber(e))t.reselect(i[e]),i[e].remove(),i.remove(e);else if(isWidget(e)){var n=i.indexOf(e);-1!==n&&(t.reselect(e),i[n].remove(),i.remove(n))}}},"protected":{reselect:function(e){for(var t=this,i=t._items,n=i.indexOf(e),s=i.length,a=-1,u=n+1;s>u;u++)if(i[u].activated()){a=u;break}if(-1==a)for(var u=n-1;u>=0;u--)if(i[u].activated()){a=u;break}return-1!==a&&(t._selectedItem=i[a].selected(!0)),t},itemClick:function(e,t){var i=this,n=t.index(),s=i._items[n];i.select(s,!s.selected()),i.emit("itemClick",[e,n,s],!0)},initDocEvents:function(){var e=this;Std.dom(document).on("mousedown",e._docEvents=function(t){e._taskMenu&&!e._taskMenu[0].contains(t.target)&&e._taskMenu.hide()})},initTaskMenu:function(){var e=this,t=e.opts;return e._taskMenu=isWidget(t.taskMenu)?t.taskMenu:Std.ui("Menu",t.taskMenu),isWidget(e._taskMenu)&&(e._taskMenu[0].css("position","absolute"),e._taskMenu.on({itemPress:function(){e._taskMenu.hide()}}).renderTo("body")),e},initEvents:function(){var e=this,t=e.opts;return e[0].on("contextmenu",function(e){e.preventDefault()}),e[0].on("mouseenter",">.StdUI_Item",function(){this.mouse({auto:!1,unselect:!0,click:function(t){return e.itemClick(t,this)}})}).on("contextmenu",">.StdUI_Item",function(i){if(!e._taskMenu&&isObject(t.taskMenu)&&e.initTaskMenu(),isWidget(e._taskMenu)){var n=e._taskMenu.show(),s=i.pageX,a=i.pageY,u=n.width(),o=n.height();s+u>Std.dom(window).width()&&(s=Std.dom(window).width()-u),n.toForeground()[0].css({top:a-o,left:s})}e.emit("itemContextMenu",[i,this.ui()],!0),i.preventDefault()}),e},createItem:function(e){var t=this,i=null;return isWidget(e)?i=e:isObject(e)?i=Std.ui(e.ui||"TaskBarItem",e||{}):(isString(e)||isNumber(e))&&(i=Std.ui("TaskBarItem",{text:e})),isWidget(i)&&(i.parent(t),i.verticalAlign("middle"),i.appendTo(t[0]),t.renderState&&i.render()),i},update:function(){var e=this,t=e.opts,i=e._items.length,n=e.width()-e.boxSize.width,s=e.height()-e.boxSize.height,a=t.spacing,u=5,o=200>n/u?n/(u=Math.floor(n/200)):n/u;return o*i>n&&(s/t.minItemHeight>=2&&t.multiRow?o*(s/=2)>=n&&i>=2*u&&(o=Math.floor(i%2==0?2*n/i:2*n/(i+1))):o=Math.floor((n-a)/i)),Std.each(e._items,function(e,t){t.updateStyle(a,s,o-a<s/2+t.boxSize.width?s/2+t.boxSize.width:o-a)}),e}},"public":{add:function(e){var t=this,i=t.createItem(e);return null!==i&&t._items.push(i),i},taskMenu:function(e){var t=this;return t.opt("taskMenu",e,function(){t._taskMenu&&(t._taskMenu.remove(),t._taskMenu=null)})},select:function(e,t){var i=this;if(isNumber(e)&&(e=i._items[e]),t===!0){if(i._selectedItem===e&&e.selected())return i;e.activated()||e.activated(!0),i._selectedItem&&i._selectedItem.selected(!1),i._selectedItem=e.selected(!0)}else e.activated()&&e.activated(!1),e.selected(!1),i.reselect(e);return i},append:function(e){var t=this;return isArray(e)?Std.each(e,function(e,i){t.add(i)}):t.add(e),t.renderState&&t.update(),t}},main:function(e,t){e._items=[],t.items&&e.append(t.items)}});