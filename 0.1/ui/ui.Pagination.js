Std.ui.module("Pagination",{parent:"widget",option:{level:3,total:0,page:0,pageSize:9,pageCount:"auto",pageRows:10,tabIndex:null,link:!1,hotKey:!1,text:"<b><?=page?></b> / <b><?=pageCount?></b><b style='margin-left: 10px'>total:</b><?=total?>",href:"#<?=page?>",defaultClass:"StdUI_Pagination",height:34,first:"First",last:"Last",prev:"Prev",next:"Next",editable:!0},events:"change",extend:{render:function(){var e=this;e.refreshPages(),e.refreshText(),e.refreshList()},remove:function(){var e=this;e._pageList&&e._pageList.remove()}},"protected":{initKeyboard:function(){var e=this;return e},initEvents:function(){var e=this,t=e.D;return e[0].on("mouseenter","._buttons > ._button",function(a){var n=this.mouse({auto:!1,click:function(){if(!n.hasClass("selected")){var a=Std.each("first prev next last",function(a,r){return r in t&&t[r].is(n)?(e.page(e.pageIndex(r)),!0):void 0});a!==!0&&e.page(e.pageIndex(n.text()))}}},a)}),e},initElements:function(){var e=this,t=e.D={main:newDom("tr"),buttons:newDom("td"),text:newDom("td","_text")};return e[0].append(newDom("table").attr({cellspacing:0,cellpadding:0}).append(newDom("tbody").append(t.main=newDom("tr").append([t.left,t.buttons.append([t.left=newDiv("_buttons -left"),t.pages=newDiv("_buttons -pages"),t.right=newDiv("_buttons -right"),t.jump=newDiv("_jump")]),t.text])))),e},createButton:function(e){var t=this,a=t.opts,n=newDom("a"),r="_button";return a.link&&n.attr("href",new Std.template(a.href).render({page:t.pageIndex(e)})),-1!="first prev next last".indexOf(e)?(n.html(a[e]),r+=" -"+e):n.html(e),n.className(r)}},"public":{total:function(e){return this.opt("total",e,function(){this.refreshText()})},text:function(e){return this.opt("text",e,function(){this.refreshText()})},editable:function(e){var t=this;return t.opt("editable",e,function(){e?t.refreshList():t._pageList&&t._pageList.remove()})},pageSize:function(e){return this.opt("pageSize",e,function(){this.refreshPages().refreshText()})},pageRows:function(e){return this.opt("pageRows",e)},page:function(e){var t=this,a=t.opts,n=t._pageList;return void 0===e?int(a.page):(e!=a.page&&(a.page=e=~~e,n&&n.value()!=e&&n.value(e),t.refreshPages().refreshText().emit("change",e)),t)},pageIndex:function(e){switch(e){case"first":e=1;break;case"prev":e=this.page()-1;break;case"next":e=this.page()+1;break;case"last":e=this.pageCount()}return~~e},pageCount:function(e){var t=this,a=t.opts;return void 0===e?"auto"===a.pageCount?Math.ceil(a.total/a.pageSize):a.pageCount:(a.pageCount=e,t.refreshText().refreshList())},pageNumbers:function(){for(var e=this,t=e.opts,a=t.page,n=a,r=e.pageCount(),i=Math.floor(t.pageSize/2),o=[],s=a-1;s>a-1-i&&!(1>s);s--)n=s;for(s=a+1;a+1+i>s&&!(s>Math.ceil(t.total/t.pageSize)||s>r);s++)r=s;for(s=n;r>=s;s++)o.push(s);return o},refreshText:function(){var e=this;return e.renderState&&new Std.template(e.opts.text).renderTo(e.D.text.clear(),{page:e.page(),pageSize:e.pageSize(),pageCount:e.pageCount(),total:e.total()}),e},refreshList:function(){var e=this;return e.opts.editable?(e._pageList||(e._pageList=Std.ui("ComboBox",{inputMode:"input",value:e.page(),renderTo:e.D.jump,width:60}),e._pageList.on("change",function(){e.page(~~this.value())})),e._pageList.clear().append(function(){for(var t=[],a=1,n=e.pageCount();n>=a;a++)a>1e4&&n>a+1e4?a+=9999:a>1e3&&n>a+1e3?a+=999:a>100&&n>a+100&&(a+=99),t.push(a+"");return t}()).value(e.page()),e):e},refreshPages:function(){var e=this.clear(),t=e.opts,a=e.D,n=t.page;return e.renderState?(n>1&&a.left.append([a.first=e.createButton("first"),a.prev=e.createButton("prev")]),Std.each(e.pageNumbers(),function(t,r){var i=e.createButton(r).appendTo(a.pages);n==r&&i.addClass("selected")}),n<e.pageCount()&&a.right.append([a.next=e.createButton("next"),a.last=e.createButton("last")]),e):e},repaint:function(){var e=this;return e.refreshPages(),e.refreshText(),e.refreshList(),e},clear:function(){var e=this,t=e.D;return t.left.clear(),t.pages.clear(),t.right.clear(),Std.each("first prev next last",function(e,a){delete t[a]}),e}},main:function(e,t){t.change&&e.on("change",t.change),e.initElements(),e.initEvents(),e.initKeyboard()}}),Std.plugin.module("dataSourcePagination",{option:{dataPath:""},"protected":{initDataGrid:function(){var e=this,t=e.opts,a=e.owner,n=e._pagination,r=function(){a[2].height(a.height()-a.opts.headerHeight-a.boxSize.height-1-n.height())};return a.on("resize",r),a.on("dataSourceLoad",function(e){var a=Std.mold.dataPath(e,t.dataPath);Std.each("total pageSize pageCount pageRows page",function(e,t){n.opts[t]=a[t]}),n.refreshPages().refreshText().refreshList()}),n.renderTo(a)[0].css("borderTopColor",a[0].css("borderTopColor")),a.renderState&&r(),e}},"public":{remove:function(){this._pagination.remove()}},main:function(e,t,a){switch(e._pagination=Std.ui("Pagination",t),a.ui){case"DataGrid":e.initDataGrid()}}});