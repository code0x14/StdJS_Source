var isActive=!1,isOpen=!1,extensionURL=null,contextMenuElementXPath=null,isListeningKeyboardActivation=!1,loadStateData=function(){var e=localStorage.getItem("Firebug");isActive=!1,isOpen=!1,extensionURL=chrome.extension.getURL(""),e&&(e=e.split(","),isActive="1"==e[0],isOpen="1"==e[1])},loadFirebug=function(){document.documentElement.setAttribute("debug",isOpen),injectScriptText("("+listenConsoleCalls+")()"),injectFirebugScript()},loadFirebugAndWait=function(e,n){n=n||"1,1,"+extensionURL,localStorage.setItem("Firebug",n),loadStateData(),chrome.extension.sendRequest({name:isActive?"FB_enableIcon":"FB_disableIcon"}),document.documentElement.setAttribute("debug",isOpen),injectFirebugScript(),setTimeout(function(){waitFirebug(e)},0)},waitFirebug=function(e){document&&document.getElementById("FirebugChannel")?(stopListeningKeyboardActivation(),e()):setTimeout(function(){waitFirebug(e)},100)},injectFirebugScript=function(){if(scriptElement=document.getElementById("FirebugLite"))firebugDispatch("FB_toggle");else{var e=document.createElement("script");e.src=extensionURL+"firebug-lite-beta.js",e.setAttribute("id","FirebugLite"),e.setAttribute("firebugIgnore","true"),e.setAttribute("extension","Chrome"),document.documentElement.appendChild(e),e.onload=function(){e=document.createElement("script"),e.src=extensionURL+"googleChrome.js",document.documentElement.appendChild(e)}}},injectScriptText=function(e){var n=document.createElement("script"),t=document.documentElement;n.text=e,n.setAttribute("id","FirebugLite"),n.setAttribute("firebugIgnore","true"),n.setAttribute("extension","Chrome"),t.appendChild(n),t.removeChild(n)};chrome.extension.onRequest.addListener(function(e,n,t){"FB_isActive"==e.name?(loadStateData(),t({value:""+isActive})):"FB_loadFirebug"==e.name?(setTimeout(function(){loadStateData(),loadFirebugAndWait(function(){isActive=!0;var e=isActive?"FB_enableIcon":"FB_disableIcon";chrome.extension.sendRequest({name:e}),loadChannel()})},0),t({})):"FB_contextMenuClick"==e.name?isActive?firebugDispatch("FB_contextMenuClick,"+contextMenuElementXPath):loadFirebugAndWait(function(){firebugDispatch("FB_contextMenuClick,"+contextMenuElementXPath)}):"FB_deactivate"==e.name?listenKeyboardActivation():t({})});var channel=null,channelEvent,onFirebugChannelEvent=function(){channel=document.getElementById("FirebugChannel"),channel&&chrome.extension.sendRequest({name:channel.innerText})},loadChannel=function(){channel=document.getElementById("FirebugChannel"),channel&&(channel.addEventListener("FirebugChannelEvent",onFirebugChannelEvent),channelEvent=document.createEvent("Event"),channelEvent.initEvent("FirebugChannelEvent",!0,!0))},firebugDispatch=function(e){channel||loadChannel(),channel.innerText=e,channel.dispatchEvent(channelEvent)},onContextMenu=function(e){contextMenuElementXPath=getElementXPath(e.target)},loadListeners=function(){window.addEventListener("contextmenu",onContextMenu),window.addEventListener("unload",unloadListeners)},unloadListeners=function(){channel&&channel.removeEventListener("FirebugChannelEvent",onFirebugChannelEvent),window.removeEventListener("contextmenu",onContextMenu),window.removeEventListener("unload",unloadListeners)},listenConsoleCalls=function(){for(var e=["log","info","warn","error"],n={consoleQueue:["chromeConsoleQueueHack"]},t=n.consoleQueue,i=0,o=e.length;o>i;i++){var a=e[i];!function(e){n[e]=function(){t.push([e,arguments])}}(a)}window.console=n},onGlobalKeyDown=function(e){var n=e.keyCode,t=e.shiftKey,i=e.ctrlKey;123!=n||t?67==n&&i&&t?Firebug.Inspector.toggleInspect():76==n&&i&&t&&Firebug.chrome.focusCommandLine():loadFirebugAndWait(function(){firebugDispatch(i?"FB_openInNewWindow":"FB_toggle")},"1,0,")},listenKeyboardActivation=function(){window.addEventListener("keydown",onGlobalKeyDown),isListeningKeyboardActivation=!0},stopListeningKeyboardActivation=function(){isListeningKeyboardActivation&&window.removeEventListener("keydown",onGlobalKeyDown)},getElementXPath=function(e){return e&&e.id?'//*[@id="'+e.id+'"]':this.getElementTreeXPath(e)},getElementTreeXPath=function(e){for(var n=[];e&&1==e.nodeType;e=e.parentNode){for(var t=0,i=e.nodeName,o=e.previousSibling;o;o=o.previousSibling)1==o.nodeType&&o.nodeName==i&&++t;var a=e.nodeName.toLowerCase(),c=t?"["+(t+1)+"]":"";n.splice(0,0,a+c)}return n.length?"/"+n.join("/"):null};loadStateData(),isActive?loadFirebugAndWait(function(){loadChannel()}):listenKeyboardActivation(),loadListeners(),chrome.extension.sendRequest({name:isActive?"FB_enableIcon":"FB_disableIcon"});