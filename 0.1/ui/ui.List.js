Std.ui.module("ListItem",{parent:"Item",option:{defaultClass:"StdUI_Item StdUI_ListItem",iconHeight:16,iconWidth:16,height:24,value:null},"private":{selected:!1},extend:{height:function(e){var t=this,i=t.opts,n=t.D;isNumber(e)||(e=t.height()),n.icon&&n.icon.marginTop(Math.floor((e-i.iconHeight)/2)),t[0].lineHeight(e-t.boxSize.height)}}}),Std.ui.module("List",{parent:"widget",events:"itemClick itemRename select",action:{children:"append"},option:{defaultClass:"StdUI_List",level:4,type:"default",value:null,items:null,editable:!1,template:null,dataSource:null,itemHeight:24,itemWidth:80,iconWidth:16,iconHeight:16,selectionMode:"single"},"private":{selectedItems:null},extend:{render:function(){var e=this;e.items.each(function(t,i){i.renderTo(e[0])})},remove:Std.func(function(e){var t=this,i=t.items,n=t.selectedItems;if(isObject(e)){var s=i.indexOf(e);-1!==s&&(e=s)}isNumber(e)&&e<i.length&&(n.has(e)&&t.clearSelected(e),i[e].remove(),i.remove(i))},{each:[isArray]})},"protected":{initEvents:function(){var e=this;return e[0].focussing(function(){e.addClass("focus")},function(){e.removeClass("focus")},!1),e},initItemEvents:function(){var e=this,t=e.opts.selectionMode,i=function(i,n,s){"multi"===t?(s.ctrlKey||e.clearSelect(),n._selected?e.clearSelect(n):e.select(n)):"none"!==t&&(e.clearSelect(),e.select(i))};return e[0].delegate("mouseenter",".StdUI_ListItem,.StdUI_TemplateItem",function(t){var n=this.index(),s=e.items[n];s[0].mouse({auto:!1,dblclick:function(){e.editable()&&e.editItem(s)},click:function(){e.emit("itemClick",s)},down:function(e){i(n,s,e)}},t)}),e},editItem:function(e){var t=this;return e instanceof Std.ui("ListItem")&&e.edit(function(i,n){t.emit("itemRename",[e,i,n],!0)}),t},createItem:function(e){var t=this,i=t.opts,n="ListItem",s={height:i.itemHeight,iconWidth:i.iconWidth,iconHeight:i.iconHeight};return isWidget(e)?e:(i.template?(n="TemplateItem",Std.extend(s,{data:e,template:t.template(),textField:i.textField,valueField:i.valueField})):isString(e)||isNumber(e)?s.text=e:isObject(e)&&(isString(e.ui)&&(n=e.ui),s=Std.extend(s,e)),null!==s?("block"==i.type&&(s.width=i.itemWidth),Std.ui(n,s)):null)}},"public":{type:function(e){return this.opt("type",e,function(){this[0].toggleClass("_block","block"===e)})},itemWidth:function(e){return this.opt("itemWidth",e,function(){Std.each(this.items,function(t,i){i.width(e)})})},itemHeight:function(e){return this.opt("itemHeight",e,function(){Std.each(this.items,function(t,i){i.height(e)})})},dataSource:function(e){return this.opt("dataSource",e,function(){this.reload()})},editable:function(e){return this.opt("editable",e)},each:function(e,t){var i=this;return Std.each(i.items,function(t,n){return isFunction(e)?e.call(i,t,n):void 0},t)},template:function(e){var t=this,i=t.opts;return void 0===e?i.template:(isString(e)&&(e=Std.template(e)),e instanceof Std.template&&(i.template=e),t)},reload:function(e){var t=this,i=t.opts,n=i.dataSource,s=n.read;return n&&"ajax"===n.type&&isObject(s)&&Std.ajax.json({url:s.url,data:Std.extend(s.data||{},e),type:s.type||"get",success:function(e){t.clear(),t.append(Std.mold.dataPath(e,s.dataPath)),t.emit("dataSourceLoad",e)}}),t},select:Std.func(function(e){var t=this,i=t.opts,n=t.items,s=i.selectionMode;if("none"!==s)if(isWidget(e))t.select(n.indexOf(e));else if(isNumber(e)&&-1!==e){var c=n[e];if(!c||c._selected)return;"single"===s&&t.clearSelect(),c.addClass("selected"),c._selected=!0,t.selectedItems.push(c),t.emit("select",[e,c],!0)}},{each:[isArray]}),append:Std.func(function(e){var t=this,i=t.createItem(e);null!==i&&isWidget(i)&&(t.items.push(i),t.renderState&&i.renderTo(t[0]))},{each:[isArray]}),clearSelect:function(e){var t=this,i=t.selectedItems;if(void 0===e){for(var n=0,s=i.length;s>n;n++)i[n].removeClass("selected"),i[n]._selected=!1;i.clear()}else if(isNumber(e)&&-1!==e){var c=i[e];c&&c._selected&&(c.removeClass("selected"),c._selected=!1,i.remove(e))}else isWidget(e)&&t.clearSelect(i.indexOf(e));return t},clear:function(){for(var e=this,t=e.items,i=0,n=t.length;n>i;i++)t[i].remove();return t.clear(),e.selectedItems.clear(),e}},main:function(e,t){e.items=[],e.selectedItems=[],e.call_opts({type:"default",template:null},!0),t.items&&e.append(t.items),e.initEvents(),e.initItemEvents()}});