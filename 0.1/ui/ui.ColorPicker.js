Std.ui.module("ColorPicker",{parent:"widget",events:"change",action:{content:"value"},option:{level:3,defaultClass:"StdUI_ColorPicker",boxSizing:"border-box",fixedLayoutWidth:!0,fixedLayoutHeight:!0,minWidth:380,minHeight:220,width:380,height:220,paletteSize:150,value:"#000"},"private":{rollY:0,paletteX:0,paletteY:0},extend:{render:function(){var e=this,t=e.opts;e.value(t.value),e.initPalette(),e.initRoll(),e.initInputs(),e.initColors()}},"protected":{initInputs:function(){var e=this,t=e.D;return t.values.delegate("focusout","input",function(){var o=Std.dom(this),n=o.className().substr(1);switch(n){case"R":case"G":case"B":e.rgb(t.R.value(),t.G.value(),t.B.value());break;case"H":case"S":case"V":e.hsv(t.H.value(),t.S.value(),t.V.value());break;case"HEX":e.hex(t.HEX.value())}}),e},initColors:function(){var e=this,t=e.D,o=Std.convert.colors,n=null,i=Std.dom.fragment(),r=document.createElement("div");r.className="_color";for(var a in o){var l=Std.dom.clone(r);l.style.backgroundColor=o[a],i.appendChild(l)}return t.colors.append(i).delegate("click","._color",function(){null!==n&&n.removeClass("selected"),e.hex(Std.convert.rgb2hex(Std.convert.color((n=Std.dom(this).addClass("selected")).css("background-color"))))}),e},initPalette:function(){var e=this,t=e.D,o=null,n=Std.dom(e[0].document()),i=function(t){e.move1(t.pageX-o.x,t.pageY-o.y).updateUI()};return t.palette.mouse({unselect:!0,down:function(r){o=t.palette.offset(),t.position1.css("visibility","hidden"),e.move1(r.pageX-o.x,r.pageY-o.y).updateUI(),n.on("mousemove",i)},up:function(){n.off({mousemove:i}),t.position1.removeStyle("visibility")}}),e},initRoll:function(){var e=this,t=e.D,o=null,n=Std.dom(e[0].document()),i=function(t){e.move2(t.pageY-o).updateUI()},r=function(){n.off({mouseup:r,mousemove:i})};return t.roll.on("mousedown",function(a){return o=t.roll.offset().y,n.on({mouseup:r,mousemove:i}).once("selectstart",function(){return!1}),e.move2(a.pageY-o).updateUI(),!1}),e},move1:function(e,t){var o=this,n=o.opts.paletteSize;return 0>e?e=0:e>n&&(e=n),0>t?t=0:t>n&&(t=n),o.D.position1.css({left:(o._paletteX=e)-7,top:(o._paletteY=t)-7}),o},move2:function(e){var t=this,o=t.opts.paletteSize;return 0>e?e=0:e>o&&(e=o),t.D.position2.css("top",(t._rollY=e)-4),t},updateUI:function(){var e=this,t=e.D,o=e.hsv(),n=Std.convert.hsv2rgb(o.h,o.s,o.v),i=Std.convert.rgb2hex(n.r,n.g,n.b);return t.R.value(n.r),t.G.value(n.g),t.B.value(n.b),t.H.value(o.h),t.S.value(o.s),t.V.value(o.v),t.HEX.value(i),t.view.css("background-color",i),t.palette.css("background-color",Std.convert.rgb2hex(Std.convert.color("hsv("+o.h+",100,100)"))),e.emit("change",i)}},"public":{value:function(e){var t=this;return void 0===e?t.hex():(isString(e)&&(e=Std.convert.color(e)),t.rgb(e.r,e.g,e.b))},rgb:function(e,t,o){var n=this;if(void 0===e)return Std.convert.hsv2rgb(n.hsv());var i=Std.convert.rgb2hsv(e,t,o);return n.hsv(i.h,i.s,i.v)},hex:function(e){var t=this;if(void 0===e)return Std.convert.rgb2hex(t.rgb());var o=Std.convert.hex2rgb(e);return t.rgb(o.r,o.g,o.b)},hsv:function(e,t,o){var n=this,i=n.opts.paletteSize;return void 0===e?{h:int((i-n._rollY)*(360/i)),s:int(n._paletteX*(100/i)),v:int((i-n._paletteY)*(100/i))}:(n.move1(n._paletteX=t/(100/i),n._paletteY=i-o/(100/i)),n.move2(n._rollY=i-e/(360/i)),n.updateUI())}},main:function(e,t,o){var n=e.D={};Std.each("client views view palettes palette roll position1 position2 values colors",function(e,t){n[t]=newDiv("_"+t)}),Std.each("R G B HEX H S V",function(e,t){n.values.append(newDiv("_field").append([newDom("span","_label").html(t),n[t]=newDom("input","_"+t)]))}),o.append([n.palettes.append([n.palette.append(n.position1.append(newDiv("inner"))),n.roll.append(n.position2)]),newDiv("_client").append([n.colors,n.views.append([n.view])]),n.values])}});